!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(r,i)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=e.apply(n,r);function s(e){t(a,i,o,s,u,"next",e)}function u(e){t(a,i,o,s,u,"throw",e)}s(void 0)}))}}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(u){s=!0,i=u}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=document.createElement("style");o.innerHTML=".custom-form-item-label .el-form-item__label{width:100%!important}.point{margin-bottom:16px}.fn .el-tabs__item{min-width:200px}.select-point .el-drawer__body{padding:0;position:relative}\n",document.head.appendChild(o),System.register(["./vendor-legacy.5dd500bd.js","./useRequestor-legacy.7584c3c3.js","./useComposables-legacy.b3cf5d97.js","./Apis-legacy.e656164a.js","./index-legacy.0726abb6.js"],(function(t){"use strict";var i,o,a,s,u,l,c,h,f,v,p,d,y,m,g,b,w;return{setters:[function(e){i=e.r,o=e.d,a=e.e,s=e.w,u=e.c},function(e){l=e.a},function(e){c=e.c,h=e.u},function(e){f=e.u,v=e.a,p=e.b,d=e.f,y=e.r,m=e.c,g=e.d,b=e.I},function(e){w=e.n}],execute:function(){function x(e){var t=i(e);return[t,function(e){return t.value=e},function(e){return t.value[e]},function(e,n){return t.value[e]=n}]}var k,O;function S(e){return new Promise((function(t,n){var r=new Blob([e]),i=new FileReader;i.readAsDataURL(r),i.onload=function(e){var n;return t(null===(n=e.target)||void 0===n?void 0:n.result)},i.onerror=function(e){return n(e)}}))}(O=k||(k={})).INFER="infer",O.CAMERA="Camera",O.REPORT="report";var C=c((function(){var e=r(h(!1),2),t=e[0],s=e[1],u=i(k.CAMERA),c=r(h(""),2),b=c[0],w=c[1],O=r(h(""),2),C=O[0],P=O[1],A=r(x({}),4),D=A[0],F=A[1],j=A[2],R=A[3],I=r(x({}),3),T=I[0],E=I[1],M=I[2],_=r(x({}),4),L=_[0],B=_[1],z=_[3],W=r(h([]),2),U=W[0],G=W[1],N=r(h([]),2),V=N[0],K=N[1],Y=o((function(){return Boolean(U.value.length)})),$=o((function(){return Boolean(V.value.length)})),X=o((function(){return{infer:L.value,reports:V.value,channels:U.value}})),q=function(){var e=n(regeneratorRuntime.mark((function e(){var t,n,r,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d();case 3:t=e.sent,n=t.data,r=n.infer,i=n.reports,o=n.channels,B(r),K(i),G(o),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),l("error","获取配置失败~");case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),H=function(){var e=n(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f(X.value);case 3:t=e.sent,n=t.status_code,r=t.status_info,l(n,r),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),l("error",JSON.stringify(e.t0));case 12:return e.prev=12,ve(),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,9,12,15]])})));return function(){return e.apply(this,arguments)}}(),Z=function(){var e=n(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y();case 3:t=e.sent,n=t.status_code,r=t.status_info,l(n,r),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),l("error",JSON.stringify(e.t0));case 12:return e.prev=12,ve(),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,9,12,15]])})));return function(){return e.apply(this,arguments)}}(),J=new Map,Q=r(h([]),2),ee=Q[0],te=Q[1],ne=o((function(){return Boolean(ee.value.length)})),re=function(){var e=n(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m();case 3:t=e.sent,n=t.data,te(r=null!=n?n:[]),r.forEach((function(e){return J.set(e.name,e)})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),l("error","获取平台列表失败~");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),ie=new Map,oe=r(h([]),2),ae=oe[0],se=oe[1],ue=o((function(){return Boolean(ae.value.length)})),le=function(){var e=n(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g();case 3:t=e.sent,n=t.data,se(r=null!=n?n:[]),r.forEach((function(e){return ie.set(e.name,e.display)})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),l("error","获取功能组件列表失败~");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),ce=r(h(!1),2),he=ce[0],fe=ce[1];function ve(){return pe.apply(this,arguments)}function pe(){return(pe=n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,fe(!0),e.next=4,Promise.all([q(),le(),re()]);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),l("error","配置初始化失败！");case 9:return e.prev=9,setTimeout((function(){return fe(!1)}),1e3),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[0,6,9,12]])})))).apply(this,arguments)}var de=r(h(Symbol()),2),ye=de[0],me=de[1],ge=r(h(null),2),be=ge[0],we=ge[1],xe=r(h(""),2),ke=xe[0],Oe=xe[1],Se=function(){var e=n(regeneratorRuntime.mark((function e(){var t,n,i,o,a,s,u,c,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[j("name"),j("url")],n=t[0],i=t[1],e.prev=1,fe(!0),l("success","正在加载摄像头预览图片......"),e.next=6,S(i);case 6:return o=e.sent,a=o.split(","),s=r(a,2),u=s[1],Oe(u),e.next=11,v(u);case 11:return c=e.sent,e.next=14,S(c);case 14:h=e.sent,we(h),me(Symbol()),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(1),l("error","加载失败，请核对摄像头 [".concat(n,"] 的推流地址或稍后重试 ~")),we(null);case 23:return e.prev=23,fe(!1),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[1,19,23,26]])})));return function(){return e.apply(this,arguments)}}(),Ce=r(h(null),2),Pe=Ce[0],Ae=Ce[1],De=function(){var e=n(regeneratorRuntime.mark((function e(){var t,n,r,i,o,a,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[ke.value,M("name"),null===(t=M("parameters"))||void 0===t?void 0:t.points],r=n[0],i=n[1],a=void 0===(o=n[2])?[]:o,Boolean(a.length)){e.next=3;break}return e.abrupt("return",Ae(null));case 3:return e.prev=3,fe(!0),l("success","正在加载功能组件预览图片......"),e.next=8,p(r,a);case 8:return s=e.sent,e.next=11,S(s);case 11:u=e.sent,Ae(u),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),l("error","功能组件 [".concat(i,"] 的多边形预览图片加载失败，请拾取坐标或稍后重试 ~")),Ae(null);case 19:return e.prev=19,fe(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[3,15,19,22]])})));return function(){return e.apply(this,arguments)}}();return ve(),{config:X,jsonVisible:t,setJsonVisible:s,loading:he,request:ve,currentActiveConfig:u,handleUpdate:H,handleResetBefore:function(){a.exports.MessageBox.confirm("该操作会重置所有数据为初始状态，请慎重！","警告",{type:"error",cancelButtonText:"取消",confirmButtonText:"确定"}).then(Z).catch((function(){}))},infer:L,setInferValue:z,cameras:U,hasCamera:Y,currentActiveCamera:b,setCurrentActiveCamera:w,currentActiveCameraEntity:D,setCurrentActiveCameraEntity:F,getCurrentActiveCameraEntityValue:j,setCurrentActiveCameraEntityValue:R,fnOptions:ae,hasFnOption:ue,getFnDisplayName:function(e){var t;return null!==(t=ie.get(e))&&void 0!==t?t:e},currentActiveCameraFn:C,setCurrentActiveCameraFn:P,currentActiveCameraFnEntity:T,setCurrentActiveCameraFnEntity:E,reports:V,hasReport:$,reportOptions:ee,hasReportOption:ne,getReportOption:function(e){var t;return null!==(t=J.get(e))&&void 0!==t?t:{}},notify:ye,dispatch:me,cameraImage:be,setCameraImage:we,cameraFnImage:Pe,setCameraFnImage:Ae,requestCameraImage:Se,requestCameraFnImage:De}}));var P={};P.setup=function(e,t){var n=function(){var e=C.serviceDiscovery(),t=e.infer,n=e.setInferValue,r=/^[0-9]*$/;return{infer:t,handleInferGpuInput:function(e){r.test(String(e))&&n("gpu",e)}}}();return{infer:n.infer,handleInferGpuInput:n.handleInferGpuInput}};var A={},D=w(P,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{staticStyle:{width:"30%"},attrs:{shadow:"never"}},[n("el-form",{attrs:{"label-position":"top"}},[n("el-form-item",{attrs:{label:"显卡编号"}},[n("el-input",{attrs:{value:e.infer.gpu},on:{input:e.handleInferGpuInput}})],1),n("el-form-item",{attrs:{label:"置信度阀值"}},[n("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.infer.conf,callback:function(t){e.$set(e.infer,"conf",t)},expression:"infer.conf"}})],1),n("el-form-item",{attrs:{label:"交并比阀值"}},[n("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.infer.iou,callback:function(t){e.$set(e.infer,"iou",t)},expression:"infer.iou"}})],1)],1)],1)}),[],!1,F,null,null,null);function F(e){for(var t in A)this[t]=A[t]}var j=function(){return D.exports}();function R(){var e=C.serviceDiscovery(),t=e.reports,n=e.reportOptions,i=r(h(!1),2),o=i[0],u=i[1],c=r(h({}),2),f=c[0],v=c[1],p=r(h(""),2),d=p[0],y=p[1];s(n,(function(e){if(Boolean(e.length)){var t=r(e,1)[0];v(t),y(t.name)}}));var m=function(e){return t.value.findIndex((function(t){return t.name===e}))};return{visible:o,setVisible:u,selectReport:f,selectReportName:d,handleCreateReport:function(){var e=f.value,n=e.name,r=e.parameters;if(~m(n))return l("error","该平台已添加配置过啦 ~");var i,o={};r.forEach((function(e){return o[e.name]=e.default})),i={name:n,parameters:o},t.value.push(i)},handleRemoveReportBefore:function(e){a.exports.MessageBox.confirm("确定要删除吗？","提示",{type:"info",cancelButtonText:"取消",confirmButtonText:"确定"}).then((function(){return function(e){return t.value.splice(m(e),1)}(e)})).catch((function(){}))}}}var I={setup:function(e,t){var n=R(),r=n.visible,i=n.setVisible,o=n.selectReport,a=n.selectReportName,s=n.handleCreateReport,u=n.handleRemoveReportBefore,l=C.serviceDiscovery();return{visible:r,setVisible:i,selectReport:o,selectReportName:a,handleCreateReport:s,handleRemoveReportBefore:u,reports:l.reports,hasReport:l.hasReport,reportOptions:l.reportOptions,hasReportOption:l.hasReportOption,getReportOption:l.getReportOption}}},T={},E=w(I,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-divider",[n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.setVisible(!0)}}},[e._v("添加平台")])],1),e.hasReport?e._l(e.reports,(function(t,r){return n("el-row",{key:t.name},[n("el-card",{attrs:{shadow:"hover"}},[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("el-alert",{attrs:{type:"success",title:t.name+" - "+e.getReportOption(t.name).display,closable:!1,description:e.getReportOption(t.name).description}}),n("el-button",{staticStyle:{"margin-left":"16px"},attrs:{size:"small",type:"danger",icon:"el-icon-delete"},on:{click:function(n){return e.handleRemoveReportBefore(t.name)}}},[n("span",[e._v("删除")])])],1),n("el-input",{staticStyle:{"margin-top":"16px"},model:{value:t.parameters.base_url,callback:function(n){e.$set(t.parameters,"base_url",n)},expression:"report.parameters.base_url"}})],1),r!==e.reports.length-1?n("el-divider"):e._e()],1)})):n("el-empty",{attrs:{description:"暂未配置云端平台，请点击上方按钮进行添加"}}),n("el-drawer",{attrs:{size:"50%","show-close":!1,visible:e.visible},on:{"update:visible":function(t){e.visible=t}},scopedSlots:e._u([{key:"title",fn:function(){return[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[n("i",{staticClass:"m-r-8 el-icon-view"}),n("span",[e._v("云端平台列表及介绍")])]),n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreateReport}},[e._v("确定添加")])],1)]},proxy:!0}])},[e.hasReportOption?[n("el-tabs",{model:{value:e.selectReportName,callback:function(t){e.selectReportName=t},expression:"selectReportName"}},e._l(e.reportOptions,(function(t){return n("el-tab-pane",{key:t.name,attrs:{name:t.name,label:t.display}},[n("el-alert",{attrs:{type:"warning",title:e.selectReport.name,description:e.selectReport.description,closable:!1}}),e._l(e.selectReport.parameters,(function(t){return n("el-row",{key:t.name},[n("el-divider",[e._v(e._s(t.display))]),n("el-alert",{attrs:{type:"info",closable:!1,description:t.description},scopedSlots:e._u([{key:"title",fn:function(){return[n("el-tooltip",{attrs:{content:"字段",placement:"top"}},[n("el-tag",{staticStyle:{"margin-right":"16px"},attrs:{size:"small",effect:"dark",type:"success"}},[e._v(e._s(t.name))])],1),n("el-tooltip",{attrs:{content:"类型",placement:"top"}},[n("el-tag",{staticStyle:{"margin-right":"16px"},attrs:{size:"small",effect:"dark",type:"warning"}},[e._v(e._s(t.type))])],1),n("el-tooltip",{attrs:{content:"默认值",placement:"top"}},[n("el-tag",{attrs:{size:"small",effect:"dark"}},[e._v(e._s(t.default))])],1)]},proxy:!0}],null,!0)})],1)}))],2)})),1)]:n("el-empty",{attrs:{description:"暂无云端平台配置数据，请先在服务端添加配置"}})],2)],2)}),[],!1,M,null,null,null);function M(e){for(var t in T)this[t]=T[t]}var _=function(){return E.exports}();var L=c((function(){var e=C.serviceDiscovery(),t=e.cameras,n=e.currentActiveCamera,i=e.setCameraImage,u=e.setCurrentActiveCamera,l=e.setCurrentActiveCameraEntity,c=e.setCurrentActiveCameraEntityValue,f=e.setCurrentActiveCameraFnEntity,v=e.requestCameraImage,p={searchCamera:function(e){return t.value.find((function(t){return t.name===e}))},removeCamera:function(e){return t.value.splice(p.searchCameraPosition(e),1)},createCamera:function(e){return t.value.push(e)},searchCameraPosition:function(e){return t.value.findIndex((function(t){return t.name===e}))}},d=r(h("INIT"),2),y=d[0],m=d[1];s(t,(function(e){if(Boolean(e.length))switch(y.value){case"INIT":var t=e[0];u(t.name);break;case"CREATE":var n=e[e.length-1];u(n.name)}}),{deep:!0});var g=r(h([]),2),b=g[0],w=g[1],x=o((function(){return Boolean(b.value.length)}));s(n,(function(e){f({});var t=p.searchCamera(e);if(t)switch(w(t.functions),l(t),y.value){case"INIT":case"TOGGLE":v();break;case"CREATE":m("TOGGLE"),i(null);break;case"REMOVE":m("TOGGLE"),v()}}));var k=new RegExp("[`~!@#$^&*()=|·{}':;'\",\\[\\].<>/?~！@#￥+《》%……&*（）—|{}【】‘；：”“'。\\\\，、？]");return{cameraFns:b,hasCameraFn:x,handleCreateCamera:function(){m("CREATE"),a.exports.MessageBox.prompt("请填写摄像头名称","提示",{cancelButtonText:"取消",inputPlaceholder:"请填写摄像头名称，不能包含特殊字符",confirmButtonText:"确定",inputValidator:function(e){return e&&Boolean(e.length)?k.test(e)||e.includes(" ")?"摄像头名称不能包含特殊字符":!p.searchCamera(e)||"该摄像头已经存在":"请输入摄像头名称"}}).then((function(e){var t=e.value;p.createCamera({name:t,url:"",functions:[]})})).catch((function(){}))},handleRemoveCamera:function(e){m("REMOVE"),n.value===e&&t.value.forEach((function(n,r){if(n.name===e){var i=t.value[r+1]||t.value[r-1];i&&u(i.name)}})),p.removeCamera(e)},handleCameraUrlInput:function(e){m("INPUT"),c("url",e)},handleTabBeforeLeave:function(){return"CREATE"!==y.value&&m("TOGGLE"),!0}}})),B={exports:{}};B.exports=function(){function t(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(r,i)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=e.apply(n,r);function s(e){t(a,i,o,s,u,"next",e)}function u(e){t(a,i,o,s,u,"throw",e)}s(void 0)}))}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==u?u:"undefined"!=typeof self?self:{},l={exports:{}};!function(t){var n=function(t){var n,r=Object.prototype,i=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(T){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof m?t:m,o=Object.create(i.prototype),a=new j(r||[]);return o._invoke=P(e,n,a),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(T){return{type:"throw",arg:T}}}t.wrap=c;var f="suspendedStart",v="suspendedYield",p="executing",d="completed",y={};function m(){}function g(){}function b(){}var w={};l(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(R([])));k&&k!==r&&i.call(k,a)&&(w=k);var O=b.prototype=m.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function C(t,n){function r(o,a,s,u){var l=h(t[o],t,a);if("throw"!==l.type){var c=l.arg,f=c.value;return f&&"object"===e(f)&&i.call(f,"__await")?n.resolve(f.__await).then((function(e){r("next",e,s,u)}),(function(e){r("throw",e,s,u)})):n.resolve(f).then((function(e){c.value=e,s(c)}),(function(e){return r("throw",e,s,u)}))}u(l.arg)}var o;function a(e,t){function i(){return new n((function(n,i){r(e,t,n,i)}))}return o=o?o.then(i,i):i()}this._invoke=a}function P(e,t,n){var r=f;return function(i,o){if(r===p)throw new Error("Generator is already running");if(r===d){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=A(a,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var u=h(e,t,n);if("normal"===u.type){if(r=n.done?d:v,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=d,n.method="throw",n.arg=u.arg)}}}function A(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,A(e,t),"throw"===t.method))return y;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var i=h(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,y;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,y):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,y)}function D(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function F(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(D,this),this.reset(!0)}function R(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return o.next=o}}return{next:I}}function I(){return{value:n,done:!0}}return g.prototype=b,l(O,"constructor",b),l(b,"constructor",g),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(C.prototype),l(C.prototype,s,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new C(c(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),l(O,u,"Generator"),l(O,a,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=R,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(F),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),F(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;F(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),y}},t}(t.exports);try{regeneratorRuntime=n}catch(r){"object"===("undefined"==typeof globalThis?"undefined":e(globalThis))?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}(l);var c,h=l.exports,f={exports:{}},v="object"===("undefined"==typeof Reflect?"undefined":e(Reflect))?Reflect:null,p=v&&"function"==typeof v.apply?v.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};function d(e){console&&console.warn}c=v&&"function"==typeof v.ownKeys?v.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var y=Number.isNaN||function(e){return e!=e};function m(){m.init.call(this)}f.exports=m,f.exports.once=F,m.EventEmitter=m,m.prototype._events=void 0,m.prototype._eventsCount=0,m.prototype._maxListeners=void 0;var g=10;function b(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+e(t))}function w(e){return void 0===e._maxListeners?m.defaultMaxListeners:e._maxListeners}function x(e,t,n,r){var i,o,a;if(b(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=w(e))>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,d(s)}return e}function k(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function O(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=k.bind(r);return i.listener=n,r.wrapFn=i,i}function S(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?D(i):P(i,i.length)}function C(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function P(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function A(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function D(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function F(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}R(e,t,o,{once:!0}),"error"!==t&&j(e,i,{once:!0})}))}function j(e,t,n){"function"==typeof e.on&&R(e,"error",t,n)}function R(t,n,r,i){if("function"==typeof t.on)i.once?t.once(n,r):t.on(n,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+e(t));t.addEventListener(n,(function e(o){i.once&&t.removeEventListener(n,e),r(o)}))}}Object.defineProperty(m,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(e){if("number"!=typeof e||e<0||y(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");g=e}}),m.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},m.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||y(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},m.prototype.getMaxListeners=function(){return w(this)},m.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var s=i[e];if(void 0===s)return!1;if("function"==typeof s)p(s,this,t);else{var u=s.length,l=P(s,u);for(n=0;n<u;++n)p(l[n],this,t)}return!0},m.prototype.addListener=function(e,t){return x(this,e,t,!1)},m.prototype.on=m.prototype.addListener,m.prototype.prependListener=function(e,t){return x(this,e,t,!0)},m.prototype.once=function(e,t){return b(t),this.on(e,O(this,e,t)),this},m.prototype.prependOnceListener=function(e,t){return b(t),this.prependListener(e,O(this,e,t)),this},m.prototype.removeListener=function(e,t){var n,r,i,o,a;if(b(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():A(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},m.prototype.off=m.prototype.removeListener,m.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},m.prototype.listeners=function(e){return S(this,e,!0)},m.prototype.rawListeners=function(e){return S(this,e,!1)},m.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):C.call(e,t)},m.prototype.listenerCount=C,m.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]};var I=f.exports,T="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;
/*!
         * hotkeys-js v3.8.7
         * A simple micro-library for defining and dispatching keyboard shortcuts. It has no dependencies.
         * 
         * Copyright (c) 2021 kenny wong <wowohoo@qq.com>
         * http://jaywcjlove.github.io/hotkeys
         * 
         * Licensed under the MIT license.
         */function E(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on".concat(t),(function(){n(window.event)}))}function M(e,t){for(var n=t.slice(0,t.length-1),r=0;r<n.length;r++)n[r]=e[n[r].toLowerCase()];return n}function _(e){"string"!=typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function L(e,t){for(var n=e.length>=t.length?e:t,r=e.length>=t.length?t:e,i=!0,o=0;o<n.length;o++)-1===r.indexOf(n[o])&&(i=!1);return i}for(var B={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":T?173:189,"=":T?61:187,";":T?59:186,"'":222,"[":219,"]":221,"\\":220},z={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},W={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},U={16:!1,18:!1,17:!1,91:!1},G={},N=1;N<20;N++)B["f".concat(N)]=111+N;var V=[],K="all",Y=[],$=function(e){return B[e.toLowerCase()]||z[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function X(e){K=e||"all"}function q(){return K||"all"}function H(){return V.slice(0)}function Z(e){var t=e.target||e.srcElement,n=t.tagName,r=!0;return!t.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||t.readOnly)||(r=!1),r}function J(e){return"string"==typeof e&&(e=$(e)),-1!==V.indexOf(e)}function Q(e,t){var n,r;for(var i in e||(e=q()),G)if(Object.prototype.hasOwnProperty.call(G,i))for(n=G[i],r=0;r<n.length;)n[r].scope===e?n.splice(r,1):r++;q()===e&&X(t||"all")}function ee(e){var t=e.keyCode||e.which||e.charCode,n=V.indexOf(t);if(n>=0&&V.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&V.splice(0,V.length),93!==t&&224!==t||(t=91),t in U)for(var r in U[t]=!1,z)z[r]===t&&(ae[r]=!1)}function te(t){if(t){if(Array.isArray(t))t.forEach((function(e){e.key&&ne(e)}));else if("object"===e(t))t.key&&ne(t);else if("string"==typeof t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=r[0],a=r[1];"function"==typeof o&&(a=o,o=""),ne({key:t,scope:o,method:a,splitKey:"+"})}}else Object.keys(G).forEach((function(e){return delete G[e]}))}var ne=function(e){var t=e.key,n=e.scope,r=e.method,i=e.splitKey,o=void 0===i?"+":i;_(t).forEach((function(e){var t=e.split(o),i=t.length,a=t[i-1],s="*"===a?"*":$(a);if(G[s]){n||(n=q());var u=i>1?M(z,t):[];G[s]=G[s].map((function(e){return r&&e.method!==r||e.scope!==n||!L(e.mods,u)?e:{}}))}}))};function re(e,t,n){var r;if(t.scope===n||"all"===t.scope){for(var i in r=t.mods.length>0,U)Object.prototype.hasOwnProperty.call(U,i)&&(!U[i]&&t.mods.indexOf(+i)>-1||U[i]&&-1===t.mods.indexOf(+i))&&(r=!1);(0!==t.mods.length||U[16]||U[18]||U[17]||U[91])&&!r&&"*"!==t.shortcut||!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function ie(e){var t=G["*"],n=e.keyCode||e.which||e.charCode;if(ae.filter.call(this,e)){if(93!==n&&224!==n||(n=91),-1===V.indexOf(n)&&229!==n&&V.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach((function(t){var n=W[t];e[t]&&-1===V.indexOf(n)?V.push(n):!e[t]&&V.indexOf(n)>-1?V.splice(V.indexOf(n),1):"metaKey"===t&&e[t]&&3===V.length&&(e.ctrlKey||e.shiftKey||e.altKey||(V=V.slice(V.indexOf(n))))})),n in U){for(var r in U[n]=!0,z)z[r]===n&&(ae[r]=!0);if(!t)return}for(var i in U)Object.prototype.hasOwnProperty.call(U,i)&&(U[i]=e[W[i]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===V.indexOf(17)&&V.push(17),-1===V.indexOf(18)&&V.push(18),U[17]=!0,U[18]=!0);var o=q();if(t)for(var a=0;a<t.length;a++)t[a].scope===o&&("keydown"===e.type&&t[a].keydown||"keyup"===e.type&&t[a].keyup)&&re(e,t[a],o);if(n in G)for(var s=0;s<G[n].length;s++)if(("keydown"===e.type&&G[n][s].keydown||"keyup"===e.type&&G[n][s].keyup)&&G[n][s].key){for(var u=G[n][s],l=u.splitKey,c=u.key.split(l),h=[],f=0;f<c.length;f++)h.push($(c[f]));h.sort().join("")===V.sort().join("")&&re(e,u,o)}}}function oe(e){return Y.indexOf(e)>-1}function ae(e,t,n){V=[];var r=_(e),i=[],o="all",a=document,s=0,u=!1,l=!0,c="+";for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(o=t.scope),t.element&&(a=t.element),t.keyup&&(u=t.keyup),void 0!==t.keydown&&(l=t.keydown),"string"==typeof t.splitKey&&(c=t.splitKey)),"string"==typeof t&&(o=t);s<r.length;s++)i=[],(e=r[s].split(c)).length>1&&(i=M(z,e)),(e="*"===(e=e[e.length-1])?"*":$(e))in G||(G[e]=[]),G[e].push({keyup:u,keydown:l,scope:o,mods:i,shortcut:r[s],method:n,key:r[s],splitKey:c});void 0!==a&&!oe(a)&&window&&(Y.push(a),E(a,"keydown",(function(e){ie(e)})),E(window,"focus",(function(){V=[]})),E(a,"keyup",(function(e){ie(e),ee(e)})))}var se={setScope:X,getScope:q,deleteScope:Q,getPressedKeyCodes:H,isPressed:J,filter:Z,unbind:te};for(var ue in se)Object.prototype.hasOwnProperty.call(se,ue)&&(ae[ue]=se[ue]);if("undefined"!=typeof window){var le=window.hotkeys;ae.noConflict=function(e){return e&&window.hotkeys===ae&&(window.hotkeys=le),ae},window.hotkeys=ae}var ce="object"==e(s)&&s&&s.Object===Object&&s,he=ce,fe="object"==("undefined"==typeof self?"undefined":e(self))&&self&&self.Object===Object&&self,ve=he||fe||Function("return this")(),pe=ve.Symbol,de=pe,ye=Object.prototype,me=ye.hasOwnProperty,ge=ye.toString,be=de?de.toStringTag:void 0;function we(e){var t=me.call(e,be),n=e[be];try{e[be]=void 0;var r=!0}catch(o){}var i=ge.call(e);return r&&(t?e[be]=n:delete e[be]),i}var xe=we,ke=Object.prototype.toString;function Oe(e){return ke.call(e)}var Se=pe,Ce=xe,Pe=Oe,Ae="[object Null]",De="[object Undefined]",Fe=Se?Se.toStringTag:void 0;function je(e){return null==e?void 0===e?De:Ae:Fe&&Fe in Object(e)?Ce(e):Pe(e)}var Re=je;function Ie(t){var n=e(t);return null!=t&&("object"==n||"function"==n)}var Te=Ie,Ee=Re,Me=Te,_e="[object AsyncFunction]",Le="[object Function]",Be="[object GeneratorFunction]",ze="[object Proxy]";function We(e){if(!Me(e))return!1;var t=Ee(e);return t==Le||t==Be||t==_e||t==ze}var Ue,Ge=We,Ne=ve["__core-js_shared__"],Ve=(Ue=/[^.]+$/.exec(Ne&&Ne.keys&&Ne.keys.IE_PROTO||""))?"Symbol(src)_1."+Ue:"";function Ke(e){return!!Ve&&Ve in e}var Ye=Ke,$e=Function.prototype.toString;function Xe(e){if(null!=e){try{return $e.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var qe=Xe,He=Ge,Ze=Ye,Je=Te,Qe=qe,et=/[\\^$.*+?()[\]{}|]/g,tt=/^\[object .+?Constructor\]$/,nt=Function.prototype,rt=Object.prototype,it=nt.toString,ot=rt.hasOwnProperty,at=RegExp("^"+it.call(ot).replace(et,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function st(e){return!(!Je(e)||Ze(e))&&(He(e)?at:tt).test(Qe(e))}function ut(e,t){return null==e?void 0:e[t]}var lt=st,ct=ut;function ht(e,t){var n=ct(e,t);return lt(n)?n:void 0}var ft=ht,vt=ft,pt=function(){try{var e=vt(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),dt=pt;function yt(e,t,n){"__proto__"==t&&dt?dt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var mt=yt;function gt(e,t){return e===t||e!=e&&t!=t}var bt=gt,wt=mt,xt=bt,kt=Object.prototype.hasOwnProperty;function Ot(e,t,n){var r=e[t];kt.call(e,t)&&xt(r,n)&&(void 0!==n||t in e)||wt(e,t,n)}var St=Ot,Ct=St,Pt=mt;function At(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],u=r?r(n[s],e[s],s,n,e):void 0;void 0===u&&(u=e[s]),i?Pt(n,s,u):Ct(n,s,u)}return n}var Dt=At;function Ft(e){return e}var jt=Ft;function Rt(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var It=Rt,Tt=Math.max;function Et(e,t,n){return t=Tt(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=Tt(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(a),It(e,this,s)}}var Mt=Et;function _t(e){return function(){return e}}var Lt=_t,Bt=pt,zt=jt,Wt=Bt?function(e,t){return Bt(e,"toString",{configurable:!0,enumerable:!1,value:Lt(t),writable:!0})}:zt,Ut=800,Gt=16,Nt=Date.now;function Vt(e){var t=0,n=0;return function(){var r=Nt(),i=Gt-(r-n);if(n=r,i>0){if(++t>=Ut)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var Kt=Vt(Wt),Yt=jt,$t=Mt,Xt=Kt;function qt(e,t){return Xt($t(e,t,Yt),e+"")}var Ht=9007199254740991;function Zt(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Ht}var Jt=Zt,Qt=Ge,en=Jt;function tn(e){return null!=e&&en(e.length)&&!Qt(e)}var nn=tn,rn=9007199254740991,on=/^(?:0|[1-9]\d*)$/;function an(t,n){var r=e(t);return!!(n=null==n?rn:n)&&("number"==r||"symbol"!=r&&on.test(t))&&t>-1&&t%1==0&&t<n}var sn=an,un=bt,ln=nn,cn=sn,hn=Te;function fn(t,n,r){if(!hn(r))return!1;var i=e(n);return!!("number"==i?ln(r)&&cn(n,r.length):"string"==i&&n in r)&&un(r[n],t)}var vn=qt,pn=fn;function dn(e){return vn((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&pn(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var s=n[r];s&&e(t,s,r,o)}return t}))}var yn=dn,mn=Object.prototype;function gn(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||mn)}var bn=gn;function wn(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var xn=wn;function kn(t){return null!=t&&"object"==e(t)}var On=kn,Sn=Re,Cn=On,Pn="[object Arguments]";function An(e){return Cn(e)&&Sn(e)==Pn}var Dn=An,Fn=On,jn=Object.prototype,Rn=jn.hasOwnProperty,In=jn.propertyIsEnumerable,Tn=Dn(function(){return arguments}())?Dn:function(e){return Fn(e)&&Rn.call(e,"callee")&&!In.call(e,"callee")},En=Tn,Mn=Array.isArray,_n={exports:{}};function Ln(){return!1}var Bn=Ln;!function(e,t){var n=ve,r=Bn,i=t&&!t.nodeType&&t,o=i&&e&&!e.nodeType&&e,a=o&&o.exports===i?n.Buffer:void 0,s=(a?a.isBuffer:void 0)||r;e.exports=s}(_n,_n.exports);var zn=Re,Wn=Jt,Un=On,Gn="[object Arguments]",Nn="[object Array]",Vn="[object Boolean]",Kn="[object Date]",Yn="[object Error]",$n="[object Function]",Xn="[object Map]",qn="[object Number]",Hn="[object Object]",Zn="[object RegExp]",Jn="[object Set]",Qn="[object String]",er="[object WeakMap]",tr="[object ArrayBuffer]",nr="[object DataView]",rr="[object Float64Array]",ir="[object Int8Array]",or="[object Int16Array]",ar="[object Int32Array]",sr="[object Uint8Array]",ur="[object Uint8ClampedArray]",lr="[object Uint16Array]",cr="[object Uint32Array]",hr={};function fr(e){return Un(e)&&Wn(e.length)&&!!hr[zn(e)]}hr["[object Float32Array]"]=hr[rr]=hr[ir]=hr[or]=hr[ar]=hr[sr]=hr[ur]=hr[lr]=hr[cr]=!0,hr[Gn]=hr[Nn]=hr[tr]=hr[Vn]=hr[nr]=hr[Kn]=hr[Yn]=hr[$n]=hr[Xn]=hr[qn]=hr[Hn]=hr[Zn]=hr[Jn]=hr[Qn]=hr[er]=!1;var vr=fr;function pr(e){return function(t){return e(t)}}var dr=pr,yr={exports:{}};!function(e,t){var n=ce,r=t&&!t.nodeType&&t,i=r&&e&&!e.nodeType&&e,o=i&&i.exports===r&&n.process,a=function(){try{var e=i&&i.require&&i.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(t){}}();e.exports=a}(yr,yr.exports);var mr=vr,gr=dr,br=yr.exports,wr=br&&br.isTypedArray,xr=wr?gr(wr):mr,kr=xn,Or=En,Sr=Mn,Cr=_n.exports,Pr=sn,Ar=xr,Dr=Object.prototype.hasOwnProperty;function Fr(e,t){var n=Sr(e),r=!n&&Or(e),i=!n&&!r&&Cr(e),o=!n&&!r&&!i&&Ar(e),a=n||r||i||o,s=a?kr(e.length,String):[],u=s.length;for(var l in e)!t&&!Dr.call(e,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Pr(l,u))||s.push(l);return s}var jr=Fr;function Rr(e,t){return function(n){return e(t(n))}}var Ir=Rr,Tr=Ir(Object.keys,Object),Er=bn,Mr=Tr,_r=Object.prototype.hasOwnProperty;function Lr(e){if(!Er(e))return Mr(e);var t=[];for(var n in Object(e))_r.call(e,n)&&"constructor"!=n&&t.push(n);return t}var Br=jr,zr=Lr,Wr=nn;function Ur(e){return Wr(e)?Br(e):zr(e)}var Gr=Ur,Nr=St,Vr=Dt,Kr=yn,Yr=nn,$r=bn,Xr=Gr,qr=Object.prototype.hasOwnProperty,Hr=Kr((function(e,t){if($r(t)||Yr(t))Vr(t,Xr(t),e);else for(var n in t)qr.call(t,n)&&Nr(e,n,t[n])}));function Zr(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var Jr=Zr,Qr=Re,ei=On,ti="[object Symbol]";function ni(t){return"symbol"==e(t)||ei(t)&&Qr(t)==ti}var ri=ni,ii=pe,oi=Jr,ai=Mn,si=ri,ui=1/0,li=ii?ii.prototype:void 0,ci=li?li.toString:void 0;function hi(e){if("string"==typeof e)return e;if(ai(e))return oi(e,hi)+"";if(si(e))return ci?ci.call(e):"";var t=e+"";return"0"==t&&1/e==-ui?"-0":t}var fi=hi;function vi(e){return null==e?"":fi(e)}var pi=vi,di=pi,yi=0;function mi(e){var t=++yi;return di(e)+t}var gi=mi;function bi(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}var wi=bi;function xi(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var u=a[e?s:++i];if(!1===n(o[u],u,o))break}return t}}var ki=xi(),Oi=Gr;function Si(e,t){return e&&ki(e,t,Oi)}var Ci=nn;function Pi(e,t){return function(n,r){if(null==n)return n;if(!Ci(n))return e(n,r);for(var i=n.length,o=t?i:-1,a=Object(n);(t?o--:++o<i)&&!1!==r(a[o],o,a););return n}}var Ai=Pi(Si),Di=jt;function Fi(e){return"function"==typeof e?e:Di}var ji=wi,Ri=Ai,Ii=Fi,Ti=Mn;function Ei(e,t){return(Ti(e)?ji:Ri)(e,Ii(t))}var Mi=Ei,_i=Mn,Li=ri,Bi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,zi=/^\w*$/;function Wi(t,n){if(_i(t))return!1;var r=e(t);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!Li(t))||zi.test(t)||!Bi.test(t)||null!=n&&t in Object(n)}var Ui=Wi,Gi=ft(Object,"create"),Ni=Gi;function Vi(){this.__data__=Ni?Ni(null):{},this.size=0}var Ki=Vi;function Yi(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var $i=Yi,Xi=Gi,qi="__lodash_hash_undefined__",Hi=Object.prototype.hasOwnProperty;function Zi(e){var t=this.__data__;if(Xi){var n=t[e];return n===qi?void 0:n}return Hi.call(t,e)?t[e]:void 0}var Ji=Zi,Qi=Gi,eo=Object.prototype.hasOwnProperty;function to(e){var t=this.__data__;return Qi?void 0!==t[e]:eo.call(t,e)}var no=Gi,ro="__lodash_hash_undefined__";function io(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=no&&void 0===t?ro:t,this}var oo=Ki,ao=$i,so=Ji,uo=to,lo=io;function co(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}co.prototype.clear=oo,co.prototype.delete=ao,co.prototype.get=so,co.prototype.has=uo,co.prototype.set=lo;var ho=co;function fo(){this.__data__=[],this.size=0}var vo=fo,po=bt;function yo(e,t){for(var n=e.length;n--;)if(po(e[n][0],t))return n;return-1}var mo=yo,go=mo,bo=Array.prototype.splice;function wo(e){var t=this.__data__,n=go(t,e);return!(n<0||(n==t.length-1?t.pop():bo.call(t,n,1),--this.size,0))}var xo=mo;function ko(e){var t=this.__data__,n=xo(t,e);return n<0?void 0:t[n][1]}var Oo=mo;function So(e){return Oo(this.__data__,e)>-1}var Co=mo;function Po(e,t){var n=this.__data__,r=Co(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}var Ao=vo,Do=wo,Fo=ko,jo=So,Ro=Po;function Io(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Io.prototype.clear=Ao,Io.prototype.delete=Do,Io.prototype.get=Fo,Io.prototype.has=jo,Io.prototype.set=Ro;var To=Io,Eo=ft(ve,"Map"),Mo=ho,_o=To,Lo=Eo;function Bo(){this.size=0,this.__data__={hash:new Mo,map:new(Lo||_o),string:new Mo}}function zo(t){var n=e(t);return"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t}var Wo=zo;function Uo(e,t){var n=e.__data__;return Wo(t)?n["string"==typeof t?"string":"hash"]:n.map}var Go=Uo;function No(e){var t=Go(this,e).delete(e);return this.size-=t?1:0,t}var Vo=Uo;function Ko(e){return Vo(this,e).get(e)}var Yo=Uo;function $o(e){return Yo(this,e).has(e)}var Xo=Uo;function qo(e,t){var n=Xo(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}var Ho=Bo,Zo=No,Jo=Ko,Qo=$o,ea=qo;function ta(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ta.prototype.clear=Ho,ta.prototype.delete=Zo,ta.prototype.get=Jo,ta.prototype.has=Qo,ta.prototype.set=ea;var na=ta,ra=na,ia="Expected a function";function oa(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(ia);var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(oa.Cache||ra),n}oa.Cache=ra;var aa=oa,sa=500;function ua(e){var t=aa(e,(function(e){return n.size===sa&&n.clear(),e})),n=t.cache;return t}var la=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ca=/\\(\\)?/g,ha=ua((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(la,(function(e,n,r,i){t.push(r?i.replace(ca,"$1"):n||e)})),t})),fa=Mn,va=Ui,pa=ha,da=pi;function ya(e,t){return fa(e)?e:va(e,t)?[e]:pa(da(e))}var ma=ya,ga=ri,ba=1/0;function wa(e){if("string"==typeof e||ga(e))return e;var t=e+"";return"0"==t&&1/e==-ba?"-0":t}var xa=wa,ka=ma,Oa=xa;function Sa(e,t){for(var n=0,r=(t=ka(t,e)).length;null!=e&&n<r;)e=e[Oa(t[n++])];return n&&n==r?e:void 0}var Ca=Sa,Pa=Ca;function Aa(e,t,n){var r=null==e?void 0:Pa(e,t);return void 0===r?n:r}var Da=Aa,Fa=Re,ja=On,Ra="[object Number]";function Ia(e){return"number"==typeof e||ja(e)&&Fa(e)==Ra}var Ta=Ia,Ea=To;function Ma(){this.__data__=new Ea,this.size=0}function _a(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function La(e){return this.__data__.get(e)}function Ba(e){return this.__data__.has(e)}var za=To,Wa=Eo,Ua=na,Ga=200;function Na(e,t){var n=this.__data__;if(n instanceof za){var r=n.__data__;if(!Wa||r.length<Ga-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ua(r)}return n.set(e,t),this.size=n.size,this}var Va=To,Ka=Ma,Ya=_a,$a=La,Xa=Ba,qa=Na;function Ha(e){var t=this.__data__=new Va(e);this.size=t.size}Ha.prototype.clear=Ka,Ha.prototype.delete=Ya,Ha.prototype.get=$a,Ha.prototype.has=Xa,Ha.prototype.set=qa;var Za=Ha,Ja=Dt,Qa=Gr;function es(e,t){return e&&Ja(t,Qa(t),e)}var ts=es;function ns(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}var rs=Te,is=bn,os=ns,as=Object.prototype.hasOwnProperty;function ss(e){if(!rs(e))return os(e);var t=is(e),n=[];for(var r in e)("constructor"!=r||!t&&as.call(e,r))&&n.push(r);return n}var us=jr,ls=ss,cs=nn;function hs(e){return cs(e)?us(e,!0):ls(e)}var fs=hs,vs=Dt,ps=fs;function ds(e,t){return e&&vs(t,ps(t),e)}var ys=ds,ms={exports:{}};function gs(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}!function(e,t){var n=ve,r=t&&!t.nodeType&&t,i=r&&e&&!e.nodeType&&e,o=i&&i.exports===r?n.Buffer:void 0,a=o?o.allocUnsafe:void 0;function s(e,t){if(t)return e.slice();var n=e.length,r=a?a(n):new e.constructor(n);return e.copy(r),r}e.exports=s}(ms,ms.exports);var bs=gs;function ws(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}var xs=ws;function ks(){return[]}var Os=ks,Ss=xs,Cs=Os,Ps=Object.prototype.propertyIsEnumerable,As=Object.getOwnPropertySymbols,Ds=As?function(e){return null==e?[]:(e=Object(e),Ss(As(e),(function(t){return Ps.call(e,t)})))}:Cs,Fs=Dt,js=Ds;function Rs(e,t){return Fs(e,js(e),t)}var Is=Rs;function Ts(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Es=Ts,Ms=Ir(Object.getPrototypeOf,Object),_s=Es,Ls=Ms,Bs=Ds,zs=Os,Ws=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)_s(t,Bs(e)),e=Ls(e);return t}:zs,Us=Dt,Gs=Ws;function Ns(e,t){return Us(e,Gs(e),t)}var Vs=Ns,Ks=Es,Ys=Mn;function $s(e,t,n){var r=t(e);return Ys(e)?r:Ks(r,n(e))}var Xs=$s,qs=Ds,Hs=Gr;function Zs(e){return Xs(e,Hs,qs)}var Js=Zs,Qs=$s,eu=Ws,tu=fs;function nu(e){return Qs(e,tu,eu)}var ru=nu,iu=ft(ve,"DataView"),ou=ft(ve,"Promise"),au=ft(ve,"Set"),su=ft(ve,"WeakMap"),uu=iu,lu=Eo,cu=ou,hu=au,fu=su,vu=Re,pu=qe,du="[object Map]",yu="[object Object]",mu="[object Promise]",gu="[object Set]",bu="[object WeakMap]",wu="[object DataView]",xu=pu(uu),ku=pu(lu),Ou=pu(cu),Su=pu(hu),Cu=pu(fu),Pu=vu;(uu&&Pu(new uu(new ArrayBuffer(1)))!=wu||lu&&Pu(new lu)!=du||cu&&Pu(cu.resolve())!=mu||hu&&Pu(new hu)!=gu||fu&&Pu(new fu)!=bu)&&(Pu=function(e){var t=vu(e),n=t==yu?e.constructor:void 0,r=n?pu(n):"";if(r)switch(r){case xu:return wu;case ku:return du;case Ou:return mu;case Su:return gu;case Cu:return bu}return t});var Au=Pu,Du=Object.prototype.hasOwnProperty;function Fu(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Du.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var ju=Fu,Ru=ve.Uint8Array,Iu=Ru;function Tu(e){var t=new e.constructor(e.byteLength);return new Iu(t).set(new Iu(e)),t}var Eu=Tu,Mu=Eu;function _u(e,t){var n=t?Mu(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var Lu=_u,Bu=/\w*$/;function zu(e){var t=new e.constructor(e.source,Bu.exec(e));return t.lastIndex=e.lastIndex,t}var Wu=zu,Uu=pe,Gu=Uu?Uu.prototype:void 0,Nu=Gu?Gu.valueOf:void 0;function Vu(e){return Nu?Object(Nu.call(e)):{}}var Ku=Eu;function Yu(e,t){var n=t?Ku(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var $u=Eu,Xu=Lu,qu=Wu,Hu=Vu,Zu=Yu,Ju="[object Boolean]",Qu="[object Date]",el="[object Map]",tl="[object Number]",nl="[object RegExp]",rl="[object Set]",il="[object String]",ol="[object Symbol]",al="[object ArrayBuffer]",sl="[object DataView]",ul="[object Float32Array]",ll="[object Float64Array]",cl="[object Int8Array]",hl="[object Int16Array]",fl="[object Int32Array]",vl="[object Uint8Array]",pl="[object Uint8ClampedArray]",dl="[object Uint16Array]",yl="[object Uint32Array]";function ml(e,t,n){var r=e.constructor;switch(t){case al:return $u(e);case Ju:case Qu:return new r(+e);case sl:return Xu(e,n);case ul:case ll:case cl:case hl:case fl:case vl:case pl:case dl:case yl:return Zu(e,n);case el:return new r;case tl:case il:return new r(e);case nl:return qu(e);case rl:return new r;case ol:return Hu(e)}}var gl=ml,bl=Te,wl=Object.create,xl=function(){function e(){}return function(t){if(!bl(t))return{};if(wl)return wl(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}(),kl=Ms,Ol=bn;function Sl(e){return"function"!=typeof e.constructor||Ol(e)?{}:xl(kl(e))}var Cl=Sl,Pl=Au,Al=On,Dl="[object Map]";function Fl(e){return Al(e)&&Pl(e)==Dl}var jl=Fl,Rl=dr,Il=yr.exports,Tl=Il&&Il.isMap,El=Tl?Rl(Tl):jl,Ml=Au,_l=On,Ll="[object Set]";function Bl(e){return _l(e)&&Ml(e)==Ll}var zl=Bl,Wl=dr,Ul=yr.exports,Gl=Ul&&Ul.isSet,Nl=Gl?Wl(Gl):zl,Vl=Za,Kl=wi,Yl=St,$l=ts,Xl=ys,ql=ms.exports,Hl=bs,Zl=Is,Jl=Vs,Ql=Js,ec=ru,tc=Au,nc=ju,rc=gl,ic=Cl,oc=Mn,ac=_n.exports,sc=El,uc=Te,lc=Nl,cc=Gr,hc=fs,fc=1,vc=2,pc=4,dc="[object Arguments]",yc="[object Array]",mc="[object Boolean]",gc="[object Date]",bc="[object Error]",wc="[object Function]",xc="[object GeneratorFunction]",kc="[object Map]",Oc="[object Number]",Sc="[object Object]",Cc="[object RegExp]",Pc="[object Set]",Ac="[object String]",Dc="[object Symbol]",Fc="[object WeakMap]",jc="[object ArrayBuffer]",Rc="[object DataView]",Ic="[object Float32Array]",Tc="[object Float64Array]",Ec="[object Int8Array]",Mc="[object Int16Array]",_c="[object Int32Array]",Lc="[object Uint8Array]",Bc="[object Uint8ClampedArray]",zc="[object Uint16Array]",Wc="[object Uint32Array]",Uc={};function Gc(e,t,n,r,i,o){var a,s=t&fc,u=t&vc,l=t&pc;if(n&&(a=i?n(e,r,i,o):n(e)),void 0!==a)return a;if(!uc(e))return e;var c=oc(e);if(c){if(a=nc(e),!s)return Hl(e,a)}else{var h=tc(e),f=h==wc||h==xc;if(ac(e))return ql(e,s);if(h==Sc||h==dc||f&&!i){if(a=u||f?{}:ic(e),!s)return u?Jl(e,Xl(a,e)):Zl(e,$l(a,e))}else{if(!Uc[h])return i?e:{};a=rc(e,h,s)}}o||(o=new Vl);var v=o.get(e);if(v)return v;o.set(e,a),lc(e)?e.forEach((function(r){a.add(Gc(r,t,n,r,e,o))})):sc(e)&&e.forEach((function(r,i){a.set(i,Gc(r,t,n,i,e,o))}));var p=c?void 0:(l?u?ec:Ql:u?hc:cc)(e);return Kl(p||e,(function(r,i){p&&(r=e[i=r]),Yl(a,i,Gc(r,t,n,i,e,o))})),a}Uc[dc]=Uc[yc]=Uc[jc]=Uc[Rc]=Uc[mc]=Uc[gc]=Uc[Ic]=Uc[Tc]=Uc[Ec]=Uc[Mc]=Uc[_c]=Uc[kc]=Uc[Oc]=Uc[Sc]=Uc[Cc]=Uc[Pc]=Uc[Ac]=Uc[Dc]=Uc[Lc]=Uc[Bc]=Uc[zc]=Uc[Wc]=!0,Uc[bc]=Uc[wc]=Uc[Fc]=!1;var Nc=Gc,Vc=1,Kc=4;function Yc(e){return Nc(e,Vc|Kc)}var $c=Yc,Xc=Ai;function qc(e,t){var n=[];return Xc(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}var Hc=qc,Zc="__lodash_hash_undefined__";function Jc(e){return this.__data__.set(e,Zc),this}function Qc(e){return this.__data__.has(e)}var eh=na,th=Jc,nh=Qc;function rh(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new eh;++t<n;)this.add(e[t])}rh.prototype.add=rh.prototype.push=th,rh.prototype.has=nh;var ih=rh;function oh(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function ah(e,t){return e.has(t)}var sh=ah,uh=ih,lh=oh,ch=sh,hh=1,fh=2;function vh(e,t,n,r,i,o){var a=n&hh,s=e.length,u=t.length;if(s!=u&&!(a&&u>s))return!1;var l=o.get(e),c=o.get(t);if(l&&c)return l==t&&c==e;var h=-1,f=!0,v=n&fh?new uh:void 0;for(o.set(e,t),o.set(t,e);++h<s;){var p=e[h],d=t[h];if(r)var y=a?r(d,p,h,t,e,o):r(p,d,h,e,t,o);if(void 0!==y){if(y)continue;f=!1;break}if(v){if(!lh(t,(function(e,t){if(!ch(v,t)&&(p===e||i(p,e,n,r,o)))return v.push(t)}))){f=!1;break}}else if(p!==d&&!i(p,d,n,r,o)){f=!1;break}}return o.delete(e),o.delete(t),f}var ph=vh;function dh(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function yh(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var mh=yh,gh=pe,bh=Ru,wh=bt,xh=ph,kh=dh,Oh=mh,Sh=1,Ch=2,Ph="[object Boolean]",Ah="[object Date]",Dh="[object Error]",Fh="[object Map]",jh="[object Number]",Rh="[object RegExp]",Ih="[object Set]",Th="[object String]",Eh="[object Symbol]",Mh="[object ArrayBuffer]",_h="[object DataView]",Lh=gh?gh.prototype:void 0,Bh=Lh?Lh.valueOf:void 0;function zh(e,t,n,r,i,o,a){switch(n){case _h:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Mh:return!(e.byteLength!=t.byteLength||!o(new bh(e),new bh(t)));case Ph:case Ah:case jh:return wh(+e,+t);case Dh:return e.name==t.name&&e.message==t.message;case Rh:case Th:return e==t+"";case Fh:var s=kh;case Ih:var u=r&Sh;if(s||(s=Oh),e.size!=t.size&&!u)return!1;var l=a.get(e);if(l)return l==t;r|=Ch,a.set(e,t);var c=xh(s(e),s(t),r,i,o,a);return a.delete(e),c;case Eh:if(Bh)return Bh.call(e)==Bh.call(t)}return!1}var Wh=zh,Uh=Js,Gh=1,Nh=Object.prototype.hasOwnProperty;function Vh(e,t,n,r,i,o){var a=n&Gh,s=Uh(e),u=s.length;if(u!=Uh(t).length&&!a)return!1;for(var l=u;l--;){var c=s[l];if(!(a?c in t:Nh.call(t,c)))return!1}var h=o.get(e),f=o.get(t);if(h&&f)return h==t&&f==e;var v=!0;o.set(e,t),o.set(t,e);for(var p=a;++l<u;){var d=e[c=s[l]],y=t[c];if(r)var m=a?r(y,d,c,t,e,o):r(d,y,c,e,t,o);if(!(void 0===m?d===y||i(d,y,n,r,o):m)){v=!1;break}p||(p="constructor"==c)}if(v&&!p){var g=e.constructor,b=t.constructor;g==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b||(v=!1)}return o.delete(e),o.delete(t),v}var Kh=Za,Yh=ph,$h=Wh,Xh=Vh,qh=Au,Hh=Mn,Zh=_n.exports,Jh=xr,Qh=1,ef="[object Arguments]",tf="[object Array]",nf="[object Object]",rf=Object.prototype.hasOwnProperty;function of(e,t,n,r,i,o){var a=Hh(e),s=Hh(t),u=a?tf:qh(e),l=s?tf:qh(t),c=(u=u==ef?nf:u)==nf,h=(l=l==ef?nf:l)==nf,f=u==l;if(f&&Zh(e)){if(!Zh(t))return!1;a=!0,c=!1}if(f&&!c)return o||(o=new Kh),a||Jh(e)?Yh(e,t,n,r,i,o):$h(e,t,u,n,r,i,o);if(!(n&Qh)){var v=c&&rf.call(e,"__wrapped__"),p=h&&rf.call(t,"__wrapped__");if(v||p){var d=v?e.value():e,y=p?t.value():t;return o||(o=new Kh),i(d,y,n,r,o)}}return!!f&&(o||(o=new Kh),Xh(e,t,n,r,i,o))}var af=of,sf=On;function uf(e,t,n,r,i){return e===t||(null==e||null==t||!sf(e)&&!sf(t)?e!=e&&t!=t:af(e,t,n,r,uf,i))}var lf=Za,cf=uf,hf=1,ff=2;function vf(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Object(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var u=(s=n[i])[0],l=e[u],c=s[1];if(a&&s[2]){if(void 0===l&&!(u in e))return!1}else{var h=new lf;if(r)var f=r(l,c,u,e,t,h);if(!(void 0===f?cf(c,l,hf|ff,r,h):f))return!1}}return!0}var pf=Te;function df(e){return e==e&&!pf(e)}var yf=df,mf=Gr;function gf(e){for(var t=mf(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,yf(i)]}return t}function bf(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}}var wf=vf,xf=gf,kf=bf;function Of(e){var t=xf(e);return 1==t.length&&t[0][2]?kf(t[0][0],t[0][1]):function(n){return n===e||wf(n,e,t)}}function Sf(e,t){return null!=e&&t in Object(e)}var Cf=ma,Pf=En,Af=Mn,Df=sn,Ff=Jt,jf=xa;function Rf(e,t,n){for(var r=-1,i=(t=Cf(t,e)).length,o=!1;++r<i;){var a=jf(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&Ff(i)&&Df(a,i)&&(Af(e)||Pf(e))}var If=Sf,Tf=Rf;function Ef(e,t){return null!=e&&Tf(e,t,If)}var Mf=uf,_f=Da,Lf=Ef,Bf=Ui,zf=df,Wf=bf,Uf=xa,Gf=1,Nf=2;function Vf(e,t){return Bf(e)&&zf(t)?Wf(Uf(e),t):function(n){var r=_f(n,e);return void 0===r&&r===t?Lf(n,e):Mf(t,r,Gf|Nf)}}function Kf(e){return function(t){return null==t?void 0:t[e]}}var Yf=Ca;function $f(e){return function(t){return Yf(t,e)}}var Xf=Kf,qf=$f,Hf=Ui,Zf=xa;function Jf(e){return Hf(e)?Xf(Zf(e)):qf(e)}var Qf=Of,ev=Vf,tv=jt,nv=Mn,rv=Jf;function iv(t){return"function"==typeof t?t:null==t?tv:"object"==e(t)?nv(t)?ev(t[0],t[1]):Qf(t):rv(t)}var ov=iv,av=xs,sv=Hc,uv=ov,lv=Mn;function cv(e,t){return(lv(e)?av:sv)(e,uv(t))}var hv,fv,vv,pv,dv,yv,mv,gv,bv,wv=cv;function xv(e){if(Array.isArray(e))return e}function kv(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(u){s=!0,i=u}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}function Ov(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Sv(e,t){if(e){if("string"==typeof e)return Ov(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ov(e,t):void 0}}function Cv(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Pv(e,t){return xv(e)||kv(e,t)||Sv(e,t)||Cv()}function Av(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Dv(e){return Dv=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Dv(e)}function Fv(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Dv(e)););return e}function jv(e,t,n){return jv="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=Fv(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}},jv(e,t,n||e)}function Rv(e,t){return Rv=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Rv(e,t)}function Iv(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rv(e,t)}function Tv(e){return Tv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tv(e)}function Ev(e,t){if(t&&("object"===Tv(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Av(e)}(function(e){e.DOWN="down",e.UP="up",e.LEFT="left",e.RIGHT="right"})(hv||(hv={})),function(e){e.Left="left",e.Right="right"}(fv||(fv={})),function(e){e.Top="top",e.Bottom="bottom"}(vv||(vv={})),function(e){e.Bottom="bottom",e.Top="top",e.Middle="middle"}(pv||(pv={})),function(e){e.Pan="PAN",e.Ban="BAN",e.MARKER="MARKER",e.Point="POINT",e.Circle="CIRCLE",e.Line="LINE",e.Polyline="POLYLINE",e.Rect="RECT",e.Polygon="POLYGON",e.DrawMask="DRAWMASK",e.ClearMask="CLEARMASK",e.ImageMask="IMAGEMASK"}(dv||(dv={})),function(e){e.BoundsChanged="boundsChanged",e.FeatureSelected="featureSelected",e.FeatureUnselected="featureUnselected",e.DrawDone="drawDone",e.FeatureUpdated="featureUpdated",e.FeatureDeleted="featureDeleted",e.Click="click",e.DblClick="dblClick",e.MouseDown="mouseDown",e.MouseMove="mouseMove",e.MouseUp="mouseUp",e.MouseOver="mouseOver",e.MouseOut="mouseOut"}(yv||(yv={})),function(e){e.DrawActivePoint="drawActivePoint",e.DrawActiveMiddlePoint="drawActiveMiddlePoint"}(mv||(mv={})),function(e){e.Grab="-webkit-grab",e.Grabbing="-webkit-grabbing",e.Crosshair="crosshair",e.Pointer="pointer",e.Move="move",e.NESW_Resize="nesw-resize",e.NWSE_Resize="nwse-resize"}(gv||(gv={})),function(e){e.DrawMask="crosshair",e.ClearMask="crosshair"}(bv||(bv={}));var Mv=Ai,_v=nn;function Lv(e,t){var n=-1,r=_v(e)?Array(e.length):[];return Mv(e,(function(e,i,o){r[++n]=t(e,i,o)})),r}var Bv=Jr,zv=ov,Wv=Lv,Uv=Mn;function Gv(e,t){return(Uv(e)?Bv:Wv)(e,zv(t))}var Nv=Gv;function Vv(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var Kv=Vv;function Yv(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}var $v=Yv;function Xv(e){return e!=e}function qv(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}var Hv=$v,Zv=Xv,Jv=qv;function Qv(e,t,n){return t==t?Jv(e,t,n):Hv(e,Zv,n)}var ep=Qv,tp=Re,np=Mn,rp=On,ip="[object String]";function op(e){return"string"==typeof e||!np(e)&&rp(e)&&tp(e)==ip}var ap=op,sp=/\s/;function up(e){for(var t=e.length;t--&&sp.test(e.charAt(t)););return t}var lp=up,cp=/^\s+/;function hp(e){return e?e.slice(0,lp(e)+1).replace(cp,""):e}var fp=hp,vp=Te,pp=ri,dp=NaN,yp=/^[-+]0x[0-9a-f]+$/i,mp=/^0b[01]+$/i,gp=/^0o[0-7]+$/i,bp=parseInt;function wp(e){if("number"==typeof e)return e;if(pp(e))return dp;if(vp(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=vp(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=fp(e);var n=mp.test(e);return n||gp.test(e)?bp(e.slice(2),n?2:8):yp.test(e)?dp:+e}var xp=wp,kp=1/0,Op=17976931348623157e292;function Sp(e){return e?(e=xp(e))===kp||e===-kp?(e<0?-1:1)*Op:e==e?e:0:0===e?e:0}var Cp=Sp;function Pp(e){var t=Cp(e),n=t%1;return t==t?n?t-n:t:0}var Ap=Pp,Dp=Jr;function Fp(e,t){return Dp(t,(function(t){return e[t]}))}var jp=Fp,Rp=Gr;function Ip(e){return null==e?[]:jp(e,Rp(e))}var Tp=ep,Ep=nn,Mp=ap,_p=Ap,Lp=Ip,Bp=Math.max;function zp(e,t,n,r){e=Ep(e)?e:Lp(e),n=n&&!r?_p(n):0;var i=e.length;return n<0&&(n=Bp(i+n,0)),Mp(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Tp(e,t,n)>-1}var Wp,Up=zp;!function(e){e.Draw="DRAW",e.Clear="CLEAR",e.Image="IMAGE"}(Wp||(Wp={}));var Gp=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r(this,e),this.id=t,this.type=n,this.props=i,this.style=Hr({},e.defaultStyle,o)}return o(e,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){}},{key:"setStyle",value:function(e,t){var n,r=t.refresh,i=void 0===r||r;this.style=e,i&&(null===(n=this.layer)||void 0===n||n.refresh())}},{key:"refresh",value:function(){}},{key:"printInfo",value:function(){}}]),e}();a(Gp,"defaultStyle",{opacity:1,fillStyle:"rgba(255, 0, 0, 0)",lineWidth:1,strokeStyle:"#000"});var Np=Re,Vp=On,Kp="[object Boolean]";function Yp(e){return!0===e||!1===e||Vp(e)&&Np(e)==Kp}var $p=Yp,Xp=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r(this,e),this.id=t,this.type=n,this.props=i,this.style=Hr({},e.defaultStyle,o),this.domId="layer-".concat(t,"-wrapper"),this.setDom()}return o(e,[{key:"setDom",value:function(){this.dom||(this.dom=document.createElement("div"),this.dom.setAttribute("id",this.domId),this.dom.style.position="absolute",this.dom.style.left="0",this.dom.style.top="0");var e=this.style,t=e.zIndex,n=e.opacity;this.dom.style.zIndex="".concat(t),this.dom.style.opacity="".concat(n)}},{key:"onAdd",value:function(e){this.map=e,this.resize()}},{key:"onRemove",value:function(){var e=document.getElementById(this.domId);e&&e.remove(),this.map=null}},{key:"resize",value:function(){var e=this.map.getSize(),t=e.width,n=e.height;this.dom.style.width="".concat(t,"px"),this.dom.style.height="".concat(n,"px")}},{key:"refresh",value:function(){}},{key:"resizeAndRefresh",value:function(){this.resize(),this.refresh()}},{key:"printInfo",value:function(){}}]),e}();function qp(e){var t=Hp();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function Hp(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(Xp,"defaultStyle",{zIndex:1,opacity:1});var Zp=function(e){Iv(n,e);var t=qp(n);function n(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,n),(o=t.call(this,e,i,a,s)).createRenderCanvas(),o}return o(n,[{key:"onAdd",value:function(e){jv(Dv(n.prototype),"onAdd",this).call(this,e),this.resize()}},{key:"createRenderCanvas",value:function(){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.dom.appendChild(this.canvas),this.canvasContext=this.canvas.getContext("2d")}},{key:"resize",value:function(){jv(Dv(n.prototype),"resize",this).call(this);var e=this.map.getSize(),t=e.width,r=e.height;this.canvas.width=t*n.dpr,this.canvas.height=r*n.dpr,this.canvas.style.width=t+"px",this.canvas.style.height=r+"px"}},{key:"refresh",value:function(){this.clear(),jv(Dv(n.prototype),"refresh",this).call(this)}},{key:"clear",value:function(){var e;null===(e=this.canvasContext)||void 0===e||e.clearRect(0,0,this.canvas.width,this.canvas.height)}}]),n}(Xp);function Jp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jp(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jp(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}a(Zp,"dpr",window.devicePixelRatio);var ed=function(){function e(){r(this,e)}return o(e,null,[{key:"setStyle",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Hr({},e.defaultStyle,n);Mi(r,(function(n,r){if(Ge(e.formatStyle[r])){var i=e.formatStyle[r](n);!Ge(t[r])&&(t[r]=i)}else!Ge(t[r])&&(t[r]=n)}))}},{key:"drawPolyline",value:function(t,n,r,i){var o=i.format,a=i.limitCount,s=void 0===a?2:a,u=Ge(o)?o(n):n,l=u.points,c=u.width,h=l.length;if(!(h<s)){e.setStyle(t,r),Ta(c)&&(t.lineWidth=c),t.beginPath();var f=l[0],v=f.x,p=f.y;t.moveTo(v,p);for(var d=1;d<h;d++){var y=l[d],m=y.x,g=y.y;t.lineTo(m,g)}t.stroke()}}},{key:"drawLine",value:function(t,n,r,i){e.setStyle(t,r);var o=(i||{}).format,a=Ge(o)?o(n):n,s=a.start,u=a.end,l=a.width;Ta(l)&&(t.lineWidth=l),t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(u.x,u.y),t.stroke()}},{key:"drawRect",value:function(t,n,r,i){var o=(i||{}).format,a=!$p(r.stroke)||r.stroke,s=!!$p(r.fill)&&r.fill,u=Ge(o)?o(n):n,l=u.x,c=u.y,h=l+u.width,f=c+u.height,v=[{x:l,y:c},{x:h,y:c},{x:h,y:f},{x:l,y:f}];e.drawPolygon(t,v,r,{fill:s,stroke:a})}},{key:"drawPolygon",value:function(t,n,r,i){var o=i.format,a=i.limitCount,s=void 0===a?2:a,u=i.closePath,l=void 0===u||u,c=!$p(r.stroke)||r.stroke,h=!!$p(r.fill)&&r.fill,f=n.length;if(!(f<s)){e.setStyle(t,r),t.beginPath();var v=Ge(o)?o(n[0]):n[0],p=v.x,d=v.y;t.moveTo(p,d);for(var y=1;y<f;y++){var m=Ge(o)?o(n[y]):n[y],g=m.x,b=m.y;t.lineTo(g,b)}l&&t.closePath(),h&&t.fill(),c&&(t.globalAlpha=1,t.stroke())}}},{key:"drawCircle",value:function(t,n,r,i){var o=i.format,a=!$p(r.stroke)||r.stroke,s=!!$p(r.fill)&&r.fill,u=Ge(o)?o(n):n,l=u.cx,c=u.cy,h=u.r;e.setStyle(t,r),t.beginPath(),t.arc(l,c,h,0,2*Math.PI),s&&t.fill(),a&&(t.globalAlpha=1,t.stroke())}},{key:"drawPoint",value:function(t,n,r,i){var o=i.format,a=Ge(o)?o(n):n,s=a.x,u=a.y,l=a.r,c=void 0===l?2:l;e.setStyle(t,r),t.beginPath(),t.arc(s,u,c,0,2*Math.PI),t.fill()}},{key:"drawImage",value:function(e,t,n){var r=t.image,i=t.x,o=t.y,a=t.width,s=t.height;e.drawImage(r,i,o,a,s)}},{key:"drawText",value:function(t,n,r,i){var o=r.background,a=i.format,s=!$p(r.fill)||r.fill,u=Ge(a)?a(n):n,l=u.text,c=u.position,h=u.offset;if(l){e.setStyle(t,r);var f=c.x+h.x,v=c.y-h.y,p=t.lineWidth,d=3*Zp.dpr,y=4*Zp.dpr,m=t.textBaseline===pv.Bottom,g=t.textBaseline===pv.Top,b=t.textBaseline===pv.Middle;if(o){var w=t.measureText(l).width+2*y,x=parseInt(t.font.replace(/[^0-9.]/gi,""),10)+2*d,k=c.y;m&&(k-=x),g&&(k=k),b&&(k-=x/2);var O={x:c.x+h.x,y:k-h.y,width:w,height:x};e.drawRect(t,O,Qp(Qp({},r||{}),{},{fill:!0}))}t.globalAlpha=1,s?(t.fillStyle=r.fontColor,m&&o&&t.fillText(l,f+y,v-d+p),b&&o&&t.fillText(l,f+y,v),g&&o&&t.fillText(l,f+y,v+d+p),!o&&t.fillText(l,f,v)):(t.strokeStyle=r.fontColor,m&&o&&t.strokeText(l,f+y,v-d+p),b&&o&&t.strokeText(l,f+y,v),g&&o&&t.strokeText(l,f+y,v+d+p),!o&&t.strokeText(l,f,v))}}},{key:"drawArrow",value:function(t,n,r,i,o){var a=(o||{}).format,s=Ge(a)?a(n):n,u=s.position,l=s.points,c=void 0===l?[]:l;e.setStyle(t,i),t.save(),t.beginPath(),t.translate(u.x,u.y),t.rotate(r),Mi(c,(function(e,n){0===n?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)})),t.closePath(),t.restore(),t.fill(),t.stroke()}}]),e}();function td(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?td(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):td(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function rd(e){var t=id();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function id(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(ed,"defaultStyle",{fillStyle:"#FF0000",strokeStyle:"#FF0000",lineWidth:1,font:"normal 12px Arial",globalAlpha:1,lineCap:"round",lineJoin:"round",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0}),a(ed,"formatStyle",{lineWidth:function(e){return e*Zp.dpr},font:function(e){var t=e.replace(/[^0-9.]/gi,""),n=parseInt(t,10)*Zp.dpr,r=new RegExp("".concat(t),"g");return e.replace(r,"".concat(n))}});var od,ad,sd,ud,ld=function(e){Iv(n,e);var t=rd(n);function n(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,n),(o=t.call(this,e,Wp.Clear,a,s)).shape=i,o}return o(n,[{key:"refresh",value:function(){var e=this,t=Zp.dpr,n=this.layer.map.getScale(),r=nd(nd({},this.style||{}),{},{lineCap:"round",lineJoin:"round"});this.layer.canvasContext.globalCompositeOperation="destination-out",ed.drawPolyline(this.layer.canvasContext,this.shape,r,{format:function(r){var i=r.points,o=r.width;return nd({points:Nv(i,(function(n){var r=e.layer.map.transformGlobalToScreen(n),i=r.x,o=r.y;return{x:i*t,y:o*t}}))},Ta(o)?{width:o*n*t}:{})}}),this.layer.canvasContext.globalCompositeOperation="source-over"}}]),n}(Gp);(function(e){e.Image="IMAGE",e.Feature="FEATURE",e.Event="EVENT",e.Mask="MASK",e.Text="TEXT",e.Marker="MARKER",e.Overlay="OVERLAY"})(od||(od={})),function(e){e.LoadStart="loadStart",e.LoadEnd="loadEnd",e.LoadError="loadError"}(ad||(ad={})),function(e){e.Point="POINT",e.Line="LINE",e.Polyline="POLYLINE",e.Polygon="POLYGON",e.Rect="RECT",e.Circle="CIRCLE",e.Arrow="ARROW"}(sd||(sd={})),function(e){e.Global="GLOBAL",e.Screen="SCREEN"}(ud||(ud={}));var cd,hd,fd=function e(){r(this,e)};function vd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vd(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function dd(e){var t=yd();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function yd(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(fd,"MathUtil",{getMiddlePoint:function(e,t){var n=e.x,r=e.y;return{x:(n+t.x)/2,y:(r+t.y)/2}},distance:function(e,t){var n=e.x,r=e.y,i=n-t.x,o=r-t.y;return Math.sqrt(i*i+o*o)},pointInPolygon:function(e,t){for(var n=e.x,r=e.y,i=!1,o=-1,a=t.length,s=a-1;++o<a;s=o){var u=t[o],l=u.x,c=u.y,h=t[s],f=h.x,v=h.y;(c<=r&&r<v||v<=r&&r<c)&&n<(f-l)*(r-c)/(v-c)+l&&(i=!i)}return i},pointInPoint:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).tolerance;return fd.MathUtil.distance(e,t)<=n},pointInPolyline:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).tolerance,r=t.length-1,i=!1;return Mi(t,(function(o,a){if(a!==r){var s=t[a+1];return fd.MathUtil.distancePoint2Line(e,o,s)<=n?(i=!0,!1):void 0}})),i},distancePoint2Line:function(e,t,n){var r,i,o=e.x,a=e.y,s=t.x,u=t.y,l=n.x,c=n.y,h=l-s,f=c-u,v=h*h+f*f,p=-1;0!==v&&(p=((o-s)*h+(a-u)*f)/v),p<0?(r=s,i=u):p>1?(r=l,i=c):(r=s+p*h,i=u+p*f);var d=o-r,y=a-i;return Math.sqrt(d*d+y*y)}}),a(fd,"EventUtil",{getButtonIndex:function(e){if(!+[1])switch(e.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}return e.button},getMouseDirection:function(e,t){var n=e.offsetLeft,r=-e.offsetTop,i=n+e.offsetWidth,o=r-e.offsetHeight,a=(n+i)/2,s=(r+o)/2,u=(o-r)/(i-n),l=t||window.event,c=l.clientX,h=-l.clientY,f=(h-s)/(c-a);return u<f&&f<-u?c>a?1:3:h>s?0:2}}),function(e){e.Marker="MARKER"}(cd||(cd={})),function(e){e.Click="click",e.MouseDown="mouseDown",e.MouseUp="mouseUp",e.MouseOver="mouseOver",e.MouseOut="mouseOut",e.DragStart="dragStart",e.Dragging="dragging",e.DragEnd="dragEnd",e.RightClick="rightClick"}(hd||(hd={}));var md=function(e){Iv(n,e);var t=dd(n);function n(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),a(Av(i=t.call(this,e,od.Event,o,s)),"dragging",!1),a(Av(i),"breakFeatureCapture",!1),a(Av(i),"tmpPointsStore",[]),a(Av(i),"hoverFeature",null),a(Av(i),"hoverFeatureIndex",void 0),i.onMouseDown=i.onMouseDown.bind(Av(i)),i.onMouseMove=i.onMouseMove.bind(Av(i)),i.onMouseUp=i.onMouseUp.bind(Av(i)),i.onMouseOut=i.onMouseOut.bind(Av(i)),i.onMouseOver=i.onMouseOver.bind(Av(i)),i.onMouseClick=i.onMouseClick.bind(Av(i)),i.onMouseDblClick=i.onMouseDblClick.bind(Av(i)),i.onMouseWheel=i.onMouseWheel.bind(Av(i)),i}return o(n,[{key:"onAdd",value:function(e){jv(Dv(n.prototype),"onAdd",this).call(this,e),this.createEventDom(),this.dom.appendChild(this.eventDom),this.addEventListener()}},{key:"createEventDom",value:function(){this.eventDom=document.createElement("div"),this.eventDom.style.position="absolute",this.eventDom.style.left="0",this.eventDom.style.right="0",this.eventDom.style.top="0",this.eventDom.style.bottom="0",this.eventDom.style.zIndex="1",this.eventDom.ondragstart=function(e){e.preventDefault(),e.stopPropagation()}}},{key:"addEventListener",value:function(){this.eventDom.addEventListener("mousedown",this.onMouseDown),this.eventDom.addEventListener("mousemove",this.onMouseMove),this.eventDom.addEventListener("mouseup",this.onMouseUp),this.eventDom.addEventListener("click",this.onMouseClick),this.eventDom.addEventListener("dblclick",this.onMouseDblClick),this.eventDom.addEventListener("mousewheel",this.onMouseWheel),this.eventDom.addEventListener("mouseout",this.onMouseOut),this.eventDom.addEventListener("mouseover",this.onMouseOver)}},{key:"removeEventListener",value:function(){this.eventDom.removeEventListener("mousedown",this.onMouseDown),this.eventDom.removeEventListener("mousemove",this.onMouseMove),this.eventDom.removeEventListener("mouseup",this.onMouseUp),this.eventDom.removeEventListener("click",this.onMouseClick),this.eventDom.removeEventListener("dblclick",this.onMouseDblClick),this.eventDom.removeEventListener("mousewheel",this.onMouseWheel),this.eventDom.removeEventListener("mouseout",this.onMouseOut),this.eventDom.removeEventListener("mouseover",this.onMouseOver)}},{key:"handleMapPanStart",value:function(e){var t=this;this.dragging=!0,this.map.setCursor(gv.Grabbing),document.onmousemove=function(e){return t.handleMapPanMove(e)},document.onmouseup=function(e){return t.handleMapPanEnd(e)}}},{key:"handleMapPanMove",value:function(e){var t=this.getDltXY(e),n=t.x,r=t.y;this.map.onDrag(n,r)}},{key:"handleMapPanEnd",value:function(e){this.dragging=!1,this.map.setCursor(gv.Grab),document.onmousemove=null,document.onmouseup=null;var t=this.getDltXY(e),n=t.x,r=t.y,i=this.map.getScreenCenter(),o=i.x-n,a=i.y-r,s=this.map.transformScreenToGlobal({x:o,y:a});this.map.reset().setCenter(s)}},{key:"getDltXY",value:function(e,t){var n=(t||{}).transform,r=void 0!==n&&n,i=this.map.getScale(),o=e.screenX,a=e.screenY,s=this.startPageScreenPoint,u=o-s.x,l=a-s.y;return{x:r?u/i:u,y:r?l/i:l}}},{key:"clearDownTimer",value:function(){this.downTimer&&(window.clearTimeout(this.downTimer),this.downTimer=null)}},{key:"handleMarkerStart",value:function(e){var t=this;this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.map.eventsObServer.emit(yv.DrawDone,t.map.mode,{x:t.startPoint.global.x,y:t.startPoint.global.y})}),300)}},{key:"handlePointStart",value:function(e){var t=this;this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.map.eventsObServer.emit(yv.DrawDone,t.map.mode,{x:t.startPoint.global.x,y:t.startPoint.global.y}),t.reset()}),300)}},{key:"handleCircleStart",value:function(e){var t=this;this.dragging=!0,document.onmousemove=function(e){return t.handleCircleMove(e)},document.onmouseup=function(e){return t.handleCircleEnd(e)};var n=this.startPoint.global;this.setTip({text:"移动开始绘制",position:n})}},{key:"handleCircleMove",value:function(e){var t=this.startPoint.global,n=this.getDltXY(e,{transform:!0}),r=n.x,i=n.y,o=this.getDltXY(e,{transform:!1}),a=o.x,s=o.y,u=Math.sqrt(a*a+s*s),l=this.map.xAxis.direction===fv.Right?r:-r,c=this.map.yAxis.direction===vv.Top?i:-i,h={x:t.x+l,y:t.y-c},f={cx:t.x,cy:t.y,sr:u};this.map.overlayLayer.addCircleFeature(f),this.setTip({text:"抬起完成绘制",position:h})}},{key:"handleCircleEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null;var t=this.startPoint.global,n=t.x,r=t.y,i=this.getDltXY(e,{transform:!0}),o=i.x,a=i.y,s=this.getDltXY(e,{transform:!1}),u=s.x,l=s.y,c=Math.sqrt(o*o+a*a),h=Math.sqrt(u*u+l*l);if(this.reset(),!(Math.abs(h)<=2)){var f={cx:n,cy:r,r:c},v={cx:n,cy:r,sr:h};this.map.eventsObServer.emit(yv.DrawDone,this.map.mode,f,v)}}},{key:"handleLineStart",value:function(e){var t=this;if(0===this.tmpPointsStore.length)this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.tmpPointsStore.push(t.startPoint),t.setTip({text:"移动开始绘制",position:t.startPoint.global})}),300);else if(1===this.tmpPointsStore.length){var n=this.tmpPointsStore[0].global,r=this.startPoint.global;this.map.eventsObServer.emit(yv.DrawDone,this.map.mode,{start:n,end:r}),this.reset()}}},{key:"handleLineMove",value:function(e){var t=e.offsetX,n=e.offsetY,r={x:t,y:n},i=this.map.transformScreenToGlobal(r),o=this.tmpPointsStore.length;if(0===o)this.setTip({text:"单击确定起点",position:i});else if(1===o){var a=this.tmpPointsStore[0].global,s=this.map.transformScreenToGlobal({x:t,y:n});this.map.overlayLayer.addLineFeature({start:a,end:s}),this.setTip({text:"单击确定终点",position:i})}}},{key:"handlePolylineStart",value:function(e){var t=this;0===this.tmpPointsStore.length?(this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.tmpPointsStore.push(t.startPoint),t.setTip({text:"移动开始绘制",position:t.startPoint.global})}),300)):(this.tmpPointsStore.push(this.startPoint),this.map.withHotKeys&&this.setTip({text:"ctrl+z撤销",position:this.startPoint.global}))}},{key:"handlePolylineMove",value:function(e){var t=e.offsetX,n=e.offsetY,r=this.map.transformScreenToGlobal({x:t,y:n}),i=Nv(this.tmpPointsStore,(function(e){return e.global}));i.push(r),1===i.length?this.setTip({text:"单击确定起点",position:r}):i.length>1&&(this.map.overlayLayer.addPolylineFeature({points:i}),this.setTip({text:"单击绘制/双击结束",position:r}))}},{key:"handlePolylineEnd",value:function(e){this.tmpPointsStore.pop(),this.tmpPointsStore.length>=2&&this.map.eventsObServer.emit(yv.DrawDone,this.map.mode,Nv(this.tmpPointsStore,(function(e){return e.global}))),this.reset()}},{key:"handleRectStart",value:function(e){var t=this;this.dragging=!0,document.onmousemove=function(e){return t.handleRectMove(e)},document.onmouseup=function(e){return t.handleRectEnd(e)};var n=this.startPoint.global;this.setTip({text:"移动开始绘制",position:n})}},{key:"handleRectMove",value:function(e){var t=this.startPoint.global,n=t.x,r=t.y,i=this.getDltXY(e,{transform:!0}),o=i.x,a=i.y,s=this.map.xAxis.direction===fv.Right,u=this.map.yAxis.direction===vv.Top,l={x:s?n+o:n-o,y:u?r-a:r+a},c={x:s?Math.min(n,n+o):Math.max(n,n-o),y:u?Math.max(r,r-a):Math.min(r,r+a),width:Math.abs(o),height:Math.abs(a)};this.map.overlayLayer.addRectFeature(c),this.setTip({text:"抬起完成绘制",position:l})}},{key:"handleRectEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null;var t=this.map.getScale(),n=this.startPoint.screen,r=n.x,i=n.y,o=this.getDltXY(e),a=o.x,s=o.y,u=Math.abs(a)/t,l=Math.abs(s)/t,c=r+a,h=i+s,f=Math.min(c,r),v=Math.min(h,i),p=this.map.transformScreenToGlobal({x:f,y:v});if(this.reset(),!(Math.abs(a)<=3||Math.abs(s)<=3)){var d={x:p.x,y:p.y,width:u,height:l};this.map.eventsObServer.emit(yv.DrawDone,this.map.mode,d)}}},{key:"handlePolygonStart",value:function(e){var t=this;0===this.tmpPointsStore.length?(this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.tmpPointsStore.push(t.startPoint),t.setTip({text:"移动开始绘制",position:t.startPoint.global})}),300)):(this.tmpPointsStore.push(this.startPoint),this.map.withHotKeys&&this.setTip({text:"ctrl+z撤销",position:this.startPoint.global}))}},{key:"handlePolygonMove",value:function(e){var t=e.offsetX,n=e.offsetY,r=this.map.transformScreenToGlobal({x:t,y:n}),i=Nv(this.tmpPointsStore,(function(e){return e.global}));i.push(r);var o=i.length;if(1===o)this.setTip({text:"单击确定起点",position:r});else if(o>1){this.map.overlayLayer.addPolygonFeature({points:i},{node:!0});var a=2===o?"单击绘制":"单击绘制/双击结束";this.setTip({text:a,position:r})}}},{key:"handlePolygonEnd",value:function(e){if(this.tmpPointsStore.pop(),this.tmpPointsStore.length>=3){var t=Nv(this.tmpPointsStore,(function(e){return e.global}));this.map.eventsObServer.emit(yv.DrawDone,this.map.mode,t)}this.reset()}},{key:"handleMaskStart",value:function(e){var t=this;this.dragging=!0,document.onmousemove=function(e){return t.handleMaskMove(e)},document.onmouseup=function(e){return t.handleMaskEnd(e)},this.tmpPointsStore.push(this.startPoint);var n=Nv(this.tmpPointsStore,(function(e){return e.global}));switch(this.map.mode){case dv.DrawMask:this.map.overlayLayer.addDrawAction({points:n});break;case dv.ClearMask:this.handleMaskClearMoving({points:n})}}},{key:"handleMaskMove",value:function(e){var t=this.startPoint.screen,n=t.x,r=t.y,i=this.getDltXY(e),o={x:n+i.x,y:r+i.y},a=this.map.transformScreenToGlobal(o),s=Kv(this.tmpPointsStore);if(s){var u=s.screen;if(fd.MathUtil.distance(u,o)<=3)return}this.tmpPointsStore.push({screen:o,global:a});var l=Nv(this.tmpPointsStore,(function(e){return e.global}));switch(this.map.mode){case dv.DrawMask:this.map.overlayLayer.addDrawAction({points:l});break;case dv.ClearMask:this.handleMaskClearMoving({points:l})}}},{key:"handleMaskEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null;var t=Nv(this.tmpPointsStore,(function(e){return e.global}));this.map.eventsObServer.emit(yv.DrawDone,this.map.mode,t),this.reset(),this.handleMaskClearMoving({reset:!0})}},{key:"handleMaskClearMoving",value:function(e){var t=e.points,n=void 0===t?[]:t,r=e.reset,i=void 0!==r&&r,o=this.map.getLayers(),a=this.map.drawingStyle,s=a.lineWidth,u=(void 0===s?10:s)/this.map.getScale();Mi(o,(function(e){if(e.type!==od.Mask||i)e.type===od.Mask&&i&&e.setMovingClearAction(null);else{var t=new ld("".concat(+new Date),{points:n,width:u},{},a);e.setMovingClearAction(t)}}))}},{key:"handleMapZoom",value:function(e){var t=90+this.map.zoomWheelRatio,n={x:e.offsetX,y:e.offsetY},r={screen:n,global:this.map.transformScreenToGlobal(n)},i=e.deltaY<0?this.map.zoom*t/100:100*this.map.zoom/t,o=this.map.getScreenCenter(),a=this.map.transformScreenToGlobal(o,{basePoint:r,zoom:i});this.map.centerAndZoom({center:a,zoom:i},{refreshDelay:!0})}},{key:"handleFeatureSelect",value:function(e){var t=this.map.getTargetFeatureWithPoint(this.startPoint.global);t&&this.map.eventsObServer.emit(yv.FeatureSelected,t)}},{key:"handleActiveFeatureCapture",value:function(e){var t=this,n={x:e.offsetX,y:e.offsetY},r=this.map.transformScreenToGlobal(n),i=this.map.activeFeature,o=i||{},a=o.type,s=o.shape;switch(this.hoverFeature=null,this.hoverFeatureIndex=void 0,a){case sd.Point:i.captureWithPoint(r)&&(this.hoverFeature=i,this.map.setCursor(gv.Pointer),this.map.eventLayer.breakFeatureCapture=!0,this.setTip({text:"按下移动图形/右键删除",position:r}));break;case sd.Rect:case sd.Circle:var u=a===sd.Rect?i.getPoints():i.getEdgePoints();Mi(u,(function(e,i){var o=t.map.transformGlobalToScreen(e);if(fd.MathUtil.distance(o,n)<=5){t.hoverFeatureIndex=i;var a=1===i||3===i?gv.NESW_Resize:gv.NWSE_Resize;return t.map.setCursor(a),t.map.eventLayer.breakFeatureCapture=!0,t.setTip({text:"按下拖动",position:r}),!1}})),!Ta(this.hoverFeatureIndex)&&i.captureWithPoint(r)&&(this.hoverFeature=i,this.map.setCursor(gv.Move),this.map.eventLayer.breakFeatureCapture=!0,this.setTip({text:"按下移动图形",position:r}));break;case sd.Line:case sd.Polyline:case sd.Polygon:var l=a===sd.Line,c=a===sd.Polyline;sd.Polygon;var h=s,f=h.start,v=h.end,p=s.points,d=l?[f,v]:void 0===p?[]:p,y=d.length;Mi(d,(function(e,i){var o=t.map.transformGlobalToScreen(e);if(fd.MathUtil.distance(o,n)<=5){t.hoverFeatureIndex=i,t.map.setCursor(gv.Pointer);var a=y>(l||c?2:3)?"/右键删除":"";return t.map.eventLayer.breakFeatureCapture=!0,t.setTip({text:"按下拖动".concat(a),position:r}),!1}if(!l){if(c&&!d[i+1])return!1;var s=d[i+1]||d[0],u=fd.MathUtil.getMiddlePoint(e,s),h=t.map.transformGlobalToScreen(u);return fd.MathUtil.distance(h,n)<=5?(t.hoverFeatureIndex=i+.5,t.map.setCursor(gv.Pointer),t.map.eventLayer.breakFeatureCapture=!0,t.setTip({text:"按下拖动添加新节点",position:r}),!1):void 0}})),!Ta(this.hoverFeatureIndex)&&i.captureWithPoint(r)&&(this.hoverFeature=i,this.map.setCursor(gv.Move),this.map.eventLayer.breakFeatureCapture=!0,this.setTip({text:"按下移动图形",position:r}))}}},{key:"handleActiveFeatureStart",value:function(e){var t=this;this.map.tipLayer.removeAllFeatureActionText();var n=fd.EventUtil.getButtonIndex(e);0===n?(this.dragging=!0,document.onmousemove=function(e){return t.handleActiveFeatureMove(e)},document.onmouseup=function(e){return t.handleActiveFeatureEnd(e)}):2===n&&this.handleActiveFeatureElse(e)}},{key:"handleActiveFeatureMove",value:function(e){var t=this,n=this.getDltXY(e,{transform:!0}),r=n.x,i=n.y,o=this.getDltXY(e,{transform:!1}),a=o.x;o.y;var s=this.map.activeFeature,u=s.type,l=s.shape,c=s.style,h=this.map.xAxis.direction===fv.Right,f=this.map.yAxis.direction===vv.Top,v=h?r:-r,p=f?i:-i,d=h?a:-a;switch(u){case sd.Point:var y,m=l,g=m.x,b=m.y;this.toUpdateShape=pd(pd({},l),{},{x:g+v,y:b-p}),this.map.overlayLayer.addActiveFeature(s),this.map.overlayLayer.addPointFeature(this.toUpdateShape,{clear:!1,style:pd(pd({},c),{},{fillStyle:null===(y=this.map)||void 0===y?void 0:y.editingColor})});break;case sd.Circle:var w,x=l,k=x.cx,O=x.cy,S=x.r,C=x.sr;if(this.hoverFeature)this.toUpdateShape=pd(pd({},l),{},{cx:k+v,cy:O-p});else if(Ta(this.hoverFeatureIndex)){0===this.hoverFeatureIndex||this.hoverFeatureIndex;var P=1===this.hoverFeatureIndex||2===this.hoverFeatureIndex,A=s.getSubType()===ud.Global,D=A?P?S+v:S-v:P?C+d:C-d;if(D<=0)return;this.toUpdateShape=pd(pd({},l),A?{r:D}:{sr:D})}this.map.overlayLayer.addActiveFeature(s),this.map.overlayLayer.addCircleFeature(this.toUpdateShape,{clear:!1,style:pd(pd({},c),{},{lineWidth:1,strokeStyle:null===(w=this.map)||void 0===w?void 0:w.editingColor})});break;case sd.Rect:var F,j=l,R=j.x,I=j.y,T=j.width,E=j.height,M=null;if(this.hoverFeature)M={x:R+v,y:I-p,width:T,height:E};else if(Ta(this.hoverFeatureIndex)){var _=0===this.hoverFeatureIndex||3===this.hoverFeatureIndex,L=0===this.hoverFeatureIndex||1===this.hoverFeatureIndex,B=_?R+v:R,z=L?I-p:I,W=_?T-r:T+r,U=L?E-i:E+i,G=h?B+W:B-W,N=f?z-U:z+U;M={x:h?Math.min(B,G):Math.max(B,G),y:f?Math.max(z,N):Math.min(z,N),width:Math.abs(W),height:Math.abs(U)}}this.toUpdateShape=pd(pd({},l),M),this.map.overlayLayer.addActiveFeature(s),this.map.overlayLayer.addRectFeature(this.toUpdateShape,{clear:!1,style:pd(pd({},c),{},{lineWidth:1,strokeStyle:null===(F=this.map)||void 0===F?void 0:F.editingColor})});break;case sd.Line:case sd.Polyline:case sd.Polygon:var V,K,Y,$=u===sd.Line,X=u===sd.Polyline,q=u===sd.Polygon,H=l,Z=H.start,J=H.end,Q=l.points,ee=$?[Z,J]:void 0===Q?[]:Q,te=[];if(this.hoverFeature)te=Nv(ee,(function(e){var t=e.x,n=e.y;return{x:t+v,y:n-p}}));else if(Ta(this.hoverFeatureIndex)){var ne=parseInt("".concat(this.hoverFeatureIndex),10);Mi(ee,(function(e,n){var r=e.x,i=e.y;if(n===ne&&ne===t.hoverFeatureIndex)te.push({x:r+v,y:i-p});else if(n===ne&&ne!==t.hoverFeatureIndex){var o=ee[n+1]||ee[0],a=fd.MathUtil.getMiddlePoint({x:r,y:i},o);te.push({x:r,y:i}),te.push({x:a.x+v,y:a.y-p})}else te.push({x:r,y:i})}))}if($){var re=Pv(te,2),ie=re[0],oe=re[1];this.toUpdateShape=pd(pd({},l),{},{start:ie,end:oe})}else this.toUpdateShape=pd(pd({},l),{},{points:te});this.map.overlayLayer.addActiveFeature(s),$&&this.map.overlayLayer.addLineFeature(this.toUpdateShape,{clear:!1,style:pd(pd({},c),{},{strokeStyle:null===(V=this.map)||void 0===V?void 0:V.editingColor})}),X&&this.map.overlayLayer.addPolylineFeature(this.toUpdateShape,{clear:!1,style:pd(pd({},c),{},{strokeStyle:null===(K=this.map)||void 0===K?void 0:K.editingColor})}),q&&this.map.overlayLayer.addPolygonFeature(this.toUpdateShape,{clear:!1,style:pd(pd({},c),{},{lineWidth:1,strokeStyle:null===(Y=this.map)||void 0===Y?void 0:Y.editingColor})})}}},{key:"handleActiveFeatureEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null,this.map.overlayLayer.removeAllFeatureActionText();var t=this.map.activeFeature;if(t&&this.map.overlayLayer.addActiveFeature(t),this.toUpdateShape&&t){switch(t.type){case sd.Point:case sd.Circle:case sd.Line:case sd.Polyline:case sd.Rect:case sd.Polygon:this.map.eventsObServer.emit(yv.FeatureUpdated,t,this.toUpdateShape)}this.toUpdateShape=null}}},{key:"handleActiveFeatureElse",value:function(e){var t=this.map.activeFeature;if(t){var n=t.type,r=t.shape;switch(n){case sd.Point:this.map.eventsObServer.emit(yv.FeatureDeleted,t);break;case sd.Polyline:case sd.Polygon:var i=n===sd.Polyline;sd.Polygon;var o=i?2:3,a=r.points,s=void 0===a?[]:a;if(Ta(this.hoverFeatureIndex)&&s.length>o){var u=parseInt("".concat(this.hoverFeatureIndex),10);if(u===this.hoverFeatureIndex){var l=wv(s,(function(e,t){return t!==u})),c=pd(pd({},r),{},{points:l});this.map.eventsObServer.emit(yv.FeatureUpdated,t,c)}}}}}},{key:"handleFeatureCapture",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).extraTip,n=void 0===t?"":t,r=this.dragging||this.tmpPointsStore.length;this.map.featureCaptureWhenMove&&!r&&this.map.getTargetFeatureWithPoint(e)&&this.setTip({text:(n?n+"/":"")+"双击选中",position:e})}},{key:"clearMousemoveTimer",value:function(){this.mousemoveTimer&&(window.clearTimeout(this.mousemoveTimer),this.mousemoveTimer=null)}},{key:"getMouseEventPoint",value:function(e){var t={x:e.offsetX,y:e.offsetY};return{screen:t,global:this.map.transformScreenToGlobal(t)}}},{key:"onMouseDown",value:function(e){var t=e.screenX,n=e.screenY;this.startPoint=this.getMouseEventPoint(e),this.startPageScreenPoint={x:t,y:n};var r=this.map.mode,i=this.dragging,o=this.hoverFeature||Ta(this.hoverFeatureIndex),a=!i&&!o;this.map.eventsObServer.emit(yv.MouseDown,this.startPoint),!this.map.activeFeature||o?r!==dv.Ban&&(r===dv.Pan&&a?this.handleMapPanStart(e):r===dv.MARKER&&a?this.handleMarkerStart(e):r===dv.Point&&a?this.handlePointStart(e):r===dv.Circle&&a?this.handleCircleStart(e):r===dv.Line&&a?this.handleLineStart(e):r===dv.Polyline&&a?this.handlePolylineStart(e):r===dv.Rect&&a?this.handleRectStart(e):r===dv.Polygon&&a?this.handlePolygonStart(e):r!==dv.DrawMask&&r!==dv.ClearMask||!a||this.handleMaskStart(e),o&&!i&&this.handleActiveFeatureStart(e)):this.map.eventsObServer.emit(yv.FeatureUnselected,this.map.activeFeature,"cancel by click")}},{key:"onMouseMove",value:function(e){this.mouseMoveEvent=e;var t=this.getMouseEventPoint(e),n=t.screen,r=t.global,i=this.map.mode,o=this.dragging;if(this.map.eventsObServer.emit(yv.MouseMove,{screen:n,global:r}),this.map.activeFeature||o||this.map.overlayLayer.removeAllFeatureActionText(),i!==dv.Ban){if(i!==dv.Pan||o)if(i!==dv.MARKER||o)if(i!==dv.Point||o)if(i!==dv.Circle||o)if(i!==dv.Line||o)if(i!==dv.Polyline||o)if(i!==dv.Rect||o)if(i!==dv.Polygon||o){if(i===dv.DrawMask){var a=Da(this.map.drawingStyle,"lineWidth",1);this.map.setCursor(bv.DrawMask,{type:sd.Circle,shape:{sr:a/2,cx:r.x,cy:r.y}})}else if(i===dv.ClearMask){var s=Da(this.map.drawingStyle,"lineWidth",1);this.map.setCursor(bv.ClearMask,{type:sd.Circle,shape:{sr:s/2,cx:r.x,cy:r.y}})}}else this.map.setCursor(gv.Crosshair),this.handlePolygonMove(e),this.handleFeatureCapture(r);else this.map.setCursor(gv.Crosshair),this.setTip({text:"按下确定起点",position:r}),this.handleFeatureCapture(r);else this.map.setCursor(gv.Crosshair),this.handlePolylineMove(e),this.handleFeatureCapture(r);else this.map.setCursor(gv.Crosshair),this.handleLineMove(e),this.handleFeatureCapture(r);else this.map.setCursor(gv.Crosshair),this.setTip({text:"按下确定圆心",position:r}),this.handleFeatureCapture(r);else this.map.setCursor(gv.Crosshair),this.setTip({text:"点击绘制点",position:r}),this.handleFeatureCapture(r);else this.map.setCursor(gv.Crosshair);else this.map.setCursor(gv.Grab);this.map.activeFeature&&!o&&this.setTip({text:"单击取消选中",position:r}),Up([dv.Point,dv.Circle,dv.Line,dv.Polyline,dv.Rect,dv.Polygon],i)&&!o&&this.handleActiveFeatureCapture(e)}}},{key:"onMouseUp",value:function(e){this.map.eventsObServer.emit(yv.MouseUp,this.getMouseEventPoint(e))}},{key:"onMouseClick",value:function(e){this.map.eventsObServer.emit(yv.Click,this.getMouseEventPoint(e))}},{key:"onMouseDblClick",value:function(e){var t=this.map.mode;this.clearDownTimer();var n=this.dragging||this.tmpPointsStore.length;this.map.eventsObServer.emit(yv.DblClick,this.getMouseEventPoint(e)),t!==dv.Ban&&(t===dv.Polyline&&n?this.handlePolylineEnd(e):t===dv.Polygon&&n&&this.handlePolygonEnd(e),Up([dv.Point,dv.Circle,dv.Line,dv.Polyline,dv.Rect,dv.Polygon],t)&&!n&&this.handleFeatureSelect(e))}},{key:"onMouseWheel",value:function(e){var t=this.map.mode;switch(t!==dv.Ban&&e.preventDefault(),t){case dv.Ban:break;case dv.Pan:this.handleMapZoom(e);break;default:this.map.zoomWhenDrawing&&this.handleMapZoom(e)}}},{key:"clearPanWhenDrawingTimer",value:function(){this.panWhenDrawingTimer&&(window.clearInterval(this.panWhenDrawingTimer),this.panWhenDrawingTimer=null)}},{key:"handlePanWhenDrawing",value:function(e){var t=this,n=fd.EventUtil.getMouseDirection(this.map.dom,e);this.clearPanWhenDrawingTimer();var r=10;this.map.panWhenDrawing&&this.tmpPointsStore.length&&(this.panWhenDrawingTimer=window.setInterval((function(){var e=t.map.getScale(),i=r/e,o=t.map.getCenter(),a=t.map.xAxis.direction===fv.Right,s=t.map.yAxis.direction===vv.Top,u=o;switch(n){case 0:u={x:o.x,y:s?o.y+i:o.y-i};break;case 1:u={x:a?o.x+i:o.x-i,y:o.y};break;case 2:u={x:o.x,y:s?o.y-i:o.y+i};break;case 3:u={x:a?o.x-i:o.x+i,y:o.y}}t.map.setCenter(u)}),100))}},{key:"onMouseOut",value:function(e){e.preventDefault(),this.map.tipLayer.removeAllFeatureActionText(),this.map.cursorLayer.removeAllFeatureActionText(),e.toElement&&e.toElement.getAttribute("data-type")===cd.Marker||(this.handlePanWhenDrawing(e),this.map.eventsObServer.emit(yv.MouseOut,this.getMouseEventPoint(e)))}},{key:"onMouseOver",value:function(e){e.preventDefault(),this.map.tipLayer.removeAllFeatureActionText(),this.clearPanWhenDrawingTimer(),this.map.eventsObServer.emit(yv.MouseOver,this.getMouseEventPoint(e))}},{key:"revokeTmpPointsStore",value:function(){if(this.tmpPointsStore.length){this.tmpPointsStore.pop();var e=this.mouseMoveEvent;e&&this.onMouseMove(e)}}},{key:"setTip",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.map.drawingTip?this.map.tipLayer.addText(e,t):this.map.tipLayer.removeAllFeatureActionText()}},{key:"reset",value:function(){this.tmpPointsStore=[],this.map.overlayLayer.removeAllFeatureActionText(),this.map.tipLayer.removeAllFeatureActionText()}},{key:"refresh",value:function(){jv(Dv(n.prototype),"refresh",this).call(this)}}]),n}(Xp),gd={BASE64:"base64",BLOB:"blob"},bd=function(){function e(t){r(this,e),a(this,"objects",[]),a(this,"map",{activeFeature:null,setActiveFeature:function(){},getScale:function(){return 1},transformGlobalToScreen:function(e){var t=e.x,n=e.y,r=this.bounds;return{x:t-r.x,y:n-r.y}}}),this.bounds=t,this.createRenderCanvas(),this.map.getScale=this.map.getScale.bind(this),this.map.transformGlobalToScreen=this.map.transformGlobalToScreen.bind(this)}return o(e,[{key:"createRenderCanvas",value:function(){var e=this.bounds,t=e.width,n=e.height;this.canvas=document.createElement("canvas"),this.canvas.width=t*Zp.dpr,this.canvas.height=n*Zp.dpr,this.canvas.style.width=t+"px",this.canvas.style.height=n+"px",this.canvasContext=this.canvas.getContext("2d"),ed.drawRect(this.canvasContext,{x:0,y:0,width:this.canvas.width,height:this.canvas.height},{fill:!0,fillStyle:"#fff",stroke:!1})}},{key:"addObject",value:function(e){e.onAdd(this),this.objects.push(e)}},{key:"addObjects",value:function(e){var t=this;Mi(e,(function(e){return t.addObject(e)}))}},{key:"putImage",value:function(e){this.canvasContext.drawImage(e,0,0)}},{key:"addImageLayer",value:function(e){var t=this.map.transformGlobalToScreen(e.position),n=t.x,r=t.y,i=Zp.dpr,o=this.map.getScale(),a=e.imageInfo,s=a.width*o,u=a.height*o;e.image&&e.imageSuccess&&ed.drawImage(this.canvasContext,{image:e.image,x:n*i,y:r*i,width:s*i,height:u*i},{})}},{key:"convertCanvasToImage",value:function(e,t,n){return e===gd.BASE64?this.convertCanvasToBase64(t,n):e===gd.BLOB?this.convertCanvasToBlob(t,n):new Promise((function(t,n){n(new Error("export params error："+e))}))}},{key:"convertCanvasToBlob",value:function(e,t){var n=this;return new Promise((function(r,i){n.canvas.toBlob((function(t){n.canvas=null;var o=n.bounds,a=o.width,s=o.height;n.resizeBlobImage(t,{width:a,height:s},e,r,i)}),e,t)}))}},{key:"resizeBlobImage",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=new Image,a=URL.createObjectURL(e);o.src=a;var s=t.width,u=t.height,l=document.createElement("canvas"),c=l.getContext("2d");l.width=s,l.height=u,l.style.width=s+"px",l.style.height=u+"px",o.onload=function(){URL.revokeObjectURL(a),c.drawImage(o,0,0,s,u),l.toBlob((function(e){l=null,r(e)}),n,1)},o.onerror=function(){i(new Error("resize image error"))}}},{key:"convertCanvasToBase64",value:function(e,t){var n=this.canvas.toDataURL(e);this.canvas=null;var r=this.bounds,i=r.width,o=r.height;return this.resizeBase64Image(n,{width:i,height:o},e)}},{key:"resizeBase64Image",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",r=new Image;r.src=e;var i=t.width,o=t.height,a=document.createElement("canvas"),s=a.getContext("2d");return a.width=i,a.height=o,a.style.width=i+"px",a.style.height=o+"px",new Promise((function(e,t){r.onload=function(){s.drawImage(r,0,0,i,o),e(a.toDataURL(n))},r.onerror=function(){t(new Error("resize image error"))}}))}},{key:"refresh",value:function(){Mi(this.objects,(function(e){return e.refresh()}))}},{key:"clear",value:function(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)}}]),e}(),wd=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r(this,e),this.id=t,this.type=n,this.props=i,this.style=Hr({},e.defaultStyle,o)}return o(e,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){var e,t,n=null===(e=this.layer)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.activeFeature;n&&n.id===this.id&&this.layer.map.setActiveFeature(null)}},{key:"getBounds",value:function(){return{x:0,y:0,width:0,height:0}}},{key:"captureWithPoint",value:function(e){return!1}},{key:"updateShape",value:function(e){var t,n,r;this.shape=e,null===(t=this.layer)||void 0===t||t.refresh();var i=null===(n=this.layer)||void 0===n||null===(r=n.map)||void 0===r?void 0:r.activeFeature;i&&i.id===this.id&&this.layer.map.setActiveFeature(this)}},{key:"onMove",value:function(e){}},{key:"setStyle",value:function(e,t){var n,r=t.refresh,i=void 0===r||r;this.style=e,i&&(null===(n=this.layer)||void 0===n||n.refresh())}},{key:"refresh",value:function(){}},{key:"printInfo",value:function(){}}]),e}();function xd(e){var t=kd();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function kd(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(wd,"moveStep",1),a(wd,"defaultStyle",{opacity:1,fillStyle:"rgba(255, 0, 0, 0)",lineWidth:1,strokeStyle:"#000"});var Od=function(e){Iv(n,e);var t=xd(n);function n(e,i){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4?arguments[4]:void 0;return r(this,n),a(Av(o=t.call(this,e,sd.Point,s,u)),"option",{}),o.shape=i,o.option=Hr({},n.defaultOption,l||{}),o}return o(n,[{key:"captureWithPoint",value:function(e){var t,n,r=this.shape,i=r.x,o=r.y,a=r.r,s=r.sr,u=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),l=u?3/u:0,c=Ta(a)?a+l:Ta(s)?s/u+l:l;return fd.MathUtil.pointInPoint(e,{x:i,y:o},{tolerance:c})}},{key:"refresh",value:function(){var e,t=this.shape,n=t.x,r=t.y,i=t.r,o=t.sr;if(null!==(e=this.layer)&&void 0!==e&&e.map){var a=this.layer.map.transformGlobalToScreen({x:n,y:r}),s=a.x,u=a.y,l=Zp.dpr,c=this.layer.map.getScale(),h=s*l,f=u*l,v=(Ta(i)?i*c:Ta(o)?o:2)*l;if(ed.drawPoint(this.layer.canvasContext,{x:h,y:f,r:v},this.style,{}),this.option.active){var p=h-v-2,d=f-v-2,y=2*v+4,m=2*v+4,g=p+y,b=d,w=g,x=b+m,k=p,O=x;ed.drawLine(this.layer.canvasContext,{start:{x:p,y:d},end:{x:w,y:x}},{strokeStyle:"#fff"}),ed.drawLine(this.layer.canvasContext,{start:{x:g,y:b},end:{x:k,y:O}},{strokeStyle:"#fff"}),ed.drawRect(this.layer.canvasContext,{x:p,y:d,width:y,height:m},{strokeStyle:"#666"})}}}}]),n}(wd);function Sd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sd(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Pd(e){var t=Ad();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function Ad(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(Od,"defaultOption",{active:!1});var Dd=function(e){Iv(n,e);var t=Pd(n);function n(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,n),(o=t.call(this,e,sd.Line,a,s)).shape=i,o}return o(n,[{key:"captureWithPoint",value:function(e){var t,n,r=this.shape,i=r.start,o=r.end,a=r.width,s=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),u=s?3/s:0,l=Ta(a)?a/2+u:u;return fd.MathUtil.pointInPolyline(e,[i,o],{tolerance:l})}},{key:"getLineWidth",value:function(){var e,t,n=this.shape.width,r=this.style.lineWidth||1,i=null===(e=this.layer)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.getScale();return n?n*i:r}},{key:"refresh",value:function(){var e;if(null!==(e=this.layer)&&void 0!==e&&e.map){var t=this.shape,n=t.start,r=t.end,i=t.width,o=this.layer.map.transformGlobalToScreen(n),a=o.x,s=o.y,u=this.layer.map.transformGlobalToScreen(r),l=u.x,c=u.y,h=Zp.dpr,f=(i||0)*this.layer.map.getScale(),v=this.getLineWidth(),p=Math.atan((c-s)/(l-a));p+=(l>a?90:-90)*Math.PI/180;var d=1.2*v*h,y=1.4*v*h;this.style.arrow&&ed.drawArrow(this.layer.canvasContext,{position:{x:l*h,y:c*h},points:[{x:0*h,y:0-y},{x:d,y:2*d-y},{x:-d,y:2*d-y}]},p,Cd(Cd({},this.style),{},{lineWidth:2},this.style.strokeStyle?{fillStyle:this.style.strokeStyle}:{})),ed.drawLine(this.layer.canvasContext,Cd({start:{x:a*h,y:s*h},end:{x:l*h,y:c*h}},Ta(i)?{width:f*h}:{}),this.style,{})}}}]),n}(wd);function Fd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fd(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Rd(e){var t=Id();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function Id(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Td=function(e){Iv(n,e);var t=Rd(n);function n(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,n),(o=t.call(this,e,sd.Polyline,a,s)).shape=i,o}return o(n,[{key:"captureWithPoint",value:function(e){var t,n,r=this.shape,i=r.points,o=void 0===i?[]:i,a=r.width,s=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),u=s?3/s:0,l=Ta(a)?a/2+u:u;return fd.MathUtil.pointInPolyline(e,o,{tolerance:l})}},{key:"refresh",value:function(){var e,t=this;if(null!==(e=this.layer)&&void 0!==e&&e.map){var n=Zp.dpr,r=this.layer.map.getScale();ed.drawPolyline(this.layer.canvasContext,this.shape,this.style,{format:function(e){var i=e.points,o=e.width;return jd({points:Nv(i,(function(e){var r=t.layer.map.transformGlobalToScreen(e),i=r.x,o=r.y;return{x:i*n,y:o*n}}))},Ta(o)?{width:o*r*n}:{})}})}}}]),n}(wd);function Ed(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Md(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ed(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ed(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _d(e){var t=Ld();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function Ld(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Bd=function(e){Iv(n,e);var t=_d(n);function n(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,n),(o=t.call(this,e,sd.Rect,a,s)).shape=i,o}return o(n,[{key:"captureWithPoint",value:function(e){var t=this.getPoints();return fd.MathUtil.pointInPolygon(e,t)}},{key:"getPoints",value:function(){var e,t,n,r,i=(null===(e=this.layer)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.xAxis.direction)===fv.Left,o=(null===(n=this.layer)||void 0===n||null===(r=n.map)||void 0===r?void 0:r.yAxis.direction)===vv.Bottom,a=this.shape,s=a.x,u=a.y,l=a.width,c=a.height,h=i?s-l:s+l,f=o?u+c:u-c;return[{x:s,y:u},{x:h,y:u},{x:h,y:f},{x:s,y:f}]}},{key:"onMove",value:function(e){var t,n,r,i,o,a,s,u,l,c,h,f=wd.moveStep,v=this.shape,p=v.x,d=v.y,y=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),m=(null===(r=this.layer)||void 0===r||null===(i=r.map)||void 0===i||null===(o=i.xAxis)||void 0===o?void 0:o.direction)===fv.Left,g=(null===(a=this.layer)||void 0===a||null===(s=a.map)||void 0===s||null===(u=s.yAxis)||void 0===u?void 0:u.direction)===vv.Bottom,b=f/y,w={};switch(e){case hv.UP:w={y:g?d-b:d+b};break;case hv.DOWN:w={y:g?d+b:d-b};break;case hv.LEFT:w={x:m?p+b:p-b};break;case hv.RIGHT:w={x:m?p-b:p+b}}var x=Md(Md({},this.shape),w);null===(l=this.layer)||void 0===l||null===(c=l.map)||void 0===c||null===(h=c.eventsObServer)||void 0===h||h.emit(yv.FeatureUpdated,this,x)}},{key:"refresh",value:function(){var e,t=this;if(null!==(e=this.layer)&&void 0!==e&&e.map){var n=Zp.dpr,r=this.layer.map.getScale();ed.drawRect(this.layer.canvasContext,this.shape,this.style,{format:function(e){var i=e.x,o=e.y,a=e.width,s=e.height,u=t.layer.map.transformGlobalToScreen({x:i,y:o}),l=u.x,c=u.y;return{x:l*n,y:c*n,width:a*r*n,height:s*r*n}}})}}}]),n}(wd);function zd(e){var t=Wd();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function Wd(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Ud=function(e){Iv(n,e);var t=zd(n);function n(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,n),(o=t.call(this,e,sd.Polygon,a,s)).shape=i,o}return o(n,[{key:"captureWithPoint",value:function(e){var t=this.shape.points,n=void 0===t?[]:t;return fd.MathUtil.pointInPolygon(e,n)}},{key:"refresh",value:function(){var e,t=this;if(null!==(e=this.layer)&&void 0!==e&&e.map){var n=this.shape,r=n.points;n.inner;var i=Zp.dpr;ed.drawPolygon(this.layer.canvasContext,r,this.style,{format:function(e){var n=t.layer.map.transformGlobalToScreen(e),r=n.x,o=n.y;return{x:r*i,y:o*i}}})}}}]),n}(wd);function Gd(e){var t=Nd();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function Nd(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Vd=function(e){Iv(n,e);var t=Gd(n);function n(e,i){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4?arguments[4]:void 0;return r(this,n),a(Av(o=t.call(this,e,sd.Circle,s,u)),"option",{}),o.shape=i,o.option=Hr({},n.defaultOption,l||{}),o}return o(n,[{key:"getSubType",value:function(){var e=this.shape,t=e.r,n=e.sr;return Ta(t)?ud.Global:Ta(n)?ud.Screen:void 0}},{key:"captureWithPoint",value:function(e){var t,n,r=this.getSubType()===ud.Global,i=this.getSubType()===ud.Screen,o=this.shape,a=o.cx,s=o.cy,u=o.r,l=o.sr,c=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),h=c?3/c:0,f=r?u+h:i?l/c+h:h;return fd.MathUtil.pointInPoint(e,{x:a,y:s},{tolerance:f})}},{key:"getEdgePoints",value:function(){var e,t,n,r,i=this.getSubType()===ud.Global,o=this.getSubType()===ud.Screen,a=(null===(e=this.layer)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.xAxis.direction)===fv.Left,s=(null===(n=this.layer)||void 0===n||null===(r=n.map)||void 0===r?void 0:r.yAxis.direction)===vv.Bottom,u=this.shape,l=u.cx,c=u.cy,h=u.r,f=u.sr,v=i?h:o?f:0,p=Math.sqrt(v*v/2),d=a?-p:p,y=s?-p:p;if(i)return[{x:l-d,y:c+y},{x:l+d,y:c+y},{x:l+d,y:c-y},{x:l-d,y:c-y}];if(o){var m,g,b=null===(m=this.layer)||void 0===m||null===(g=m.map)||void 0===g?void 0:g.getScale();if(!b)return[];var w=p/b,x=a?-w:w,k=s?-w:w;return[{x:l-x,y:c+k},{x:l+x,y:c+k},{x:l+x,y:c-k},{x:l-x,y:c-k}]}return[]}},{key:"refresh",value:function(){var e,t=this;if(null!==(e=this.layer)&&void 0!==e&&e.map){var n=this.getSubType()===ud.Global,r=Zp.dpr,i=this.layer.map.getScale();if(ed.drawCircle(this.layer.canvasContext,this.shape,this.style,{format:function(e){var o=e.cx,a=e.cy,s=e.r,u=e.sr,l=n?s*i:Ta(u)?u:2,c=t.layer.map.transformGlobalToScreen({x:o,y:a}),h=c.x,f=c.y;return{cx:h*r,cy:f*r,r:l*r}}}),this.option.active){var o=this.getEdgePoints();Mi(o,(function(e){var n=e.x,i=e.y;ed.drawCircle(t.layer.canvasContext,{sr:3.5,cx:n,cy:i},{strokeStyle:"#666",fillStyle:"#fff",stroke:!0,fill:!0,lineWidth:1},{format:function(e){var n=e.cx,i=e.cy,o=e.sr,a=t.layer.map.transformGlobalToScreen({x:n,y:i}),s=a.x,u=a.y;return{cx:s*r,cy:u*r,r:o*r}}})}))}}}}]),n}(wd);function Kd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kd(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $d(e){var t=Xd();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function Xd(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(Vd,"defaultOption",{active:!1});var qd,Hd=function(e){Iv(n,e);var t=$d(n);function n(e,i,o){var s,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return r(this,n),a(Av(s=t.call(this,e,Wp.Draw,u,l)),"category",""),s.shape=o,s.category=i,s}return o(n,[{key:"refresh",value:function(){var e=this,t=Zp.dpr,n=this.layer.map.getScale(),r=Yd(Yd({},this.style||{}),{},{lineCap:"round",lineJoin:"round"});ed.drawPolyline(this.layer.canvasContext,this.shape,r,{format:function(r){var i=r.points,o=r.width;return Yd({points:Nv(i,(function(n){var r=e.layer.map.transformGlobalToScreen(n),i=r.x,o=r.y;return{x:i*t,y:o*t}}))},Ta(o)?{width:o*n*t}:{})}})}}]),n}(Gp);function Zd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zd(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.Text="TEXT"}(qd||(qd={}));var Qd=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r(this,e),this.id=t,this.type=qd.Text,this.props=i,this.textInfo=Hr({},e.defaultTextInfo,n),this.style=Hr({},e.defaultStyle,o)}return o(e,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){}},{key:"updateText",value:function(e){if(ap(e)&&e){var t,n=this.textInfo;this.textInfo=Jd(Jd({},n),{},{text:e}),null===(t=this.layer)||void 0===t||t.refresh()}}},{key:"updatePosition",value:function(e){var t,n=this.textInfo;this.textInfo=Jd(Jd({},n),{},{position:e}),null===(t=this.layer)||void 0===t||t.refresh()}},{key:"refresh",value:function(){var e,t=this;if(null!==(e=this.layer)&&void 0!==e&&e.map){var n=this.textInfo,r=Zp.dpr;ed.drawText(this.layer.canvasContext,n,this.style,{format:function(e){var n=e.position,i=e.offset,o=t.layer.map.transformGlobalToScreen(n),a=o.x,s=o.y,u=i.x,l=i.y;return Jd(Jd({},e),{},{position:{x:a*r,y:s*r},offset:{x:u*r,y:l*r}})}})}}},{key:"printInfo",value:function(){}}]),e}();function ey(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ty(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ey(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ey(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ny(e){var t=ry();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function ry(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(Qd,"defaultStyle",{opacity:1,strokeStyle:"#FF0000",background:!0,fontColor:"#FFFFFF",fillStyle:"#FF0000",font:"normal 12px Arial",textAlign:"left",textBaseline:"bottom"}),a(Qd,"defaultTextInfo",{text:"",position:{x:0,y:0},offset:{x:0,y:0}});var iy=function(e){Iv(n,e);var t=ny(n);function n(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),a(Av(i=t.call(this,e,od.Overlay,o,s)),"featureActionTexts",[]),a(Av(i),"defaultActiveFeatureStyle",{strokeStyle:"#FF0000",fillStyle:"#FF0000",lineWidth:1}),a(Av(i),"defaultTextStyle",{fillStyle:"#FFFFFF",strokeStyle:"#D2691E",background:!0,globalAlpha:1,fontColor:"#333",font:"normal 10px Arial",textBaseline:"top"}),i}return o(n,[{key:"addFeatureActionText",value:function(e,t){var n=(t||{}).clear;void 0!==n&&n&&this.removeAllFeatureActionText(),e.onAdd(this),this.featureActionTexts.push(e)}},{key:"addPointFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=t.active,a=void 0!==o&&o,s=new Od("".concat(+new Date),e,{},n||this.map.drawingStyle,{active:a});this.addFeatureActionText(s,{clear:i})}},{key:"addLineFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=new Dd("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureActionText(o,{clear:i});var a=e,s=a.start,u=a.end;this.addDrawingPoints([s,u])}},{key:"addPolylineFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=new Td("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureActionText(o,{clear:i}),this.addDrawingPoints(e.points)}},{key:"addRectFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=new Bd("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureActionText(o,{clear:i});var a=o.getPoints();this.addDrawingPoints(a)}},{key:"addPolygonFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=new Ud("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureActionText(o,{clear:i}),this.addDrawingPoints(e.points)}},{key:"addCircleFeature",value:function(e,t){var n=t||{},r=n.clear,i=void 0===r||r,o=n.style,a=n.active,s=void 0!==a&&a,u=new Vd("".concat(+new Date),e,{},o||this.map.drawingStyle,{active:s});this.addFeatureActionText(u,{clear:i})}},{key:"addDrawAction",value:function(e){var t=new Hd("".concat(+new Date),"drawAction",e,{},this.map.drawingStyle);this.addFeatureActionText(t,{clear:!0})}},{key:"addText",value:function(e,t){var n=(t||{}).clear,r=void 0===n||n,i=new Qd("".concat(+new Date),ty(ty({},e),{},{offset:{x:5,y:-5}}),{},this.defaultTextStyle);this.addFeatureActionText(i,{clear:r})}},{key:"addActiveFeature",value:function(e){if(e){var t=this.defaultActiveFeatureStyle,n=e.type,r=e.shape;switch(n){case sd.Point:this.addPointFeature(r,{style:t,active:!0});break;case sd.Line:this.addLineFeature(r,{style:t});break;case sd.Polyline:this.addPolylineFeature(r,{style:t}),this.addActiveMiddlePoints(r.points,{withClose:!1});break;case sd.Rect:this.addRectFeature(r,{style:t});break;case sd.Polygon:this.addPolygonFeature(r,{style:t}),this.addActiveMiddlePoints(r.points,{withClose:!0});break;case sd.Circle:this.addCircleFeature(r,{style:t,active:!0})}}else this.removeAllFeatureActionText()}},{key:"addActiveMiddlePoints",value:function(e){var t=this,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).withClose,r=void 0===n||n;Mi(e,(function(n,i){var o=r?e[i+1]||e[0]:e[i+1];if(o){var a=fd.MathUtil.getMiddlePoint(n,o);t.addDrawingPoint(a,{strokeStyle:"#228B22",withAddIcon:!0,isMiddlePoint:!0})}}))}},{key:"addDrawingPoints",value:function(e){var t=this;Mi(e,(function(e){t.addDrawingPoint(e)}))}},{key:"addDrawingPoint",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.strokeStyle,o=void 0===i?"#666":i,a=r.fillStyle,s=void 0===a?"#fff":a,u=r.withAddIcon,l=void 0!==u&&u,c=r.iconColor,h=void 0===c?"#228B22":c,f=r.isMiddlePoint,v=void 0!==f&&f,p=e.x,d=e.y,y=null===(t=this.map)||void 0===t?void 0:t.slotsObServer[mv.DrawActivePoint];if(v||!Ge(y)||!1!==y(e,this)){var m=null===(n=this.map)||void 0===n?void 0:n.slotsObServer[mv.DrawActiveMiddlePoint];v&&Ge(m)&&!1===m(e,this)||(this.addCircleFeature({sr:3.5,cx:p,cy:d},{clear:!1,style:{strokeStyle:o,fillStyle:s,stroke:!0,fill:!0,lineWidth:1}}),l&&this.addCircleFeature({sr:1.25,cx:p,cy:d},{clear:!1,style:{fillStyle:h,stroke:!1,fill:!0}}))}}},{key:"removeAllFeatureActionText",value:function(){this.featureActionTexts=[],this.clear()}},{key:"refresh",value:function(){jv(Dv(n.prototype),"refresh",this).call(this),Mi(this.featureActionTexts,(function(e){return e.refresh()}))}}]),n}(Zp),oy=ov,ay=nn,sy=Gr;function uy(e){return function(t,n,r){var i=Object(t);if(!ay(t)){var o=oy(n);t=sy(t),n=function(e){return o(i[e],e,i)}}var a=e(t,n,r);return a>-1?i[o?t[a]:a]:void 0}}var ly=uy,cy=$v,hy=ov,fy=Ap,vy=Math.max;function py(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:fy(n);return i<0&&(i=vy(r+i,0)),cy(e,hy(t),i)}var dy=ly(py);function yy(e){var t=my();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function my(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var gy=function(e){Iv(n,e);var t=yy(n);function n(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),a(Av(i=t.call(this,e,od.Marker,o,s)),"markers",[]),i}return o(n,[{key:"addMarker",value:function(e,t){e.onAdd(this),this.markers.push(e)}},{key:"removeMarkerById",value:function(e){var t=wv(this.markers,(function(t){return t.id!==e||(t.onRemove(),!1)}));this.markers=t,this.refresh()}},{key:"getMarkerById",value:function(e){return dy(this.markers,(function(t){return t.id===e}))}},{key:"getAllMarkers",value:function(){return this.markers}},{key:"removeAllMarkers",value:function(){var e=wv(this.markers,(function(e){return e.onRemove(),!1}));this.markers=e,this.refresh()}},{key:"resize",value:function(){this.dom.style.width="0px",this.dom.style.height="0px"}},{key:"refresh",value:function(){jv(Dv(n.prototype),"refresh",this).call(this),Mi(this.markers,(function(e){return e.refresh()}))}}]),n}(Xp),by=function(){function e(t,n){var i=this;r(this,e),a(this,"controls",[]),a(this,"layers",[]),a(this,"drawingStyle",{}),a(this,"drawingTip",!0),a(this,"editingColor","#FF0000"),a(this,"slotsObServer",{}),a(this,"activeFeature",null),a(this,"events",{on:function(e,t){i.eventsObServer.on(e,t)}}),a(this,"slots",{on:function(e,t){i.slotsObServer[e]=t}}),this.wrapperDomId=t,this.wrapperDom=document.getElementById(t),this.createMainDom(),this.mapOptions=Hr({},e.defaultMapOptions,n),this.zoom=this.mapOptions.zoom,this.center=this.mapOptions.center,this.mode=this.mapOptions.mode,this.refreshDelayWhenZooming=this.mapOptions.refreshDelayWhenZooming,this.zoomWhenDrawing=this.mapOptions.zoomWhenDrawing,this.panWhenDrawing=this.mapOptions.panWhenDrawing,this.featureCaptureWhenMove=this.mapOptions.featureCaptureWhenMove,this.withHotKeys=this.mapOptions.withHotKeys,this.zoomWheelRatio=this.mapOptions.zoomWheelRatio,this.xAxis=this.mapOptions.xAxis,this.yAxis=this.mapOptions.yAxis,this.size=this.mapOptions.size||{width:Da(this.dom,"clientWidth",0),height:Da(this.dom,"clientHeight",0)},this.setDomStyle(),this.createSubDoms(),this.addOverlayLayer(),this.addTipLayer(),this.addCursorLayer(),this.addEventLayer(),this.addMarkerLayer(),this.eventsObServer=new I.EventEmitter,this.withHotKeys&&this.registerHotkey()}return o(e,[{key:"setDomStyle",value:function(){this.dom.ondragstart=function(e){e.preventDefault(),e.stopPropagation()},this.dom.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation()}}},{key:"setMode",value:function(e){this.mode=e,this.eventLayer.reset(),this.activeFeature&&this.eventsObServer.emit(yv.FeatureUnselected,this.activeFeature,"cancel by switch mode")}},{key:"setDrawingStyle",value:function(e){this.drawingStyle=e}},{key:"setEditingColor",value:function(e){this.editingColor=e}},{key:"enableDrawingTip",value:function(){this.drawingTip=!0}},{key:"disableDrawingTip",value:function(){this.drawingTip=!1}},{key:"getSize",value:function(){return this.size}},{key:"getScale",value:function(e){var t=Ta(e)?e:this.zoom,n=1e6,r=this.getSize().width;return parseInt(r*n/t+"",10)/n}},{key:"setCenter",value:function(e){return this.center=e,this.refresh(),this.triggerBoundsChanged(),this}},{key:"getCenter",value:function(){return this.center}},{key:"getScreenCenter",value:function(){var e=this.getSize();return{x:e.width/2,y:e.height/2}}},{key:"getBounds",value:function(e){var t=this.getSize(),n=t.width,r=t.height,i=this.transformScreenToGlobal({x:0,y:0}),o=i.x,a=i.y,s=this.transformScreenToGlobal({x:n,y:r});return{x:o,y:a,width:s.x-o,height:a-s.y}}},{key:"enableZoomWhenDrawing",value:function(){this.zoomWhenDrawing=!0}},{key:"disableZoomWhenDrawing",value:function(){this.zoomWhenDrawing=!1}},{key:"enablePanWhenDrawing",value:function(){this.panWhenDrawing=!0}},{key:"disablePanWhenDrawing",value:function(){this.panWhenDrawing=!1}},{key:"enableFeatureCaptureWhenMove",value:function(){this.featureCaptureWhenMove=!0}},{key:"disableFeatureCaptureWhenMove",value:function(){this.featureCaptureWhenMove=!1}},{key:"enableHotKeys",value:function(){this.withHotKeys||(this.withHotKeys=!0,this.registerHotkey())}},{key:"disableHotKeys",value:function(){this.withHotKeys&&(this.withHotKeys=!1,this.unbindHotkey())}},{key:"centerAndZoom",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).refreshDelay,n=void 0!==t&&t,r=e.center,i=e.zoom;return r&&(this.center=r),Ta(i)&&(this.zoom=i),this.refresh(n&&this.refreshDelayWhenZooming),this.triggerBoundsChanged(),this}},{key:"zoomTo",value:function(e){this.zoom=e,this.refresh(),this.triggerBoundsChanged()}},{key:"zoomIn",value:function(){this.zoom=this.zoom/2,this.refresh(),this.triggerBoundsChanged()}},{key:"zoomOut",value:function(){this.zoom=2*this.zoom,this.refresh(),this.triggerBoundsChanged()}},{key:"setZoomWheelRatio",value:function(e){this.zoomWheelRatio=e}},{key:"addControl",value:function(e){e.onAdd(this),this.controls.push(e)}},{key:"removeControlById",value:function(e){var t=wv(this.controls,(function(t){return t.id!==e||(t.onRemove(),!1)}));this.controls=t}},{key:"addLayer",value:function(e){var t=e.dom;this.layerDom.appendChild(t),e.onAdd(this),this.layers.push(e)}},{key:"removeLayerById",value:function(e){var t=wv(this.layers,(function(t){return t.id!==e||(t.onRemove(),!1)}));this.layers=t,this.refresh()}},{key:"removeAllLayers",value:function(){var e=wv(this.layers,(function(e){return e.onRemove(),!1}));this.layers=e,this.refresh()}},{key:"getLayers",value:function(){return this.layers}},{key:"triggerBoundsChanged",value:function(){var e=this;this.boundsChangedTimer&&(window.clearTimeout(this.boundsChangedTimer),this.boundsChangedTimer=null),this.boundsChangedTimer=window.setTimeout((function(){e.eventsObServer.emit(yv.BoundsChanged)}),666),this.overlayLayer.refresh()}},{key:"refresh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Mi(this.layers,(function(t){return t.refresh(e)})),this.markerLayer.refresh()}},{key:"resize",value:function(e){this.size=e||{width:Da(this.dom,"clientWidth",0),height:Da(this.dom,"clientHeight",0)},this.setLayerDomSize(),this.setPlatformDomSize(),Mi(this.layers,(function(e){return e.resizeAndRefresh()})),this.markerLayer.resizeAndRefresh(),this.overlayLayer.resizeAndRefresh(),this.tipLayer.resizeAndRefresh(),this.eventLayer.resizeAndRefresh()}},{key:"setActiveFeature",value:function(e){this.activeFeature=e,this.overlayLayer.addActiveFeature(e);var t=this.eventLayer.mouseMoveEvent;t&&this.eventLayer.onMouseMove(t)}},{key:"getActiveFeature",value:function(){return this.activeFeature}},{key:"removeDrawingPoints",value:function(){this.eventLayer.revokeTmpPointsStore()}},{key:"getTargetFeatureWithPoint",value:function(e){var t=this.getLayers(),n=[];return Mi(t,(function(t){if(t.type===od.Feature){var r=t.getTargetFeatureWithPoint(e);if(r)return n.push(r),!1}})),Da(n,"[0]",null)}},{key:"exportLayersToImage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.layers,i=void 0===r?this.getLayers():r,o=t.type,a=void 0===o?"base64":o,s=t.format,u=void 0===s?"image/png":s,l=t.quality,c=void 0===l?1:l,f=i,v=new bd(e),p=[];return Mi(f,function(){var t=n(h.mark((function t(n){var r,i,o,a,s,u;return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.type===od.Feature?(r=n.getAllFeatures(),i=$c(r),v.addObjects(i),p.push(new Promise((function(e){e(!0)})))):n.type===od.Text?(o=n.getAllTexts(),a=$c(o),v.addObjects(a),p.push(new Promise((function(e){e(!0)})))):n.type===od.Mask?(s=n.getImageWithBounds(e),p.push(new Promise((function(e,t){var n=new Image;n.onload=function(){v.putImage(n),e(!0)},n.onerror=function(){t()},n.src=s})))):n.type===od.Image&&(u=$c(n),v.addImageLayer(u),p.push(new Promise((function(e){e(!0)}))));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),new Promise((function(e,t){Promise.all(p).then((function(){v.convertCanvasToImage(a,u,c).then((function(t){v=null,e(t)})).catch((function(e){}))})).catch((function(e){}))}))}},{key:"transformScreenToGlobal",value:function(e,t){var n=t||{},r=n.basePoint,i=n.zoom,o=this.getScale(i),a=this.getScreenCenter(),s=a.x,u=a.y,l=e.x,c=e.y,h=Da(r,"screen.x",s),f=Da(r,"screen.y",u),v=Da(r,"global",this.center),p=v.x,d=v.y,y=l-h,m=c-f;return{x:this.xAxis.direction===fv.Right?p+y/o:p-y/o,y:this.yAxis.direction===vv.Top?d-m/o:d+m/o}}},{key:"transformGlobalToScreen",value:function(e,t){var n=t||{},r=n.basePoint,i=n.zoom,o=this.getScale(i),a=this.getScreenCenter(),s=a.x,u=a.y,l=e.x,c=e.y,h=Da(r,"screen.x",s),f=Da(r,"screen.y",u),v=Da(r,"global",this.center),p=l-v.x,d=c-v.y;return{x:this.xAxis.direction===fv.Right?h+p*o:h-p*o,y:this.yAxis.direction===vv.Top?f-d*o:f+d*o}}},{key:"createMainDom",value:function(){this.domId="main-wrapper-".concat(gi()),this.dom=document.createElement("div"),this.dom.setAttribute("id",this.domId),this.dom.style.position="absolute",this.dom.style.left="0",this.dom.style.top="0",this.dom.style.right="0",this.dom.style.bottom="0",this.wrapperDom.appendChild(this.dom)}},{key:"createSubDoms",value:function(){this.setLayerDom(),this.setPlatformDom(),this.setLayerDom2(),this.setControlDom()}},{key:"setLayerDom",value:function(){this.layerDomId="layer-wrapper-".concat(gi()),this.layerDom=document.createElement("div"),this.layerDom.setAttribute("id",this.layerDomId),this.layerDom.style.position="absolute",this.layerDom.style.left="0",this.layerDom.style.top="0",this.layerDom.style.zIndex="1",this.setLayerDomSize(),this.dom.appendChild(this.layerDom)}},{key:"setLayerDomSize",value:function(){var e=this.getSize(),t=e.width,n=e.height;this.layerDom.style.width="".concat(t,"px"),this.layerDom.style.height="".concat(n,"px")}},{key:"setPlatformDom",value:function(){this.platformDomId="platform-wrapper-".concat(gi()),this.platformDom=document.createElement("div"),this.platformDom.setAttribute("id",this.platformDomId),this.platformDom.style.position="absolute",this.platformDom.style.left="0",this.platformDom.style.top="0",this.platformDom.style.zIndex="5",this.setPlatformDomSize(),this.dom.appendChild(this.platformDom)}},{key:"setPlatformDomSize",value:function(){var e=this.getSize(),t=e.width,n=e.height;this.platformDom.style.width="".concat(t,"px"),this.platformDom.style.height="".concat(n,"px")}},{key:"setLayerDom2",value:function(){this.layerDom2Id="layer2-wrapper-".concat(gi()),this.layerDom2=document.createElement("div"),this.layerDom2.setAttribute("id",this.layerDom2Id),this.layerDom2.style.position="absolute",this.layerDom2.style.left="0",this.layerDom2.style.right="0",this.layerDom2.style.width="0",this.layerDom2.style.height="0",this.layerDom2.style.zIndex="10",this.dom.appendChild(this.layerDom2)}},{key:"setControlDom",value:function(){this.controlDomId="control-wrapper-".concat(gi()),this.controlDom=document.createElement("div"),this.controlDom.setAttribute("id",this.controlDomId),this.controlDom.style.position="absolute",this.controlDom.style.left="0",this.controlDom.style.right="0",this.controlDom.style.width="0",this.controlDom.style.height="0",this.controlDom.style.zIndex="15",this.dom.appendChild(this.controlDom)}},{key:"addEventLayer",value:function(){this.eventLayer=new md("event-".concat(gi()),{},{zIndex:5}),this.platformDom.appendChild(this.eventLayer.dom),this.eventLayer.onAdd(this)}},{key:"addOverlayLayer",value:function(){this.overlayLayer=new iy("overlay-".concat(gi()),{},{zIndex:1}),this.platformDom.appendChild(this.overlayLayer.dom),this.overlayLayer.onAdd(this)}},{key:"addTipLayer",value:function(){this.tipLayer=new iy("tip-".concat(gi()),{},{zIndex:2}),this.platformDom.appendChild(this.tipLayer.dom),this.tipLayer.onAdd(this)}},{key:"addCursorLayer",value:function(){this.cursorLayer=new iy("cursor-".concat(gi()),{},{zIndex:3}),this.platformDom.appendChild(this.cursorLayer.dom),this.cursorLayer.onAdd(this)}},{key:"addMarkerLayer",value:function(){this.markerLayer=new gy("marker-".concat(gi()),{},{zIndex:10}),this.layerDom2.appendChild(this.markerLayer.dom),this.markerLayer.onAdd(this)}},{key:"registerHotkey",value:function(){var e=this;ae("ctrl+z",(function(t,n){e.removeDrawingPoints()})),ae("up,down,left,right",(function(t,n){t.preventDefault(),t.stopPropagation();var r=e.getActiveFeature();r&&r.onMove(n.key)}))}},{key:"unbindHotkey",value:function(){ae.unbind("ctrl+z"),ae.unbind("up,down,left,right")}},{key:"setCursor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.cursorLayer.removeAllFeatureActionText(),this.platformDom.style.cursor=e,this.setCursorFeature(t),this}},{key:"setUrlCursor",value:function(e){return this}},{key:"setCursorFeature",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=e.shape;t===sd.Circle&&this.cursorLayer.addCircleFeature(n,{style:{lineWidth:1,strokeStyle:"#aaa",fillStyle:"#ffffffb3",stroke:!0,fill:!0}})}},{key:"onDrag",value:function(e,t){this.layerDom.style.left="".concat(e,"px"),this.layerDom.style.top="".concat(t,"px"),this.layerDom2.style.left="".concat(e,"px"),this.layerDom2.style.top="".concat(t,"px")}},{key:"onZoom",value:function(e){this.dom.style.transform="scale(".concat(e,")")}},{key:"reset",value:function(){return this.layerDom.style.left="0",this.layerDom.style.top="0",this.layerDom2.style.left="0",this.layerDom2.style.top="0",this}},{key:"destroy",value:function(){this.dom.remove()}},{key:"printInfo",value:function(){}}]),e}();function wy(e){var t=xy();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function xy(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(by,"defaultMapOptions",{center:{x:0,y:0},zoom:1e3,zoomWheelRatio:5,mode:dv.Pan,size:null,refreshDelayWhenZooming:!0,zoomWhenDrawing:!1,featureCaptureWhenMove:!1,withHotKeys:!0,panWhenDrawing:!1,xAxis:{direction:fv.Right},yAxis:{direction:vv.Bottom}});var ky=function(e){Iv(n,e);var t=wy(n);function n(e,i){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,n),a(Av(o=t.call(this,e,od.Image,s,u)),"imageSuccess",!1),a(Av(o),"events",{on:function(e,t){o.eventsObServer.on(e,t)}}),o.eventsObServer=new I.EventEmitter,o.imageInfo=Hr({},n.defaultImageInfo,i),o.position=o.imageInfo.position,o.grid=o.imageInfo.grid,o}return o(n,[{key:"updateImageInfo",value:function(e){this.imageInfo=Hr({},this.imageInfo,e),e.position&&(this.position=this.imageInfo.position),e.src&&this.updateImage(),this.refresh()}},{key:"updateImage",value:function(){var e=this;this.imageInfo.src&&(this.imageSuccess=!1,this.eventsObServer.emit(ad.LoadStart,this.imageInfo.src,this),this.image=new Image,this.imageInfo.crossOrigin?this.image.setAttribute("crossOrigin","anonymous"):this.image.removeAttribute("crossOrigin"),this.image.src=this.imageInfo.src,this.image.onload=function(){e.imageSuccess=!0,e.map&&e.refresh(),e.eventsObServer.emit(ad.LoadEnd,e.imageInfo.src,e)},this.image.onerror=function(){e.imageSuccess=!1,e.eventsObServer.emit(ad.LoadError,e.imageInfo.src,e)})}},{key:"updateGrid",value:function(e){this.grid=e,this.refresh()}},{key:"onAdd",value:function(e){jv(Dv(n.prototype),"onAdd",this).call(this,e),this.updateImage(),this.refresh()}},{key:"drawImage",value:function(){var e=this.map.transformGlobalToScreen(this.position),t=e.x,n=e.y,r=Zp.dpr,i=this.map.getScale(),o=this.imageInfo,a=o.width*i,s=o.height*i;this.image&&this.imageSuccess&&ed.drawImage(this.canvasContext,{image:this.image,x:t*r,y:n*r,width:a*r,height:s*r},{})}},{key:"drawGrid",value:function(){var e=this,t=this.imageInfo,n=t.width,r=t.height,i=this.position,o=i.x,a=i.y,s=Zp.dpr,u=this.map.xAxis.direction===fv.Right,l=this.map.yAxis.direction===vv.Top,c=Da(this.grid,"columns",[]),h=Da(this.grid,"rows",[]),f=c.length,v=n/(f+1);Mi(c,(function(t,n){var i=t||{},c=i.color,h=void 0===c?"#333":c,f=i.width,p=void 0===f?1:f,d=(n+1)*v,y=u?o+d:o-d,m=a,g=l?a-r:a+r,b=e.map.transformGlobalToScreen({x:y,y:m}),w=e.map.transformGlobalToScreen({x:y,y:g});ed.drawLine(e.canvasContext,{start:{x:b.x*s,y:b.y*s},end:{x:w.x*s,y:w.y*s}},{strokeStyle:h,lineWidth:p})}));var p=h.length,d=r/(p+1);Mi(h,(function(t,r){var i=t||{},c=i.color,h=void 0===c?"#333":c,f=i.width,v=void 0===f?1:f,p=(r+1)*d,y=l?a-p:a+p,m=o,g=u?o+n:o-n,b=e.map.transformGlobalToScreen({x:m,y:y}),w=e.map.transformGlobalToScreen({x:g,y:y});ed.drawLine(e.canvasContext,{start:{x:b.x*s,y:b.y*s},end:{x:w.x*s,y:w.y*s}},{strokeStyle:h,lineWidth:v})}))}},{key:"refresh",value:function(){jv(Dv(n.prototype),"refresh",this).call(this),this.drawImage(),this.drawGrid()}}]),n}(Zp);function Oy(e){var t=Sy();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function Sy(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(ky,"defaultImageInfo",{src:"",width:0,height:0,position:{x:0,y:0},crossOrigin:!1,grid:{columns:[],rows:[]}});var Cy=function(e){Iv(n,e);var t=Oy(n);function n(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),a(Av(i=t.call(this,e,od.Feature,o,s)),"features",[]),i}return o(n,[{key:"addFeature",value:function(e,t){var n=(t||{}).clear;void 0!==n&&n&&(this.features=[],this.clear()),e.onAdd(this),this.features.push(e)}},{key:"removeFeatureById",value:function(e){var t=wv(this.features,(function(t){return t.id!==e||(t.onRemove(),!1)}));this.features=t,this.refresh()}},{key:"getFeatureById",value:function(e){return dy(this.features,(function(t){return t.id===e}))}},{key:"getAllFeatures",value:function(){return this.features}},{key:"removeAllFeatures",value:function(){var e=wv(this.features,(function(e){return e.onRemove(),!1}));this.features=e,this.refresh()}},{key:"getTargetFeatureWithPoint",value:function(e){var t=[];return Mi(this.features,(function(n){if(n.captureWithPoint(e))return t.push(n),!1})),Da(t,"[0]",null)}},{key:"refresh",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.refreshDelayTimer&&(window.clearTimeout(this.refreshDelayTimer),this.refreshDelayTimer=null),jv(Dv(n.prototype),"refresh",this).call(this),t?this.refreshDelayTimer=window.setTimeout((function(){Mi(e.features,(function(e){return e.refresh()}))}),100):Mi(this.features,(function(e){return e.refresh()}))}}]),n}(Zp),Py=ep;function Ay(e,t){return!(null==e||!e.length)&&Py(e,t,0)>-1}var Dy=Ay;function Fy(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}var jy=Fy;function Ry(){}var Iy=au,Ty=Ry,Ey=mh,My=1/0,_y=Iy&&1/Ey(new Iy([,-0]))[1]==My?function(e){return new Iy(e)}:Ty,Ly=ih,By=Dy,zy=jy,Wy=sh,Uy=_y,Gy=mh,Ny=200;function Vy(e,t,n){var r=-1,i=By,o=e.length,a=!0,s=[],u=s;if(n)a=!1,i=zy;else if(o>=Ny){var l=t?null:Uy(e);if(l)return Gy(l);a=!1,i=Wy,u=new Ly}else u=t?[]:s;e:for(;++r<o;){var c=e[r],h=t?t(c):c;if(c=n||0!==c?c:0,a&&h==h){for(var f=u.length;f--;)if(u[f]===h)continue e;t&&u.push(h),s.push(c)}else i(u,h,n)||(u!==s&&u.push(h),s.push(c))}return s}var Ky=Vy;function Yy(e){return e&&e.length?Ky(e):[]}var $y=Yy,Xy=function(){function e(t){r(this,e),a(this,"actions",[]),a(this,"map",{getScale:function(){return 1},transformGlobalToScreen:function(e){var t=e.x,n=e.y,r=this.bounds;return{x:t-r.x,y:n-r.y}}}),this.bounds=t,this.createRenderCanvas(),this.map.getScale=this.map.getScale.bind(this),this.map.transformGlobalToScreen=this.map.transformGlobalToScreen.bind(this)}return o(e,[{key:"createRenderCanvas",value:function(){var e=this.bounds,t=e.width,n=e.height;this.canvas=new OffscreenCanvas(t,n),this.canvas.width=t*Zp.dpr,this.canvas.height=n*Zp.dpr,this.canvasContext=this.canvas.getContext("2d")}},{key:"addAction",value:function(e){e.setStyle({strokeStyle:"#ff0000",fillStyle:"#ff0000"},{refresh:!1}),e.onAdd(this),this.actions.push(e)}},{key:"addActions",value:function(e){var t=this;Mi(e,(function(e){return t.addAction(e)}))}},{key:"getRle",value:function(){for(var e=[],t=Zp.dpr,n=this.bounds,r=n.width,i=n.height,o=this.canvas,a=o.width,s=o.height,u=this.canvasContext.getImageData(0,0,a,s).data,l=0,c=1,h=0;h<i;h++)for(var f=0;f<r;f++){var v=4*(h*t*r+f)*t,p=u[v],d=u[v+1],y=u[v+2],m=u[v+3],g=+!!(p||d||y||m);g===c?l++:(e.push(l),l=1),h+1===i&&f+1===r&&e.push(l),c=g}return e}},{key:"refresh",value:function(){Mi(this.actions,(function(e){return e.refresh()}))}},{key:"clear",value:function(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)}}]),e}();function qy(e){var t=Hy();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function Hy(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Zy=function(e){Iv(n,e);var t=qy(n);function n(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),a(Av(i=t.call(this,e,od.Mask,o,s)),"actions",[]),i}return o(n,[{key:"addAction",value:function(e,t){e.onAdd(this),this.actions.push(e)}},{key:"removeActionById",value:function(e){var t=wv(this.actions,(function(t){return t.id!==e||(t.onRemove(),!1)}));this.actions=t,this.refresh()}},{key:"getAllActions",value:function(){return this.actions}},{key:"removeAllActions",value:function(){var e=wv(this.actions,(function(e){return e.onRemove(),!1}));this.actions=e,this.refresh()}},{key:"setMovingClearAction",value:function(e){e&&e.onAdd(this),!e&&this.refresh()}},{key:"getActionCategories",value:function(){var e=this.actions,t=Nv(e,(function(e){return e.category}));return wv($y(t),(function(e){return!!e}))}},{key:"groupByCategory",value:function(){var e=this.actions,t=this.getActionCategories(),n=[];return Mi(t,(function(t){var r=wv(e,(function(e){var n=e.type;return e.category===t||n===Wp.Clear}));n.push({category:t,actions:r})})),n}},{key:"getGroupRleData",value:function(e,t){var n=e.category,r=e.actions,i=void 0===r?[]:r,o=new Xy(t),a=$c(i);return o.addActions(a),{category:n,rle:o.getRle()}}},{key:"getImageData",value:function(e){var t=e.x,n=e.y,r=e.width,i=e.height,o=this.map.transformGlobalToScreen({x:t,y:n}),a=this.map.getScale(),s=o.x*Zp.dpr,u=o.y*Zp.dpr,l=r/a*Zp.dpr,c=i/a*Zp.dpr;return this.canvasContext.getImageData(s,u,l,c)}},{key:"getImageWithBounds",value:function(e){var t=e.width,n=e.height,r=this.getImageData(e),i=document.createElement("canvas");return i.width=t*Zp.dpr,i.height=n*Zp.dpr,i.style.width=t+"px",i.style.height=n+"px",i.getContext("2d").putImageData(r,0,0),i.toDataURL("image/png",1)}},{key:"getRleData",value:function(e){var t=this,n=this.groupByCategory(),r=[];return Mi(n,(function(n){var i=t.getGroupRleData(n,e);r.push(i)})),r}},{key:"refresh",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.refreshDelayTimer&&(window.clearTimeout(this.refreshDelayTimer),this.refreshDelayTimer=null),jv(Dv(n.prototype),"refresh",this).call(this),t?this.refreshDelayTimer=window.setTimeout((function(){Mi(e.actions,(function(e){return e.refresh()}))}),100):Mi(this.actions,(function(e){return e.refresh()}))}}]),n}(Zp);function Jy(e){var t=Qy();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function Qy(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var em=function(e){Iv(n,e);var t=Jy(n);function n(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),a(Av(i=t.call(this,e,od.Text,o,s)),"texts",[]),i}return o(n,[{key:"addText",value:function(e,t){var n=(t||{}).clear;void 0!==n&&n&&this.clear(),e.onAdd(this),this.texts.push(e)}},{key:"removeTextById",value:function(e){var t=wv(this.texts,(function(t){return t.id!==e||(t.onRemove(),!1)}));this.texts=t,this.refresh()}},{key:"getTextById",value:function(e){return dy(this.texts,(function(t){return t.id===e}))}},{key:"getAllTexts",value:function(){return this.texts}},{key:"removeAllTexts",value:function(){var e=wv(this.texts,(function(e){return e.onRemove(),!1}));this.texts=e,this.refresh()}},{key:"refresh",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.refreshDelayTimer&&(window.clearTimeout(this.refreshDelayTimer),this.refreshDelayTimer=null),jv(Dv(n.prototype),"refresh",this).call(this),t?this.refreshDelayTimer=window.setTimeout((function(){Mi(e.texts,(function(e){return e.refresh()}))}),100):Mi(this.texts,(function(e){return e.refresh()}))}}]),n}(Zp),tm={Text:em,Mask:Zy,Image:ky,Feature:Cy,OverlayLayer:iy,EventLayer:md};function nm(e){var t=rm();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function rm(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var im=function(e){Iv(n,e);var t=nm(n);function n(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r(this,n),(o=t.call(this,e,sd.Arrow,a,s)).shape=i,o}return o(n,[{key:"captureWithPoint",value:function(e){return!1}},{key:"refresh",value:function(){var e;null!==(e=this.layer)&&void 0!==e&&e.map}}]),n}(wd),om={Base:wd,Point:Od,Circle:Vd,Line:Dd,Polyline:Td,Rect:Bd,Polygon:Ud,Arrow:im};function am(e){var t=sm();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function sm(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var um=function(e){Iv(n,e);var t=am(n);function n(e,i,o){var s,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return r(this,n),a(Av(s=t.call(this,e,Wp.Image,u,l)),"category",""),s.imageInfo=Hr({},n.defaultImageInfo,o),s.position=s.imageInfo.position,s.updateImage(),s.category=i,s}return o(n,[{key:"updateImage",value:function(){var e=this;this.imageInfo.src&&(this.image=new Image,this.imageInfo.crossOrigin?this.image.setAttribute("crossOrigin","anonymous"):this.image.removeAttribute("crossOrigin"),this.image.src=this.imageInfo.src,this.image.onload=function(){return e.layer&&e.refresh()})}},{key:"drawImage",value:function(){var e;if(null!==(e=this.layer)&&void 0!==e&&e.map){var t=this.layer.map.transformGlobalToScreen(this.position),n=t.x,r=t.y,i=Zp.dpr,o=this.layer.map.getScale(),a=this.imageInfo,s=a.width*o,u=a.height*o;ed.drawImage(this.layer.canvasContext,{image:this.image,x:n*i,y:r*i,width:s*i,height:u*i},{})}}},{key:"refresh",value:function(){jv(Dv(n.prototype),"refresh",this).call(this),this.drawImage()}}]),n}(Gp);a(um,"defaultImageInfo",{src:"",width:0,height:0,crossOrigin:!1,position:{x:0,y:0}});var lm={Draw:Hd,Clear:ld,Image:um},cm=function(){function e(t,n,i,o){r(this,e),this.id=t,this.type=n,this.props=i||{},this.option=o||{},this.domId="control-grid-".concat(t,"-wrapper"),this.createContainer()}return o(e,[{key:"createContainer",value:function(){this.dom||(this.dom=document.createElement("div"),this.dom.setAttribute("id",this.domId),this.dom.style.position="absolute",this.dom.style.left="0",this.dom.style.top="0",this.dom.style.zIndex="20")}},{key:"onAdd",value:function(e){this.map=e,this.map.dom.appendChild(this.dom)}},{key:"onRemove",value:function(){var e=document.getElementById(this.domId);e&&e.remove()}},{key:"updatePosition",value:function(e){this.position=e,this.refresh()}},{key:"refresh",value:function(){}},{key:"printInfo",value:function(){}}]),e}();function hm(e){var t=fm();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function fm(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var vm,pm=function(e){Iv(n,e);var t=hm(n);function n(){return r(this,n),t.call(this)}return o(n,[{key:"refresh",value:function(){}}]),n}(cm);function dm(e){var t=ym();return function(){var n,r=Dv(e);if(t){var i=Dv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ev(this,n)}}function ym(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}!function(e){e.Scale="SCALE",e.Grid="GRID"}(vm||(vm={}));var mm=function(e){Iv(n,e);var t=dm(n);function n(e,i,o,a){var s;return r(this,n),(s=t.call(this,e,vm.Grid,o,a)).gridInfo=Hr({},n.defaultGridInfo,i),s.creatCanvasElement(),s.refreshElement(),s}return o(n,[{key:"refreshElement",value:function(){this.setContainerSize(),this.setContainerPosition(),this.setContainerStyle(),this.setRenderCanvasSize()}},{key:"setContainerSize",value:function(){var e=this.gridInfo.size,t=e.width,n=e.height;this.dom.style.width=t+"px",this.dom.style.height=n+"px"}},{key:"setContainerPosition",value:function(){var e=this.gridInfo.position,t=e.left,n=e.top,r=e.right,i=e.bottom;this.dom.style.left=Ta(t)?"".concat(t,"px"):"initial",this.dom.style.right=Ta(r)?"".concat(r,"px"):"initial",this.dom.style.top=Ta(n)?"".concat(n,"px"):"initial",this.dom.style.bottom=Ta(i)?"".concat(i,"px"):"initial"}},{key:"setContainerStyle",value:function(){this.dom.style.border="1px solid red"}},{key:"creatCanvasElement",value:function(){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.dom.appendChild(this.canvas),this.canvasContext=this.canvas.getContext("2d")}},{key:"setRenderCanvasSize",value:function(){var e=this.gridInfo.size,t=e.width,n=e.height;this.canvas.width=t*Zp.dpr,this.canvas.height=n*Zp.dpr,this.canvas.style.width=t+"px",this.canvas.style.height=n+"px"}},{key:"refresh",value:function(){}}]),n}(cm);a(mm,"defaultGridInfo",{position:{right:10,bottom:10},size:{width:200,height:200},grid:{columns:[],rows:[]}});var gm={Scale:pm,Grid:mm};function bm(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wm(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bm(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bm(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var xm=function(){function e(t,n){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,e),a(this,"dragging",!1),a(this,"draggingEnabled",!1),a(this,"events",{on:function(e,t){i.eventsObServer.on(e,t)}}),this.id=t,this.type=cd.Marker,this.props=o,this.markerInfo=Hr({},e.defaultMarkerInfo,n),this.updateImage(),this.eventsObServer=new I.EventEmitter}return o(e,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){var e=document.getElementById(this.id);e&&e.remove()}},{key:"enableDragging",value:function(){this.draggingEnabled=!0,this.dragging=!1}},{key:"disableDragging",value:function(){this.draggingEnabled=!1,this.dragging=!1}},{key:"updateImage",value:function(){var e=this;this.markerInfo.src&&(this.image=new Image,this.image.id=this.id,this.image.setAttribute("data-type",this.type),this.image.style.position="absolute",this.image.style.cursor="pointer",this.image.style.userSelect="none",this.image.src=this.markerInfo.src,this.image.onload=function(){var t,n;null===(t=e.layer)||void 0===t||null===(n=t.dom)||void 0===n||n.appendChild(e.image),e.attachEvents()},this.image.onerror=function(){})}},{key:"updatePosition",value:function(e){var t=this.markerInfo;this.markerInfo=wm(wm({},t),{},{position:e}),this.refresh()}},{key:"handleMouseDown",value:function(e){var t=this,n=e.screenX,r=e.screenY;this.startPageScreenPoint={x:n,y:r},this.toUpdatePosition=null;var i=fd.EventUtil.getButtonIndex(e);this.eventsObServer.emit(hd.MouseDown,this),2===i&&this.eventsObServer.emit(hd.RightClick,this),this.draggingEnabled&&(this.dragging=!0,document.onmousemove=function(e){return t.handleMarkerMove(e)},document.onmouseup=function(e){return t.handleMarkerUp(e)},this.eventsObServer.emit(hd.DragStart,this))}},{key:"handleMarkerMove",value:function(e){var t=this.layer.map.getScale(),n=e.screenX,r=e.screenY,i=this.startPageScreenPoint,o=(n-i.x)/t,a=(r-i.y)/t,s=this.layer.map.xAxis.direction===fv.Right?o:-o,u=this.layer.map.yAxis.direction===vv.Top?a:-a,l=this.markerInfo.position;this.toUpdatePosition={x:l.x+s,y:l.y-u},this.refresh(this.toUpdatePosition),this.eventsObServer.emit(hd.Dragging,this,this.toUpdatePosition)}},{key:"handleMarkerUp",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null,this.toUpdatePosition&&(this.refresh(),this.eventsObServer.emit(hd.DragEnd,this,this.toUpdatePosition)),this.toUpdatePosition=null}},{key:"handleMouseUp",value:function(e){this.eventsObServer.emit(hd.MouseUp,this)}},{key:"handleMouseOver",value:function(e){var t,n;this.layer.map.eventLayer.breakFeatureCapture=!0,null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n||n.tipLayer.removeAllFeatureActionText(),this.eventsObServer.emit(hd.MouseOver,this)}},{key:"handleMouseOut",value:function(e){this.eventsObServer.emit(hd.MouseOut,this)}},{key:"handleClick",value:function(e){this.eventsObServer.emit(hd.Click,this)}},{key:"attachEvents",value:function(){var e=this;this.image.onmousedown=function(t){return e.handleMouseDown(t)},this.image.onmouseup=function(t){return e.handleMouseUp(t)},this.image.onmouseover=function(t){return e.handleMouseOver(t)},this.image.onmouseout=function(t){return e.handleMouseOut(t)},this.image.onclick=function(t){return e.handleClick(t)}}},{key:"refresh",value:function(e){var t=this.markerInfo,n=t.position,r=t.offset,i=e||n,o=this.layer.map.transformGlobalToScreen(i),a=o.x,s=o.y,u=a+r.x,l=s-r.y;this.image.style.left="".concat(u,"px"),this.image.style.top="".concat(l,"px")}},{key:"printInfo",value:function(){}}]),e}();return a(xm,"defaultMarkerInfo",{src:"",position:{x:0,y:0},offset:{x:0,y:0}}),{Map:by,Layer:tm,Feature:om,Mask:lm,Control:gm,Text:Qd,Marker:xm,Util:fd,version:"5.1.7"}}();var z=B.exports;var W=c((function(){var e=L.serviceDiscovery().cameraFns,t=C.serviceDiscovery(),n=t.fnOptions,i=t.notify,o=t.cameras,a=t.cameraImage,u=t.currentActiveCameraFn,c=t.setCurrentActiveCameraFn,f=t.currentActiveCameraFnEntity,v=t.setCurrentActiveCameraFnEntity,p=t.currentActiveCamera,d=t.currentActiveCameraEntity,y=t.getCurrentActiveCameraEntityValue,m=t.setCameraFnImage,g=t.requestCameraFnImage,w=t.handleUpdate,x="-@-",k={searchCameraFn:function(t){return e.value.find((function(e){return e.name===t}))},removeCameraFn:function(t){return e.value.splice(k.searchCameraFnPosition(t),1)},createCameraFn:function(t){e.value.push(t),o.value.find((function(e){return e.name===d.value.name})).functions=e.value},searchCameraFnPosition:function(t){return e.value.findIndex((function(e){return e.name===t}))}},O=r(h("INIT"),2),S=O[0],P=O[1];s(i,g),s(p,(function(){return P("INIT")})),s(e,(function(e){if(!Boolean(e.length))return m(null);switch(S.value){case"INIT":var t=e[0];c("".concat(y("name")).concat(x).concat(t.name));break;case"CREATE":var n=e[e.length-1];c("".concat(y("name")).concat(x).concat(n.name))}}),{deep:!0}),s(u,(function(e){var t=r(e.split(x),2)[1],n=k.searchCameraFn(t);if(n&&(v(n),"TOGGLE"===S.value))g()}));var A=r(h({}),2),D=A[0],F=A[1],j=r(h(""),2),R=j[0],I=j[1],T=r(h(!1),2),E=T[0],M=T[1];s(n,(function(e){if(Boolean(e.length)){var t=r(e,1)[0];F(t),I(t.name)}})),s(R,(function(e){var t=n.value.find((function(t){return t.name===e}));t&&F(t)}));var _,B,W,U=r(h([]),2),G=U[0],N=U[1],V=r(h(!1),2),K=V[0],Y=V[1],$=function(){f.value.parameters.points=G.value,Y(!1),g(),w()};return s(K,(function(e){if(e){if(_=new z.Map("map",{mode:"PAN",center:{x:b.width/2,y:b.height/2},withHotKeys:!0,panWhenDrawing:!0,zoomWheelRatio:5,zoomWhenDrawing:!0,refreshDelayWhenZooming:!0}),B=new z.Layer.Image("layer-image",{src:a.value,grid:{rows:[{color:"#9370DB"},{color:"#FF6347"}],columns:[{color:"#9370DB"},{color:"#FF6347"}]},width:b.width,height:b.height,position:{x:0,y:0},crossOrigin:!0},{name:"图片图层"}),W=new z.Layer.Feature("layer-feature",{name:"矢量图层"}),_.events.on("drawDone",(function(e,t){var n=t.map((function(e){return[e.x,e.y]}));N(n);var r=new z.Feature.Polygon("".concat(+new Date),{points:t},{name:"矢量图形"},{strokeStyle:"#00f",fillStyle:"#0f0",globalAlpha:.3,lineWidth:1,fill:!0,stroke:!0});W.addFeature(r),$()})),f.value.parameters.points){var t=f.value.parameters.points.map((function(e){var t=r(e,2);return{x:t[0],y:t[1]}})),n=new z.Feature.Polygon("".concat(+new Date),{points:t},{name:"矢量图形"},{strokeStyle:"#00f",fillStyle:"#0f0",globalAlpha:.3,lineWidth:1,fill:!0,stroke:!0});setTimeout((function(){return W.addFeature(n)}))}_.addLayer(B),_.addLayer(W)}else _.destroy()}),{flush:"post"}),{separator:x,selectFn:D,selectFnName:R,selectFnVisible:E,setSelectFnVisible:M,handleCreateFn:function(){P("CREATE");var e=D.value,t=e.name,n=e.parameters;if(~k.searchCameraFnPosition(t))return l("error","该功能组件已添加 ~");var r={};n.forEach((function(e){"list"===e.type?r.points=e.default:r[e.name]=e.default})),k.createCameraFn({name:t,parameters:r}),w()},handleRemoveFn:function(t){P("REMOVE");var n=r(t.split(x),2),i=n[0],o=n[1];u.value===t&&e.value.forEach((function(t,n){if(t.name===o){var r=e.value[n+1]||e.value[n-1];r&&c("".concat(i).concat(x).concat(r.name))}})),k.removeCameraFn(o)},handlePointInput:function(e,t,n,r){isFinite(n)&&r(e,t,n)},handleTabBeforeLeave:function(){return P("TOGGLE")},setMode:function(e){return _.setMode(e)},handleReset:function(){N([]),$()},handleSetPoints:$,currentFnImageVisible:K,setCurrentFnImageVisible:Y}})),U={};U.props={name:{key:"name",required:!0,type:String}},U.setup=function(e,t){var n=e,r=L.serviceDiscovery(),i=r.cameraFns,o=r.hasCameraFn,a=W.serviceDiscovery(),s=a.separator,u=a.setSelectFnVisible,l=a.setCurrentFnImageVisible,c=a.handleRemoveFn,h=a.handlePointInput,f=a.handleTabBeforeLeave,v=C.serviceDiscovery();return{props:n,cameraFns:i,hasCameraFn:o,separator:s,setSelectFnVisible:u,setCurrentFnImageVisible:l,handleRemoveFn:c,handlePointInput:h,handleTabBeforeLeave:f,loading:v.loading,hasFnOption:v.hasFnOption,getFnDisplayName:v.getFnDisplayName,cameraImage:v.cameraImage,requestCameraFnImage:v.requestCameraFnImage,currentActiveCameraFn:v.currentActiveCameraFn,currentActiveCameraFnEntity:v.currentActiveCameraFnEntity}};var G={},N=w(U,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{"margin-top":"16px"}},[n("el-card",{attrs:{shadow:"never"},scopedSlots:e._u([{key:"header",fn:function(){return[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[e._v("AI 功能配置")]),n("el-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:function(t){return e.setSelectFnVisible(!0)}}},[n("span",[e._v("添加功能组件")])])],1)]},proxy:!0}])},[e.hasCameraFn?e.hasFnOption?[n("el-tabs",{staticClass:"fn",attrs:{closable:"",type:"card","tab-position":"left","before-leave":e.handleTabBeforeLeave},on:{"tab-remove":e.handleRemoveFn},model:{value:e.currentActiveCameraFn,callback:function(t){e.currentActiveCameraFn=t},expression:"currentActiveCameraFn"}},e._l(e.cameraFns,(function(t){return n("el-tab-pane",{key:""+e.props.name+e.separator+t.name,attrs:{name:""+e.props.name+e.separator+t.name,label:e.getFnDisplayName(t.name)}},[e.currentActiveCameraFnEntity.parameters?n("el-form",{attrs:{"label-position":"top"}},[n("el-row",[n("el-col",{attrs:{span:8}},[e.currentActiveCameraFnEntity.parameters.num_threshold?n("el-form-item",{attrs:{label:"人数阈值"}},[n("el-input-number",{attrs:{min:0},model:{value:e.currentActiveCameraFnEntity.parameters.num_threshold,callback:function(t){e.$set(e.currentActiveCameraFnEntity.parameters,"num_threshold",t)},expression:"currentActiveCameraFnEntity.parameters.num_threshold"}})],1):e._e(),n("el-form-item",{attrs:{label:"最小像素阈值"}},[n("el-input-number",{attrs:{min:0},model:{value:e.currentActiveCameraFnEntity.parameters.tiny_threshold,callback:function(t){e.$set(e.currentActiveCameraFnEntity.parameters,"tiny_threshold",t)},expression:"currentActiveCameraFnEntity.parameters.tiny_threshold"}})],1),n("el-form-item",{attrs:{label:"连续性阀值"}},[n("el-input-number",{attrs:{min:0},model:{value:e.currentActiveCameraFnEntity.parameters.contiguous_threshold,callback:function(t){e.$set(e.currentActiveCameraFnEntity.parameters,"contiguous_threshold",t)},expression:"currentActiveCameraFnEntity.parameters.contiguous_threshold"}})],1),n("el-form-item",{attrs:{label:"间隔时间阈值"}},[n("el-input-number",{attrs:{min:0},model:{value:e.currentActiveCameraFnEntity.parameters.interval_seconds,callback:function(t){e.$set(e.currentActiveCameraFnEntity.parameters,"interval_seconds",t)},expression:"currentActiveCameraFnEntity.parameters.interval_seconds"}})],1)],1),n("el-col",{attrs:{span:16}},[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[e._v("有效分析区域")]),n("div",[n("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-edit",loading:e.loading,disabled:!e.cameraImage},on:{click:function(t){return e.setCurrentFnImageVisible(!0)}}},[n("span",[e._v("划线")])]),n("el-button",{staticStyle:{"margin-left":"16px"},attrs:{size:"mini",type:"primary",icon:"el-icon-refresh",loading:e.loading},on:{click:e.requestCameraFnImage}},[n("span",[e._v("刷新图片")])])],1)]),e.currentActiveCameraFnEntity.parameters?e._l(e.currentActiveCameraFnEntity.parameters.points,(function(t,r){return n("el-row",{key:r,staticClass:"point",staticStyle:{"margin-top":"16px"},attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("el-col",{attrs:{span:4}},[n("el-tag",{attrs:{effect:"dark"}},[e._v(e._s("点 "+(r+1)))])],1),n("el-col",{staticStyle:{"padding-right":"8px"},attrs:{span:10}},[n("el-tooltip",{attrs:{placement:"top","open-delay":300,content:"X 坐标："+t[0]}},[n("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",value:t[0]},on:{input:function(n){return e.handlePointInput(t,0,n,e.$set)}}})],1)],1),n("el-col",{staticStyle:{"padding-left":"8px"},attrs:{span:10}},[n("el-tooltip",{attrs:{placement:"top","open-delay":300,content:"Y 坐标："+t[1]}},[n("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",value:t[1]},on:{input:function(n){return e.handlePointInput(t,1,n,e.$set)}}})],1)],1)],1)})):e._e()],2)],1)],1):e._e()],1)})),1)]:n("el-empty",{attrs:{description:"功能组件列表初始化失败，请刷新重新获取数据"}}):n("el-empty",{attrs:{description:"暂无功能组件，请点击上方按钮进行添加"}})],2)],1)}),[],!1,V,null,null,null);function V(e){for(var t in G)this[t]=G[t]}var K=function(){return N.exports}(),Y={setup:function(e,t){var n=W.serviceRegister(),r=n.selectFn,i=n.selectFnName,o=n.selectFnVisible,a=n.currentFnImageVisible,s=n.setCurrentFnImageVisible,u=n.setMode,l=n.handleReset,c=n.handleCreateFn,h=n.handleSetPoints,f=L.serviceDiscovery(),v=f.handleCreateCamera,p=f.handleRemoveCamera,d=f.handleCameraUrlInput,y=f.handleTabBeforeLeave,m=C.serviceDiscovery();return{selectFn:r,selectFnName:i,selectFnVisible:o,currentFnImageVisible:a,setCurrentFnImageVisible:s,setMode:u,handleReset:l,handleCreateFn:c,handleSetPoints:h,handleCreateCamera:v,handleRemoveCamera:p,handleCameraUrlInput:d,handleTabBeforeLeave:y,loading:m.loading,cameras:m.cameras,hasCamera:m.hasCamera,fnOptions:m.fnOptions,currentActiveCamera:m.currentActiveCamera,currentActiveCameraEntity:m.currentActiveCameraEntity,cameraImage:m.cameraImage,cameraFnImage:m.cameraFnImage,requestCameraImage:m.requestCameraImage}}};Y.components=Object.assign({CameraFn:K},Y.components);var $={},X=w(Y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-divider",[n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreateCamera}},[e._v("添加摄像头")])],1),e.hasCamera?[n("el-tabs",{attrs:{closable:"",type:"card","before-leave":e.handleTabBeforeLeave},on:{"tab-remove":e.handleRemoveCamera},model:{value:e.currentActiveCamera,callback:function(t){e.currentActiveCamera=t},expression:"currentActiveCamera"}},e._l(e.cameras,(function(t){return n("el-tab-pane",{key:t.name,attrs:{name:t.name,label:t.name}},[n("el-row",{attrs:{type:"flex"}},[n("el-col",{attrs:{span:18}},[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("el-tooltip",{attrs:{content:"推流地址",placement:"top"}},[n("el-input",{staticStyle:{width:"100%"},attrs:{value:e.currentActiveCameraEntity.url},on:{input:e.handleCameraUrlInput}})],1),n("el-button",{staticStyle:{"margin-left":"16px"},attrs:{size:"small",type:"primary",icon:"el-icon-refresh",loading:e.loading},on:{click:e.requestCameraImage}},[n("span",[e._v("刷新图片")])])],1),n("CameraFn",{attrs:{name:t.name}})],1),n("el-col",{attrs:{span:5,offset:1}},[n("el-row",{staticStyle:{height:"100%","flex-direction":"column"},attrs:{type:"flex"}},[n("div",[e.cameraImage?n("el-image",{staticStyle:{width:"100%"},attrs:{src:e.cameraImage,"preview-src-list":[e.cameraImage]}}):n("el-empty",{attrs:{description:"无法加载预览图片，请检查推流地址是否填写或填写正确"}})],1),n("el-divider"),n("div",[e.loading?n("el-empty",{attrs:{description:"请等待摄像头图片加载完成 ..."}}):e.cameraImage?e.cameraImage&&!e.cameraFnImage?n("el-empty",{attrs:{description:"无法加载多边形区域预览图片，请检查点位是否拾取或拾取正确 ..."}}):[n("el-image",{staticStyle:{width:"100%"},attrs:{src:e.cameraFnImage,"preview-src-list":[e.cameraFnImage]}})]:n("el-empty",{attrs:{description:"请先加载摄像头图片"}})],2)],1)],1)],1)],1)})),1)]:n("el-empty",{attrs:{description:"暂无摄像头配置，请点击上方按钮进行添加"}}),n("el-drawer",{attrs:{"append-to-body":"",size:"100%","custom-class":"select-point","show-close":!1,visible:e.currentFnImageVisible},on:{"update:visible":function(t){e.currentFnImageVisible=t}},scopedSlots:e._u([{key:"title",fn:function(){return[n("el-row",{staticStyle:{"z-index":"999"},attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[n("i",{staticClass:"m-r-8 el-icon-view"}),n("span",[e._v("划分区域")])]),n("div",[n("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-close"},on:{click:function(t){return e.setCurrentFnImageVisible(!1)}}},[e._v("取消")]),n("el-button",{attrs:{size:"small",icon:"el-icon-rank"},on:{click:function(t){return e.setMode("PAN")}}},[e._v("拖动")]),n("el-button",{attrs:{size:"small",type:"info",icon:"el-icon-refresh-left"},on:{click:e.handleReset}},[e._v("重置")]),n("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-edit"},on:{click:function(t){return e.setMode("POLYGON")}}},[e._v("划线")]),n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-check"},on:{click:e.handleSetPoints}},[e._v("确定")])],1)])]},proxy:!0}])},[n("div",{staticStyle:{height:"100%"},attrs:{id:"map"}})]),n("el-drawer",{attrs:{"append-to-body":"",size:"40%","show-close":!1,visible:e.selectFnVisible},on:{"update:visible":function(t){e.selectFnVisible=t}},scopedSlots:e._u([{key:"title",fn:function(){return[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[n("i",{staticClass:"m-r-8 el-icon-view"}),n("span",[e._v("功能组件列表及介绍")])]),n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreateFn}},[e._v("确定添加")])],1)]},proxy:!0}])},[n("el-tabs",{model:{value:e.selectFnName,callback:function(t){e.selectFnName=t},expression:"selectFnName"}},e._l(e.fnOptions,(function(t){return n("el-tab-pane",{key:t.name,attrs:{name:t.name,label:t.display}},[n("el-alert",{attrs:{type:"warning",title:e.selectFn.name,description:e.selectFn.description,closable:!1}}),e._l(e.selectFn.parameters,(function(t){return n("el-row",{key:t.name},[n("el-divider",[e._v(e._s(t.display))]),n("el-alert",{attrs:{type:"info",closable:!1,description:t.description},scopedSlots:e._u([{key:"title",fn:function(){return[n("el-tooltip",{attrs:{content:"字段",placement:"top"}},[n("el-tag",{staticStyle:{"margin-right":"16px"},attrs:{size:"small",effect:"dark",type:"success"}},[e._v(e._s(t.name))])],1),n("el-tooltip",{attrs:{content:"类型",placement:"top"}},[n("el-tag",{staticStyle:{"margin-right":"16px"},attrs:{size:"small",effect:"dark",type:"warning"}},[e._v(e._s(t.type))])],1),n("el-tooltip",{attrs:{content:"默认值",placement:"top"}},[n("el-tag",{attrs:{size:"small",effect:"dark"}},[e._v(e._s(t.default))])],1)]},proxy:!0}],null,!0)})],1)}))],2)})),1)],1)],2)}),[],!1,q,null,null,null);function q(e){for(var t in $)this[t]=$[t]}var H=function(){return X.exports}(),Z={setup:function(e,t){L.serviceRegister();var n=C.serviceDiscovery(),r=n.config,i=n.loading,o=n.request,a=n.currentActiveConfig,s=n.jsonVisible,u=n.setJsonVisible,l=n.handleUpdate,c=n.handleResetBefore;return{Tabs:k,config:r,loading:i,request:o,currentActiveConfig:a,jsonVisible:s,setJsonVisible:u,handleUpdate:l,handleResetBefore:c}}};Z.components=Object.assign({Infer:j,Camera:H,Report:_},Z.components);var J={},Q=w(Z,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[n("el-card",{scopedSlots:e._u([{key:"header",fn:function(){return[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[e._v("AI 功能配置")]),n("div",[n("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-refresh-left",loading:e.loading},on:{click:e.handleResetBefore}},[n("span",[e._v("重置")])]),n("el-button",{attrs:{size:"small",icon:"el-icon-refresh",loading:e.loading},on:{click:e.request}},[e._v("刷新")]),n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-check",loading:e.loading},on:{click:e.handleUpdate}},[e._v("保存")]),n("el-button",{attrs:{size:"small",type:"info",icon:"el-icon-view",loading:e.loading},on:{click:function(t){return e.setJsonVisible(!0)}}},[e._v("查看配置")])],1)])]},proxy:!0}])},[n("el-tabs",{model:{value:e.currentActiveConfig,callback:function(t){e.currentActiveConfig=t},expression:"currentActiveConfig"}},[n("el-tab-pane",{attrs:{label:"推理引擎配置",name:e.Tabs.INFER}},[n("Infer")],1),n("el-tab-pane",{attrs:{label:"摄像头组件配置",name:e.Tabs.CAMERA}},[n("Camera")],1),n("el-tab-pane",{attrs:{label:"平台上报配置",name:e.Tabs.REPORT}},[n("Report")],1)],1)],1),n("el-drawer",{attrs:{size:"50%","show-close":!1,visible:e.jsonVisible},on:{"update:visible":function(t){e.jsonVisible=t}},scopedSlots:e._u([{key:"title",fn:function(){return[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[n("i",{staticClass:"m-r-8 el-icon-view"}),n("span",[e._v("配置总览")])]),n("el-button",{attrs:{size:"small",icon:"el-icon-close"},on:{click:function(t){return e.setJsonVisible(!1)}}},[e._v("关闭")])],1)]},proxy:!0}])},[n("el-card",[n("pre",[e._v(e._s(JSON.stringify(e.config,null,2)))])])],1)],1)}),[],!1,ee,null,null,null);function ee(e){for(var t in J)this[t]=J[t]}var te=function(){return Q.exports}(),ne={setup:function(e,t){return C.serviceRegister(),{}}};ne.components=Object.assign({IndexWrapper:te},ne.components);var re={},ie=w(ne,(function(){var e=this.$createElement;return(this._self._c||e)("IndexWrapper")}),[],!1,oe,null,null,null);function oe(e){for(var t in re)this[t]=re[t]}t("default",function(){return ie.exports}())}}}))}();
