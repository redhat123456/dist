import{u as e}from"./useComposables.07b7fc4f.js";import{u as t,a}from"./useRequestor.ce90c02e.js";import{r as n,d as l,w as o}from"./vendor.b8049c8b.js";import{n as i}from"./index.a21b1831.js";class r{}function s(){const i=n([]),s=n([]),[c,d]=e(!1),u=l((()=>!!s.value.length)),p=l((()=>{const[e,t]=s.value;let a=e;return t&&(a+=`-${t}`),a})),[v,m]=e(""),f=async()=>{try{d(!0);const[e,a]=s.value,n=await function(e,a){let n=`${r.Basic}/${e}`;return a&&(n+=`/${a}`),t.request({url:n,responseType:"text"})}(e,a);setTimeout((()=>{m(n)}),1e3)}catch(e){a("error","拉取日志失败，请刷新或稍后重试~")}finally{d(!1)}};return(async()=>{try{d(!0);const{data:e}=await t.request({url:r.Basic}),{names:a,history:n}=e;i.value=a.map((e=>({label:e,value:e,children:n[e].map((e=>({label:e,value:e})))}))),s.value=[i.value[0].value]}catch(e){}finally{d(!1)}})(),o(s,f),{options:i,currentOption:s,text:v,loading:c,disabled:u,requestText:f,handleDownload:async()=>{try{d(!0);const e=new Blob([v.value],{type:"text/plain;charset=utf-8"}),t=document.createElement("a"),a=window.URL.createObjectURL(e);t.href=a,t.download=p.value,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(a)}catch(e){}finally{d(!1)}}}}r.Basic="/log";const c={setup:(e,t)=>{const{options:a,currentOption:n,text:l,loading:o,disabled:i,requestText:r,handleDownload:c}=s();return{options:a,currentOption:n,text:l,loading:o,disabled:i,requestText:r,handleDownload:c}}};const d={};var u=i(c,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tooltip",{attrs:{effect:"dark",content:"刷新"}},[a("el-button",{attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-refresh",loading:e.loading,disabled:!e.disabled},on:{click:e.requestText}})],1),a("el-divider",{attrs:{direction:"vertical"}}),a("el-cascader",{attrs:{size:"small",placeholder:"请选择模块（日期可选）",props:{checkStrictly:!0},options:e.options},model:{value:e.currentOption,callback:function(t){e.currentOption=t},expression:"currentOption"}}),a("el-divider",{attrs:{direction:"vertical"}}),a("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-download",loading:e.loading,disabled:!e.disabled},on:{click:e.handleDownload}},[a("span",[e._v("下载")])]),a("el-divider"),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("pre",{staticStyle:{height:"100%"}},[e._v(e._s(e.text))])])],1)}),[],!1,p,null,null,null);function p(e){for(let t in d)this[t]=d[t]}var v=function(){return u.exports}();export{v as default};
