import{c as e,u as t,a}from"./useComposables.07b7fc4f.js";import{r as n,w as l,d as s,h as r,e as i}from"./vendor.b8049c8b.js";import{u as o,a as c}from"./useRequestor.ce90c02e.js";import{n as d}from"./index.a21b1831.js";const u=class{};let p=u;p.Basic="/person",p.Face="/face",p.Faces=e=>`${u.Basic}/${e}/face`;const h=e((function(){const[e,d]=t(0),u=n({page:1,size:10,name:"",title:""}),[h,v,g]=a((async()=>{const{data:e}=await(t=u.value,o.request({url:p.Basic,params:t}));var t;return d(e.total),e.items}),[]);l(u,h,{deep:!0});const f="all",[m,y]=t(f),[b,_]=t(!1),[x,z]=t([]),C=s((()=>{const e=[];for(let t=0;t<x.value.length;t+=8)e.push(x.value.slice(t,t+8));return e})),S=r({page:1,size:50}),w=n(0),R=async e=>{if(y(e),e===f)try{_(!0);const{data:e}=await(a=S.page,n=S.size,o.request({url:p.Face,params:{page:a,size:n}}));z(e.items),w.value=e.total}catch(l){}finally{_(!1)}else try{_(!0);const{data:a}=await(t=e,o.request({url:`${p.Basic}/${t}`}));z(a.faces)}catch(l){}finally{_(!1)}var t,a,n};l(S,(()=>R(f)),{deep:!0}),R(f);const[k,T]=t([]),[P,B]=t(!1);return l(P,(e=>!e&&T([]))),{files:k,loading:g,records:v,total:e,handleReset:()=>{u.value.page=1,u.value.size=10,u.value.name="",u.value.title="",R(f),S.page=1,S.size=50},handleDelete:async e=>{i.exports.MessageBox.confirm("删除人员的同时也会删除他所有的人脸照片！","警告",{type:"error",cancelButtonText:"取消",confirmButtonText:"确定"}).then((async()=>{try{const{status_code:t,status_info:a}=await function(e){return o.request({url:`${p.Basic}/${e}`,method:"DELETE"})}(e);i.exports.Message[0===t?"success":"error"](a)}catch(t){}finally{h()}})).catch((()=>{}))},handleChangeSize:e=>u.value.size=e,handleChangePage:e=>u.value.page=e,params:u,request:h,visible:P,setVisible:B,handleChange:(e,t)=>e&&T([...t.map((e=>e.raw))]),handleRemove:()=>{},handleRemoveFace:async e=>{i.exports.MessageBox.confirm("确定要删除吗？","警告",{type:"error",cancelButtonText:"取消",confirmButtonText:"确定"}).then((async()=>{try{const{status_code:a,status_info:n}=await(t=e,o.request({url:`${p.Face}/${t}`,method:"DELETE"}));i.exports.Message[0===a?"success":"error"](n)}catch(a){}finally{R(m.value)}var t})).catch((()=>{}))},handleCreateFace:e=>{B(!0),y(e)},handleHttpRequest:async()=>{const e={};k.value.forEach(((t,a)=>e[a]=t));try{const t=await function(e,t){return o.uploadFile({url:p.Faces(e)},{data:t,file:null})}(m.value,e),{status_code:a,status_info:n}=t.data;i.exports.Message[0===a?"success":"error"](n)}catch(t){c("error",t.message.includes("413")?"图片过大，上传失败~":"未知错误，请联系管理员~")}finally{T([]),B(!1),R(m.value)}},state:S,faces:x,stateTotal:w,faceGroups:C,faceLoading:b,defaultActive:f,currentPerson:m,handleSelectPerson:R,handleChangeStateSize:e=>S.size=e,handleChangeStatePage:e=>S.page=e}}));const v=e((function(){const{request:e}=h.serviceDiscovery(),[a,l]=t(),[c,d]=t("INIT"),[u,v]=t(!1),[g,f]=t(!1),m=r({name:"",title:""}),y=r({name:[{required:!0,message:"请填写姓名"}],title:[{required:!0,message:"请填写职位"}]}),b=n(null),_=()=>{var e;d("INIT"),f(!1),v(!1),null==(e=b.value)||e.resetFields(),l(),m.name="",m.title=""},x=()=>{e(),_()},z=async()=>{var e,t;try{await(null==(e=b.value)?void 0:e.validate())}catch(a){return}try{v(!0);const{status_code:e,status_info:a}=await(t=m,o.request({url:p.Basic,data:t,method:"POST"}));i.exports.Message[0===e?"success":"error"](a)}catch(a){}finally{x()}},C=async()=>{var e;try{await(null==(e=b.value)?void 0:e.validate())}catch(t){return}try{v(!0);const{status_code:e,status_info:t}=await function(e,t){return o.request({url:`${p.Basic}/${e}`,data:t,method:"PUT"})}(a.value,m);i.exports.Message[0===e?"success":"error"](t)}catch(t){}finally{x()}},S=s((()=>"CREATE"===c.value)),w=s((()=>S.value?z:C)),R=s((()=>S.value?"添加人员":"编辑人员"));return{rules:y,model:m,visible:g,loading:u,formRef:b,headerText:R,setMode:d,handler:w,handleInit:_,handleCreateBefore:()=>{d("CREATE"),f(!0)},handleUpdateBefore:e=>{l(e.id),m.name=e.name,m.title=e.title,d("UPDATE"),f(!0)}}})),g={setup:(e,t)=>{const{headerText:a,visible:n,loading:l,formRef:s,rules:r,model:i,handleInit:o,handler:c}=v.serviceDiscovery();return{headerText:a,visible:n,loading:l,formRef:s,rules:r,model:i,handleInit:o,handler:c}}};const f={};var m=d(g,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{width:"25%",title:e.headerText,visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{ref:"formRef",attrs:{"label-position":"top",model:e.model,rules:e.rules}},[a("el-form-item",{attrs:{label:"姓名",prop:"name"}},[a("el-input",{model:{value:e.model.name,callback:function(t){e.$set(e.model,"name",t)},expression:"model.name"}})],1),a("el-form-item",{attrs:{label:"职位",prop:"title"}},[a("el-input",{model:{value:e.model.title,callback:function(t){e.$set(e.model,"title",t)},expression:"model.title"}})],1),a("el-form-item",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"warning",icon:"el-icon-close",loading:e.loading},on:{click:e.handleInit}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",icon:"el-icon-check",loading:e.loading},on:{click:e.handler}},[e._v("提交")])],1)],1)],1)}),[],!1,y,null,null,null);function y(e){for(let t in f)this[t]=f[t]}var b=function(){return m.exports}();const _={setup:(e,t)=>{const{handleCreateBefore:a}=v.serviceDiscovery(),{params:n,loading:l,request:s,handleReset:r}=h.serviceDiscovery();return{handleCreateBefore:a,params:n,loading:l,request:s,handleReset:r}}};const x={};var z=d(_,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tooltip",{attrs:{effect:"dark",content:"刷新"}},[a("el-button",{attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-refresh",loading:e.loading},on:{click:e.request}})],1),a("el-divider",{attrs:{direction:"vertical"}}),a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus",loading:e.loading},on:{click:e.handleCreateBefore}},[e._v("添加人员")]),a("el-divider",{attrs:{direction:"vertical"}}),a("el-input",{staticClass:"w-200",attrs:{clearable:"",size:"small",placeholder:"姓名"},model:{value:e.params.name,callback:function(t){e.$set(e.params,"name",t)},expression:"params.name"}}),a("el-divider",{attrs:{direction:"vertical"}}),a("el-input",{staticClass:"w-200",attrs:{clearable:"",size:"small",placeholder:"职位"},model:{value:e.params.title,callback:function(t){e.$set(e.params,"title",t)},expression:"params.title"}}),a("el-divider",{attrs:{direction:"vertical"}}),a("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-refresh-left",loading:e.loading},on:{click:e.handleReset}},[e._v("重置")])],1)}),[],!1,C,null,null,null);function C(e){for(let t in x)this[t]=x[t]}var S=function(){return z.exports}();const w={setup:(e,t)=>{const{handleUpdateBefore:a}=v.serviceRegister(),{params:n,faceGroups:l,files:s,state:r,total:i,faceLoading:o,records:c,visible:d,setVisible:u,stateTotal:p,defaultActive:g,currentPerson:f,handleSelectPerson:m,handleRemove:y,handleChange:b,handleHttpRequest:_,handleDelete:x,handleChangeSize:z,handleChangePage:C,handleChangeStateSize:S,handleChangeStatePage:w,handleCreateFace:R,handleRemoveFace:k}=h.serviceDiscovery();return{handleUpdateBefore:a,params:n,faceGroups:l,files:s,state:r,total:i,faceLoading:o,records:c,visible:d,setVisible:u,stateTotal:p,defaultActive:g,currentPerson:f,handleSelectPerson:m,handleRemove:y,handleChange:b,handleHttpRequest:_,handleDelete:x,handleChangeSize:z,handleChangePage:C,handleChangeStateSize:S,handleChangeStatePage:w,handleCreateFace:R,handleRemoveFace:k}}};w.components=Object.assign({RecordsToolbar:S,Instance:b},w.components);const R={};var k=d(w,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("RecordsToolbar"),a("el-divider"),a("el-row",{staticClass:"person"},[a("el-col",{attrs:{span:4}},[a("div",{on:{click:function(t){return e.handleSelectPerson(e.defaultActive)}}},[a("el-card",{class:e.currentPerson===e.defaultActive?"person-active":null,staticStyle:{cursor:"pointer"},attrs:{shadow:"hover","body-style":{padding:"8px",textAlign:"center"}}},[a("span",[e._v("所有人")])])],1),e._l(e.records,(function(t){return a("div",{key:t.id,on:{click:function(a){e.handleSelectPerson(String(t.id))}}},[a("el-card",{class:e.currentPerson===String(t.id)?"person-active":null,staticStyle:{cursor:"pointer","margin-top":"16px"},attrs:{shadow:"hover","body-style":{padding:"8px",textAlign:"center"}},scopedSlots:e._u([{key:"header",fn:function(){return[a("span",[e._v(e._s(t.id))]),a("el-divider",{attrs:{direction:"vertical"}}),a("span",[e._v(e._s(t.name))]),a("el-divider",{attrs:{direction:"vertical"}}),a("span",[e._v(e._s(t.title))])]},proxy:!0}],null,!0)},[a("el-button-group",[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(a){e.handleCreateFace(String(t.id))}}},[e._v("添加")]),a("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-edit"},on:{click:function(a){return e.handleUpdateBefore(t)}}},[e._v("编辑")]),a("el-button",{attrs:{size:"small",type:"danger",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.id)}}},[e._v("删除")])],1)],1)],1)}))],2),a("el-col",{attrs:{span:19,offset:1}},[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.faceLoading,expression:"faceLoading"}],attrs:{shadow:"never","body-style":{padding:"16px"}}},[e.faceGroups.length?a("div",e._l(e.faceGroups,(function(t,n){return a("el-row",{key:n,style:{marginTop:n?"16px":0},attrs:{gutter:16,justify:t.length<8?"start":" space-between"}},e._l(t,(function(t){return a("el-col",{key:t.image,attrs:{span:3}},[a("el-card",{attrs:{shadow:"hover","body-style":{padding:0}}},[a("el-image",{staticStyle:{width:"100%"},attrs:{src:t.image,"preview-src-list":[t.image]}}),a("div",{staticStyle:{padding:"8px","text-align":"center"}},[a("div",[a("span",[e._v(e._s(t.id))]),e.currentPerson===e.defaultActive&&t.person?[a("el-divider",{attrs:{direction:"vertical"}}),a("span",[e._v(e._s(t.person.name))])]:e._e()],2),a("el-button",{staticStyle:{width:"100%","margin-top":"8px"},attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(a){return e.handleRemoveFace(t.id)}}},[a("span",[e._v("删除")])])],1)],1)],1)})),1)})),1):a("el-empty",{attrs:{description:"未发现照片记录"}})],1)],1)],1),a("el-divider"),a("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-tag",{staticStyle:{"margin-right":"16px"},attrs:{size:"small",effect:"dark"}},[e._v("人员分页")]),a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",total:e.total,"page-size":e.params.size,"page-sizes":[10,30,50,100],"current-page":e.params.page},on:{"size-change":e.handleChangeSize,"current-change":e.handleChangePage}})],1),a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-tag",{staticStyle:{"margin-right":"16px"},attrs:{size:"small",effect:"dark"}},[e._v("人脸分页")]),a("el-pagination",{staticClass:"text-align-right",attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",total:e.stateTotal,"page-size":e.state.size,"page-sizes":[10,30,50,100,150,200],"current-page":e.state.page},on:{"size-change":e.handleChangeStateSize,"current-change":e.handleChangeStatePage}})],1)],1),a("Instance"),a("el-dialog",{attrs:{width:"25%",title:"添加人脸照片",visible:e.visible},on:{"update:visible":function(t){e.visible=t}},scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{attrs:{size:"small",icon:"el-icon-close"},on:{click:function(t){return e.setVisible(!1)}}},[e._v("取消")]),a("el-button",{attrs:{size:"small",icon:"el-icon-upload2",type:"success",disabled:!e.files.length},on:{click:e.handleHttpRequest}},[e._v("上传")])]},proxy:!0}])},[a("el-upload",{staticStyle:{"text-align":"center"},attrs:{drag:"",action:"",multiple:"","with-credentials":"",accept:".jpg,.jpeg,.png","on-remove":e.handleRemove,"on-change":e.handleChange,"file-list":e.files,"auto-upload":!1}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击上传")])])]),e._v(" "+e._s(e.files)+" ")],1)],1)}),[],!1,T,null,null,null);function T(e){for(let t in R)this[t]=R[t]}var P=function(){return k.exports}();const B={setup:(e,t)=>(h.serviceRegister(),{})};B.components=Object.assign({Records:P},B.components);const q={};var $=d(B,(function(){var e=this.$createElement;return(this._self._c||e)("Records")}),[],!1,E,null,null,null);function E(e){for(let t in q)this[t]=q[t]}var F=function(){return $.exports}();export{F as default};
