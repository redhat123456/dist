import{r as e,d as t,e as n,w as r,c as i}from"./vendor.b8049c8b.js";import{a as o}from"./useRequestor.ce90c02e.js";import{c as a,u as s}from"./useComposables.07b7fc4f.js";import{u as l,a as c,b as u,f as h,r as f,c as v,d as p,I as d}from"./Apis.c306c359.js";import{n as y}from"./index.a21b1831.js";function m(t){const n=e(t);return[n,e=>n.value=e,e=>n.value[e],(e,t)=>n.value[e]=t]}var g,b;function w(e){return new Promise(((t,n)=>{const r=new Blob([e]),i=new FileReader;i.readAsDataURL(r),i.onload=e=>{var n;return t(null==(n=e.target)?void 0:n.result)},i.onerror=e=>n(e)}))}(b=g||(g={})).INFER="infer",b.CAMERA="Camera",b.REPORT="report";const x=a((function(){const[r,i]=s(!1),a=e(g.CAMERA),[d,y]=s(""),[b,x]=s(""),[k,O,S,C]=m({}),[P,A,D]=m({}),[F,j,,I]=m({}),[R,T]=s([]),[E,M]=s([]),_=t((()=>Boolean(R.value.length))),L=t((()=>Boolean(E.value.length))),B=t((()=>({infer:F.value,reports:E.value,channels:R.value}))),z=async()=>{try{const{data:e}=await h(),{infer:t,reports:n,channels:r}=e;j(t),M(n),T(r)}catch(e){o("error","获取配置失败~")}},W=async()=>{try{const{status_code:e,status_info:t}=await f();o(e,t)}catch(e){o("error",JSON.stringify(e))}finally{Q()}},U=new Map,[G,N]=s([]),V=t((()=>Boolean(G.value.length))),K=async()=>{try{const{data:e}=await v(),t=null!=e?e:[];N(t),t.forEach((e=>U.set(e.name,e)))}catch(e){o("error","获取平台列表失败~")}},$=new Map,[Y,X]=s([]),q=t((()=>Boolean(Y.value.length))),H=async()=>{try{const{data:e}=await p(),t=null!=e?e:[];X(t),t.forEach((e=>$.set(e.name,e.display)))}catch(e){o("error","获取功能组件列表失败~")}},[Z,J]=s(!1);async function Q(){try{J(!0),await Promise.all([z(),H(),K()])}catch(e){o("error","配置初始化失败！")}finally{setTimeout((()=>J(!1)),1e3)}}const[ee,te]=s(Symbol()),[ne,re]=s(null),[ie,oe]=s(""),[ae,se]=s(null);return Q(),{config:B,jsonVisible:r,setJsonVisible:i,loading:Z,request:Q,currentActiveConfig:a,handleUpdate:async()=>{try{const{status_code:e,status_info:t}=await l(B.value);o(e,t)}catch(e){o("error",JSON.stringify(e))}finally{Q()}},handleResetBefore:()=>{n.exports.MessageBox.confirm("该操作会重置所有数据为初始状态，请慎重！","警告",{type:"error",cancelButtonText:"取消",confirmButtonText:"确定"}).then(W).catch((()=>{}))},infer:F,setInferValue:I,cameras:R,hasCamera:_,currentActiveCamera:d,setCurrentActiveCamera:y,currentActiveCameraEntity:k,setCurrentActiveCameraEntity:O,getCurrentActiveCameraEntityValue:S,setCurrentActiveCameraEntityValue:C,fnOptions:Y,hasFnOption:q,getFnDisplayName:e=>{var t;return null!=(t=$.get(e))?t:e},currentActiveCameraFn:b,setCurrentActiveCameraFn:x,currentActiveCameraFnEntity:P,setCurrentActiveCameraFnEntity:A,reports:E,hasReport:L,reportOptions:G,hasReportOption:V,getReportOption:e=>{var t;return null!=(t=U.get(e))?t:{}},notify:ee,dispatch:te,cameraImage:ne,setCameraImage:re,cameraFnImage:ae,setCameraFnImage:se,requestCameraImage:async()=>{const[e,t]=[S("name"),S("url")];try{J(!0),o("success","正在加载摄像头预览图片......");const e=await w(t),[,n]=e.split(",");oe(n);const r=await c(n),i=await w(r);re(i),te(Symbol())}catch(n){o("error",`加载失败，请核对摄像头 [${e}] 的推流地址或稍后重试 ~`),re(null)}finally{J(!1)}},requestCameraFnImage:async()=>{var e;const[t,n,r=[]]=[ie.value,D("name"),null==(e=D("parameters"))?void 0:e.points];if(!Boolean(r.length))return se(null);try{J(!0),o("success","正在加载功能组件预览图片......");const e=await u(t,r),n=await w(e);se(n)}catch(i){o("error",`功能组件 [${n}] 的多边形预览图片加载失败，请拾取坐标或稍后重试 ~`),se(null)}finally{J(!1)}}}}));const k={};k.setup=(e,t)=>{const{infer:n,handleInferGpuInput:r}=function(){const{infer:e,setInferValue:t}=x.serviceDiscovery(),n=/^[0-9]*$/;return{infer:e,handleInferGpuInput:e=>{n.test(String(e))&&t("gpu",e)}}}();return{infer:n,handleInferGpuInput:r}};const O={};var S=y(k,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{staticStyle:{width:"30%"},attrs:{shadow:"never"}},[n("el-form",{attrs:{"label-position":"top"}},[n("el-form-item",{attrs:{label:"显卡编号"}},[n("el-input",{attrs:{value:e.infer.gpu},on:{input:e.handleInferGpuInput}})],1),n("el-form-item",{attrs:{label:"置信度阀值"}},[n("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.infer.conf,callback:function(t){e.$set(e.infer,"conf",t)},expression:"infer.conf"}})],1),n("el-form-item",{attrs:{label:"交并比阀值"}},[n("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.infer.iou,callback:function(t){e.$set(e.infer,"iou",t)},expression:"infer.iou"}})],1)],1)],1)}),[],!1,C,null,null,null);function C(e){for(let t in O)this[t]=O[t]}var P=function(){return S.exports}();function A(){const{reports:e,reportOptions:t}=x.serviceDiscovery(),[i,a]=s(!1),[l,c]=s({}),[u,h]=s("");r(t,(e=>{if(!Boolean(e.length))return;const[t]=e;c(t),h(t.name)}));const f=t=>e.value.findIndex((e=>e.name===t));return{visible:i,setVisible:a,selectReport:l,selectReportName:u,handleCreateReport:()=>{const{name:t,parameters:n}=l.value;if(~f(t))return o("error","该平台已添加配置过啦 ~");const r={};var i;n.forEach((e=>r[e.name]=e.default)),i={name:t,parameters:r},e.value.push(i)},handleRemoveReportBefore:t=>{n.exports.MessageBox.confirm("确定要删除吗？","提示",{type:"info",cancelButtonText:"取消",confirmButtonText:"确定"}).then((()=>(t=>e.value.splice(f(t),1))(t))).catch((()=>{}))}}}const D={setup:(e,t)=>{const{visible:n,setVisible:r,selectReport:i,selectReportName:o,handleCreateReport:a,handleRemoveReportBefore:s}=A(),{reports:l,hasReport:c,reportOptions:u,hasReportOption:h,getReportOption:f}=x.serviceDiscovery();return{visible:n,setVisible:r,selectReport:i,selectReportName:o,handleCreateReport:a,handleRemoveReportBefore:s,reports:l,hasReport:c,reportOptions:u,hasReportOption:h,getReportOption:f}}};const F={};var j=y(D,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-divider",[n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.setVisible(!0)}}},[e._v("添加平台")])],1),e.hasReport?e._l(e.reports,(function(t,r){return n("el-row",{key:t.name},[n("el-card",{attrs:{shadow:"hover"}},[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("el-alert",{attrs:{type:"success",title:t.name+" - "+e.getReportOption(t.name).display,closable:!1,description:e.getReportOption(t.name).description}}),n("el-button",{staticStyle:{"margin-left":"16px"},attrs:{size:"small",type:"danger",icon:"el-icon-delete"},on:{click:function(n){return e.handleRemoveReportBefore(t.name)}}},[n("span",[e._v("删除")])])],1),n("el-input",{staticStyle:{"margin-top":"16px"},model:{value:t.parameters.base_url,callback:function(n){e.$set(t.parameters,"base_url",n)},expression:"report.parameters.base_url"}})],1),r!==e.reports.length-1?n("el-divider"):e._e()],1)})):n("el-empty",{attrs:{description:"暂未配置云端平台，请点击上方按钮进行添加"}}),n("el-drawer",{attrs:{size:"50%","show-close":!1,visible:e.visible},on:{"update:visible":function(t){e.visible=t}},scopedSlots:e._u([{key:"title",fn:function(){return[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[n("i",{staticClass:"m-r-8 el-icon-view"}),n("span",[e._v("云端平台列表及介绍")])]),n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreateReport}},[e._v("确定添加")])],1)]},proxy:!0}])},[e.hasReportOption?[n("el-tabs",{model:{value:e.selectReportName,callback:function(t){e.selectReportName=t},expression:"selectReportName"}},e._l(e.reportOptions,(function(t){return n("el-tab-pane",{key:t.name,attrs:{name:t.name,label:t.display}},[n("el-alert",{attrs:{type:"warning",title:e.selectReport.name,description:e.selectReport.description,closable:!1}}),e._l(e.selectReport.parameters,(function(t){return n("el-row",{key:t.name},[n("el-divider",[e._v(e._s(t.display))]),n("el-alert",{attrs:{type:"info",closable:!1,description:t.description},scopedSlots:e._u([{key:"title",fn:function(){return[n("el-tooltip",{attrs:{content:"字段",placement:"top"}},[n("el-tag",{staticStyle:{"margin-right":"16px"},attrs:{size:"small",effect:"dark",type:"success"}},[e._v(e._s(t.name))])],1),n("el-tooltip",{attrs:{content:"类型",placement:"top"}},[n("el-tag",{staticStyle:{"margin-right":"16px"},attrs:{size:"small",effect:"dark",type:"warning"}},[e._v(e._s(t.type))])],1),n("el-tooltip",{attrs:{content:"默认值",placement:"top"}},[n("el-tag",{attrs:{size:"small",effect:"dark"}},[e._v(e._s(t.default))])],1)]},proxy:!0}],null,!0)})],1)}))],2)})),1)]:n("el-empty",{attrs:{description:"暂无云端平台配置数据，请先在服务端添加配置"}})],2)],2)}),[],!1,I,null,null,null);function I(e){for(let t in F)this[t]=F[t]}var R=function(){return j.exports}();const T=a((function(){const{cameras:e,currentActiveCamera:i,setCameraImage:o,setCurrentActiveCamera:a,setCurrentActiveCameraEntity:l,setCurrentActiveCameraEntityValue:c,setCurrentActiveCameraFnEntity:u,requestCameraImage:h}=x.serviceDiscovery(),f={searchCamera:t=>e.value.find((e=>e.name===t)),removeCamera:t=>e.value.splice(f.searchCameraPosition(t),1),createCamera:t=>e.value.push(t),searchCameraPosition:t=>e.value.findIndex((e=>e.name===t))},[v,p]=s("INIT");r(e,(e=>{if(Boolean(e.length))switch(v.value){case"INIT":const t=e[0];a(t.name);break;case"CREATE":const n=e[e.length-1];a(n.name)}}),{deep:!0});const[d,y]=s([]),m=t((()=>Boolean(d.value.length)));r(i,(e=>{u({});const t=f.searchCamera(e);if(t)switch(y(t.functions),l(t),v.value){case"INIT":case"TOGGLE":h();break;case"CREATE":p("TOGGLE"),o(null);break;case"REMOVE":p("TOGGLE"),h()}}));const g=new RegExp("[`~!@#$^&*()=|·{}':;'\",\\[\\].<>/?~！@#￥+《》%……&*（）—|{}【】‘；：”“'。\\\\，、？]");return{cameraFns:d,hasCameraFn:m,handleCreateCamera:()=>{p("CREATE"),n.exports.MessageBox.prompt("请填写摄像头名称","提示",{cancelButtonText:"取消",inputPlaceholder:"请填写摄像头名称，不能包含特殊字符",confirmButtonText:"确定",inputValidator:e=>e&&Boolean(e.length)?g.test(e)||e.includes(" ")?"摄像头名称不能包含特殊字符":!f.searchCamera(e)||"该摄像头已经存在":"请输入摄像头名称"}).then((e=>{const t=e.value;f.createCamera({name:t,url:"",functions:[]})})).catch((()=>{}))},handleRemoveCamera:t=>{p("REMOVE"),i.value===t&&e.value.forEach(((n,r)=>{if(n.name===t){const t=e.value[r+1]||e.value[r-1];t&&a(t.name)}})),f.removeCamera(t)},handleCameraUrlInput:e=>{p("INPUT"),c("url",e)},handleTabBeforeLeave:()=>("CREATE"!==v.value&&p("TOGGLE"),!0)}}));var E={exports:{}},M=E.exports=function(){function e(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,i)}function t(t){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=t.apply(n,r);function s(t){e(a,i,o,s,l,"next",t)}function l(t){e(a,i,o,s,l,"throw",t)}s(void 0)}))}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:{},l={exports:{}};!function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(R){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof y?t:y,o=Object.create(i.prototype),a=new F(r||[]);return o._invoke=C(e,n,a),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(R){return{type:"throw",arg:R}}}e.wrap=c;var h="suspendedStart",f="suspendedYield",v="executing",p="completed",d={};function y(){}function m(){}function g(){}var b={};l(b,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(j([])));x&&x!==n&&r.call(x,o)&&(b=x);var k=g.prototype=y.prototype=Object.create(b);function O(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(i,o,a,s){var l=u(e[i],e,o);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}var i;function o(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}this._invoke=o}function C(e,t,n){var r=h;return function(i,o){if(r===v)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=P(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=v;var l=u(e,t,n);if("normal"===l.type){if(r=n.done?p:f,l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=p,n.method="throw",n.arg=l.arg)}}}function P(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method))return d;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=u(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,d;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,d):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,d)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function F(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function j(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:I}}function I(){return{value:t,done:!0}}return m.prototype=g,l(k,"constructor",g),l(g,"constructor",m),m.displayName=l(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,s,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},O(S.prototype),l(S.prototype,a,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new S(c(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},O(k),l(k,s,"Generator"),l(k,o,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=j,F.prototype={constructor:F,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;D(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),d}},e}(e.exports);try{regeneratorRuntime=t}catch(n){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(l);var c,u=l.exports,h={exports:{}},f="object"==typeof Reflect?Reflect:null,v=f&&"function"==typeof f.apply?f.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};function p(e){console&&console.warn}c=f&&"function"==typeof f.ownKeys?f.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var d=Number.isNaN||function(e){return e!=e};function y(){y.init.call(this)}h.exports=y,h.exports.once=D,y.EventEmitter=y,y.prototype._events=void 0,y.prototype._eventsCount=0,y.prototype._maxListeners=void 0;var m=10;function g(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function b(e){return void 0===e._maxListeners?y.defaultMaxListeners:e._maxListeners}function w(e,t,n,r){var i,o,a;if(g(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=b(e))>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,p(s)}return e}function x(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function k(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=x.bind(r);return i.listener=n,r.wrapFn=i,i}function O(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?A(i):C(i,i.length)}function S(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function C(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function P(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function A(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function D(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}j(e,t,o,{once:!0}),"error"!==t&&F(e,i,{once:!0})}))}function F(e,t,n){"function"==typeof e.on&&j(e,"error",t,n)}function j(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(y,"defaultMaxListeners",{enumerable:!0,get:function(){return m},set:function(e){if("number"!=typeof e||e<0||d(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");m=e}}),y.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},y.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||d(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},y.prototype.getMaxListeners=function(){return b(this)},y.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var s=i[e];if(void 0===s)return!1;if("function"==typeof s)v(s,this,t);else{var l=s.length,c=C(s,l);for(n=0;n<l;++n)v(c[n],this,t)}return!0},y.prototype.addListener=function(e,t){return w(this,e,t,!1)},y.prototype.on=y.prototype.addListener,y.prototype.prependListener=function(e,t){return w(this,e,t,!0)},y.prototype.once=function(e,t){return g(t),this.on(e,k(this,e,t)),this},y.prototype.prependOnceListener=function(e,t){return g(t),this.prependListener(e,k(this,e,t)),this},y.prototype.removeListener=function(e,t){var n,r,i,o,a;if(g(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():P(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},y.prototype.off=y.prototype.removeListener,y.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},y.prototype.listeners=function(e){return O(this,e,!0)},y.prototype.rawListeners=function(e){return O(this,e,!1)},y.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):S.call(e,t)},y.prototype.listenerCount=S,y.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]};var I=h.exports,R="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;
/*!
     * hotkeys-js v3.8.7
     * A simple micro-library for defining and dispatching keyboard shortcuts. It has no dependencies.
     * 
     * Copyright (c) 2021 kenny wong <wowohoo@qq.com>
     * http://jaywcjlove.github.io/hotkeys
     * 
     * Licensed under the MIT license.
     */function T(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on".concat(t),(function(){n(window.event)}))}function E(e,t){for(var n=t.slice(0,t.length-1),r=0;r<n.length;r++)n[r]=e[n[r].toLowerCase()];return n}function M(e){"string"!=typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function _(e,t){for(var n=e.length>=t.length?e:t,r=e.length>=t.length?t:e,i=!0,o=0;o<n.length;o++)-1===r.indexOf(n[o])&&(i=!1);return i}for(var L={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":R?173:189,"=":R?61:187,";":R?59:186,"'":222,"[":219,"]":221,"\\":220},B={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},z={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},W={16:!1,18:!1,17:!1,91:!1},U={},G=1;G<20;G++)L["f".concat(G)]=111+G;var N=[],V="all",K=[],$=function(e){return L[e.toLowerCase()]||B[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function Y(e){V=e||"all"}function X(){return V||"all"}function q(){return N.slice(0)}function H(e){var t=e.target||e.srcElement,n=t.tagName,r=!0;return!t.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||t.readOnly)||(r=!1),r}function Z(e){return"string"==typeof e&&(e=$(e)),-1!==N.indexOf(e)}function J(e,t){var n,r;for(var i in e||(e=X()),U)if(Object.prototype.hasOwnProperty.call(U,i))for(n=U[i],r=0;r<n.length;)n[r].scope===e?n.splice(r,1):r++;X()===e&&Y(t||"all")}function Q(e){var t=e.keyCode||e.which||e.charCode,n=N.indexOf(t);if(n>=0&&N.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&N.splice(0,N.length),93!==t&&224!==t||(t=91),t in W)for(var r in W[t]=!1,B)B[r]===t&&(oe[r]=!1)}function ee(e){if(e){if(Array.isArray(e))e.forEach((function(e){e.key&&te(e)}));else if("object"==typeof e)e.key&&te(e);else if("string"==typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n[0],o=n[1];"function"==typeof i&&(o=i,i=""),te({key:e,scope:i,method:o,splitKey:"+"})}}else Object.keys(U).forEach((function(e){return delete U[e]}))}var te=function(e){var t=e.key,n=e.scope,r=e.method,i=e.splitKey,o=void 0===i?"+":i;M(t).forEach((function(e){var t=e.split(o),i=t.length,a=t[i-1],s="*"===a?"*":$(a);if(U[s]){n||(n=X());var l=i>1?E(B,t):[];U[s]=U[s].map((function(e){return r&&e.method!==r||e.scope!==n||!_(e.mods,l)?e:{}}))}}))};function ne(e,t,n){var r;if(t.scope===n||"all"===t.scope){for(var i in r=t.mods.length>0,W)Object.prototype.hasOwnProperty.call(W,i)&&(!W[i]&&t.mods.indexOf(+i)>-1||W[i]&&-1===t.mods.indexOf(+i))&&(r=!1);(0!==t.mods.length||W[16]||W[18]||W[17]||W[91])&&!r&&"*"!==t.shortcut||!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function re(e){var t=U["*"],n=e.keyCode||e.which||e.charCode;if(oe.filter.call(this,e)){if(93!==n&&224!==n||(n=91),-1===N.indexOf(n)&&229!==n&&N.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach((function(t){var n=z[t];e[t]&&-1===N.indexOf(n)?N.push(n):!e[t]&&N.indexOf(n)>-1?N.splice(N.indexOf(n),1):"metaKey"===t&&e[t]&&3===N.length&&(e.ctrlKey||e.shiftKey||e.altKey||(N=N.slice(N.indexOf(n))))})),n in W){for(var r in W[n]=!0,B)B[r]===n&&(oe[r]=!0);if(!t)return}for(var i in W)Object.prototype.hasOwnProperty.call(W,i)&&(W[i]=e[z[i]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===N.indexOf(17)&&N.push(17),-1===N.indexOf(18)&&N.push(18),W[17]=!0,W[18]=!0);var o=X();if(t)for(var a=0;a<t.length;a++)t[a].scope===o&&("keydown"===e.type&&t[a].keydown||"keyup"===e.type&&t[a].keyup)&&ne(e,t[a],o);if(n in U)for(var s=0;s<U[n].length;s++)if(("keydown"===e.type&&U[n][s].keydown||"keyup"===e.type&&U[n][s].keyup)&&U[n][s].key){for(var l=U[n][s],c=l.splitKey,u=l.key.split(c),h=[],f=0;f<u.length;f++)h.push($(u[f]));h.sort().join("")===N.sort().join("")&&ne(e,l,o)}}}function ie(e){return K.indexOf(e)>-1}function oe(e,t,n){N=[];var r=M(e),i=[],o="all",a=document,s=0,l=!1,c=!0,u="+";for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(o=t.scope),t.element&&(a=t.element),t.keyup&&(l=t.keyup),void 0!==t.keydown&&(c=t.keydown),"string"==typeof t.splitKey&&(u=t.splitKey)),"string"==typeof t&&(o=t);s<r.length;s++)i=[],(e=r[s].split(u)).length>1&&(i=E(B,e)),(e="*"===(e=e[e.length-1])?"*":$(e))in U||(U[e]=[]),U[e].push({keyup:l,keydown:c,scope:o,mods:i,shortcut:r[s],method:n,key:r[s],splitKey:u});void 0!==a&&!ie(a)&&window&&(K.push(a),T(a,"keydown",(function(e){re(e)})),T(window,"focus",(function(){N=[]})),T(a,"keyup",(function(e){re(e),Q(e)})))}var ae={setScope:Y,getScope:X,deleteScope:J,getPressedKeyCodes:q,isPressed:Z,filter:H,unbind:ee};for(var se in ae)Object.prototype.hasOwnProperty.call(ae,se)&&(oe[se]=ae[se]);if("undefined"!=typeof window){var le=window.hotkeys;oe.noConflict=function(e){return e&&window.hotkeys===oe&&(window.hotkeys=le),oe},window.hotkeys=oe}var ce="object"==typeof s&&s&&s.Object===Object&&s,ue=ce,he="object"==typeof self&&self&&self.Object===Object&&self,fe=ue||he||Function("return this")(),ve=fe.Symbol,pe=ve,de=Object.prototype,ye=de.hasOwnProperty,me=de.toString,ge=pe?pe.toStringTag:void 0;function be(e){var t=ye.call(e,ge),n=e[ge];try{e[ge]=void 0;var r=!0}catch(o){}var i=me.call(e);return r&&(t?e[ge]=n:delete e[ge]),i}var we=be,xe=Object.prototype.toString;function ke(e){return xe.call(e)}var Oe=ve,Se=we,Ce=ke,Pe="[object Null]",Ae="[object Undefined]",De=Oe?Oe.toStringTag:void 0;function Fe(e){return null==e?void 0===e?Ae:Pe:De&&De in Object(e)?Se(e):Ce(e)}var je=Fe;function Ie(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var Re=Ie,Te=je,Ee=Re,Me="[object AsyncFunction]",_e="[object Function]",Le="[object GeneratorFunction]",Be="[object Proxy]";function ze(e){if(!Ee(e))return!1;var t=Te(e);return t==_e||t==Le||t==Me||t==Be}var We,Ue=ze,Ge=fe["__core-js_shared__"],Ne=(We=/[^.]+$/.exec(Ge&&Ge.keys&&Ge.keys.IE_PROTO||""))?"Symbol(src)_1."+We:"";function Ve(e){return!!Ne&&Ne in e}var Ke=Ve,$e=Function.prototype.toString;function Ye(e){if(null!=e){try{return $e.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var Xe=Ye,qe=Ue,He=Ke,Ze=Re,Je=Xe,Qe=/[\\^$.*+?()[\]{}|]/g,et=/^\[object .+?Constructor\]$/,tt=Function.prototype,nt=Object.prototype,rt=tt.toString,it=nt.hasOwnProperty,ot=RegExp("^"+rt.call(it).replace(Qe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function at(e){return!(!Ze(e)||He(e))&&(qe(e)?ot:et).test(Je(e))}function st(e,t){return null==e?void 0:e[t]}var lt=at,ct=st;function ut(e,t){var n=ct(e,t);return lt(n)?n:void 0}var ht=ut,ft=ht,vt=function(){try{var e=ft(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),pt=vt;function dt(e,t,n){"__proto__"==t&&pt?pt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var yt=dt;function mt(e,t){return e===t||e!=e&&t!=t}var gt=mt,bt=yt,wt=gt,xt=Object.prototype.hasOwnProperty;function kt(e,t,n){var r=e[t];xt.call(e,t)&&wt(r,n)&&(void 0!==n||t in e)||bt(e,t,n)}var Ot=kt,St=Ot,Ct=yt;function Pt(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],l=r?r(n[s],e[s],s,n,e):void 0;void 0===l&&(l=e[s]),i?Ct(n,s,l):St(n,s,l)}return n}var At=Pt;function Dt(e){return e}var Ft=Dt;function jt(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var It=jt,Rt=Math.max;function Tt(e,t,n){return t=Rt(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=Rt(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(a),It(e,this,s)}}var Et=Tt;function Mt(e){return function(){return e}}var _t=Mt,Lt=vt,Bt=Ft,zt=Lt?function(e,t){return Lt(e,"toString",{configurable:!0,enumerable:!1,value:_t(t),writable:!0})}:Bt,Wt=800,Ut=16,Gt=Date.now;function Nt(e){var t=0,n=0;return function(){var r=Gt(),i=Ut-(r-n);if(n=r,i>0){if(++t>=Wt)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var Vt=Nt(zt),Kt=Ft,$t=Et,Yt=Vt;function Xt(e,t){return Yt($t(e,t,Kt),e+"")}var qt=9007199254740991;function Ht(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=qt}var Zt=Ht,Jt=Ue,Qt=Zt;function en(e){return null!=e&&Qt(e.length)&&!Jt(e)}var tn=en,nn=9007199254740991,rn=/^(?:0|[1-9]\d*)$/;function on(e,t){var n=typeof e;return!!(t=null==t?nn:t)&&("number"==n||"symbol"!=n&&rn.test(e))&&e>-1&&e%1==0&&e<t}var an=on,sn=gt,ln=tn,cn=an,un=Re;function hn(e,t,n){if(!un(n))return!1;var r=typeof t;return!!("number"==r?ln(n)&&cn(t,n.length):"string"==r&&t in n)&&sn(n[t],e)}var fn=Xt,vn=hn;function pn(e){return fn((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&vn(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var s=n[r];s&&e(t,s,r,o)}return t}))}var dn=pn,yn=Object.prototype;function mn(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||yn)}var gn=mn;function bn(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var wn=bn;function xn(e){return null!=e&&"object"==typeof e}var kn=xn,On=je,Sn=kn,Cn="[object Arguments]";function Pn(e){return Sn(e)&&On(e)==Cn}var An=Pn,Dn=kn,Fn=Object.prototype,jn=Fn.hasOwnProperty,In=Fn.propertyIsEnumerable,Rn=An(function(){return arguments}())?An:function(e){return Dn(e)&&jn.call(e,"callee")&&!In.call(e,"callee")},Tn=Rn,En=Array.isArray,Mn={exports:{}};function _n(){return!1}var Ln,Bn,zn,Wn,Un,Gn,Nn,Vn,Kn=_n;Ln=Mn,Bn=Mn.exports,zn=fe,Wn=Kn,Un=Bn&&!Bn.nodeType&&Bn,Gn=Un&&Ln&&!Ln.nodeType&&Ln,Nn=Gn&&Gn.exports===Un?zn.Buffer:void 0,Vn=(Nn?Nn.isBuffer:void 0)||Wn,Ln.exports=Vn;var $n=je,Yn=Zt,Xn=kn,qn="[object Arguments]",Hn="[object Array]",Zn="[object Boolean]",Jn="[object Date]",Qn="[object Error]",er="[object Function]",tr="[object Map]",nr="[object Number]",rr="[object Object]",ir="[object RegExp]",or="[object Set]",ar="[object String]",sr="[object WeakMap]",lr="[object ArrayBuffer]",cr="[object DataView]",ur="[object Float64Array]",hr="[object Int8Array]",fr="[object Int16Array]",vr="[object Int32Array]",pr="[object Uint8Array]",dr="[object Uint8ClampedArray]",yr="[object Uint16Array]",mr="[object Uint32Array]",gr={};function br(e){return Xn(e)&&Yn(e.length)&&!!gr[$n(e)]}gr["[object Float32Array]"]=gr[ur]=gr[hr]=gr[fr]=gr[vr]=gr[pr]=gr[dr]=gr[yr]=gr[mr]=!0,gr[qn]=gr[Hn]=gr[lr]=gr[Zn]=gr[cr]=gr[Jn]=gr[Qn]=gr[er]=gr[tr]=gr[nr]=gr[rr]=gr[ir]=gr[or]=gr[ar]=gr[sr]=!1;var wr=br;function xr(e){return function(t){return e(t)}}var kr=xr,Or={exports:{}};!function(e,t){var n=ce,r=t&&!t.nodeType&&t,i=r&&e&&!e.nodeType&&e,o=i&&i.exports===r&&n.process,a=function(){try{var e=i&&i.require&&i.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(t){}}();e.exports=a}(Or,Or.exports);var Sr=wr,Cr=kr,Pr=Or.exports,Ar=Pr&&Pr.isTypedArray,Dr=Ar?Cr(Ar):Sr,Fr=wn,jr=Tn,Ir=En,Rr=Mn.exports,Tr=an,Er=Dr,Mr=Object.prototype.hasOwnProperty;function _r(e,t){var n=Ir(e),r=!n&&jr(e),i=!n&&!r&&Rr(e),o=!n&&!r&&!i&&Er(e),a=n||r||i||o,s=a?Fr(e.length,String):[],l=s.length;for(var c in e)!t&&!Mr.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Tr(c,l))||s.push(c);return s}var Lr=_r;function Br(e,t){return function(n){return e(t(n))}}var zr=Br,Wr=zr(Object.keys,Object),Ur=gn,Gr=Wr,Nr=Object.prototype.hasOwnProperty;function Vr(e){if(!Ur(e))return Gr(e);var t=[];for(var n in Object(e))Nr.call(e,n)&&"constructor"!=n&&t.push(n);return t}var Kr=Lr,$r=Vr,Yr=tn;function Xr(e){return Yr(e)?Kr(e):$r(e)}var qr=Xr,Hr=Ot,Zr=At,Jr=dn,Qr=tn,ei=gn,ti=qr,ni=Object.prototype.hasOwnProperty,ri=Jr((function(e,t){if(ei(t)||Qr(t))Zr(t,ti(t),e);else for(var n in t)ni.call(t,n)&&Hr(e,n,t[n])}));function ii(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var oi=ii,ai=je,si=kn,li="[object Symbol]";function ci(e){return"symbol"==typeof e||si(e)&&ai(e)==li}var ui=ci,hi=ve,fi=oi,vi=En,pi=ui,di=1/0,yi=hi?hi.prototype:void 0,mi=yi?yi.toString:void 0;function gi(e){if("string"==typeof e)return e;if(vi(e))return fi(e,gi)+"";if(pi(e))return mi?mi.call(e):"";var t=e+"";return"0"==t&&1/e==-di?"-0":t}var bi=gi;function wi(e){return null==e?"":bi(e)}var xi=wi,ki=xi,Oi=0;function Si(e){var t=++Oi;return ki(e)+t}var Ci=Si;function Pi(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}var Ai=Pi;function Di(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var l=a[e?s:++i];if(!1===n(o[l],l,o))break}return t}}var Fi=Di(),ji=qr;function Ii(e,t){return e&&Fi(e,t,ji)}var Ri=tn;function Ti(e,t){return function(n,r){if(null==n)return n;if(!Ri(n))return e(n,r);for(var i=n.length,o=t?i:-1,a=Object(n);(t?o--:++o<i)&&!1!==r(a[o],o,a););return n}}var Ei=Ti(Ii),Mi=Ft;function _i(e){return"function"==typeof e?e:Mi}var Li=Ai,Bi=Ei,zi=_i,Wi=En;function Ui(e,t){return(Wi(e)?Li:Bi)(e,zi(t))}var Gi=Ui,Ni=En,Vi=ui,Ki=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$i=/^\w*$/;function Yi(e,t){if(Ni(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Vi(e))||$i.test(e)||!Ki.test(e)||null!=t&&e in Object(t)}var Xi=Yi,qi=ht(Object,"create"),Hi=qi;function Zi(){this.__data__=Hi?Hi(null):{},this.size=0}var Ji=Zi;function Qi(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var eo=Qi,to=qi,no="__lodash_hash_undefined__",ro=Object.prototype.hasOwnProperty;function io(e){var t=this.__data__;if(to){var n=t[e];return n===no?void 0:n}return ro.call(t,e)?t[e]:void 0}var oo=io,ao=qi,so=Object.prototype.hasOwnProperty;function lo(e){var t=this.__data__;return ao?void 0!==t[e]:so.call(t,e)}var co=qi,uo="__lodash_hash_undefined__";function ho(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=co&&void 0===t?uo:t,this}var fo=Ji,vo=eo,po=oo,yo=lo,mo=ho;function go(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}go.prototype.clear=fo,go.prototype.delete=vo,go.prototype.get=po,go.prototype.has=yo,go.prototype.set=mo;var bo=go;function wo(){this.__data__=[],this.size=0}var xo=wo,ko=gt;function Oo(e,t){for(var n=e.length;n--;)if(ko(e[n][0],t))return n;return-1}var So=Oo,Co=So,Po=Array.prototype.splice;function Ao(e){var t=this.__data__,n=Co(t,e);return!(n<0||(n==t.length-1?t.pop():Po.call(t,n,1),--this.size,0))}var Do=So;function Fo(e){var t=this.__data__,n=Do(t,e);return n<0?void 0:t[n][1]}var jo=So;function Io(e){return jo(this.__data__,e)>-1}var Ro=So;function To(e,t){var n=this.__data__,r=Ro(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}var Eo=xo,Mo=Ao,_o=Fo,Lo=Io,Bo=To;function zo(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}zo.prototype.clear=Eo,zo.prototype.delete=Mo,zo.prototype.get=_o,zo.prototype.has=Lo,zo.prototype.set=Bo;var Wo=zo,Uo=ht(fe,"Map"),Go=bo,No=Wo,Vo=Uo;function Ko(){this.size=0,this.__data__={hash:new Go,map:new(Vo||No),string:new Go}}function $o(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}var Yo=$o;function Xo(e,t){var n=e.__data__;return Yo(t)?n["string"==typeof t?"string":"hash"]:n.map}var qo=Xo;function Ho(e){var t=qo(this,e).delete(e);return this.size-=t?1:0,t}var Zo=Xo;function Jo(e){return Zo(this,e).get(e)}var Qo=Xo;function ea(e){return Qo(this,e).has(e)}var ta=Xo;function na(e,t){var n=ta(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}var ra=Ko,ia=Ho,oa=Jo,aa=ea,sa=na;function la(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}la.prototype.clear=ra,la.prototype.delete=ia,la.prototype.get=oa,la.prototype.has=aa,la.prototype.set=sa;var ca=la,ua=ca,ha="Expected a function";function fa(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(ha);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(fa.Cache||ua),n}fa.Cache=ua;var va=fa,pa=500;function da(e){var t=va(e,(function(e){return n.size===pa&&n.clear(),e})),n=t.cache;return t}var ya=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ma=/\\(\\)?/g,ga=da((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ya,(function(e,n,r,i){t.push(r?i.replace(ma,"$1"):n||e)})),t})),ba=En,wa=Xi,xa=ga,ka=xi;function Oa(e,t){return ba(e)?e:wa(e,t)?[e]:xa(ka(e))}var Sa=Oa,Ca=ui,Pa=1/0;function Aa(e){if("string"==typeof e||Ca(e))return e;var t=e+"";return"0"==t&&1/e==-Pa?"-0":t}var Da=Aa,Fa=Sa,ja=Da;function Ia(e,t){for(var n=0,r=(t=Fa(t,e)).length;null!=e&&n<r;)e=e[ja(t[n++])];return n&&n==r?e:void 0}var Ra=Ia,Ta=Ra;function Ea(e,t,n){var r=null==e?void 0:Ta(e,t);return void 0===r?n:r}var Ma=Ea,_a=je,La=kn,Ba="[object Number]";function za(e){return"number"==typeof e||La(e)&&_a(e)==Ba}var Wa=za,Ua=Wo;function Ga(){this.__data__=new Ua,this.size=0}function Na(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Va(e){return this.__data__.get(e)}function Ka(e){return this.__data__.has(e)}var $a=Wo,Ya=Uo,Xa=ca,qa=200;function Ha(e,t){var n=this.__data__;if(n instanceof $a){var r=n.__data__;if(!Ya||r.length<qa-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Xa(r)}return n.set(e,t),this.size=n.size,this}var Za=Wo,Ja=Ga,Qa=Na,es=Va,ts=Ka,ns=Ha;function rs(e){var t=this.__data__=new Za(e);this.size=t.size}rs.prototype.clear=Ja,rs.prototype.delete=Qa,rs.prototype.get=es,rs.prototype.has=ts,rs.prototype.set=ns;var is=rs,os=At,as=qr;function ss(e,t){return e&&os(t,as(t),e)}var ls=ss;function cs(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}var us=Re,hs=gn,fs=cs,vs=Object.prototype.hasOwnProperty;function ps(e){if(!us(e))return fs(e);var t=hs(e),n=[];for(var r in e)("constructor"!=r||!t&&vs.call(e,r))&&n.push(r);return n}var ds=Lr,ys=ps,ms=tn;function gs(e){return ms(e)?ds(e,!0):ys(e)}var bs=gs,ws=At,xs=bs;function ks(e,t){return e&&ws(t,xs(t),e)}var Os=ks,Ss={exports:{}};function Cs(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}!function(e,t){var n=fe,r=t&&!t.nodeType&&t,i=r&&e&&!e.nodeType&&e,o=i&&i.exports===r?n.Buffer:void 0,a=o?o.allocUnsafe:void 0;function s(e,t){if(t)return e.slice();var n=e.length,r=a?a(n):new e.constructor(n);return e.copy(r),r}e.exports=s}(Ss,Ss.exports);var Ps=Cs;function As(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}var Ds=As;function Fs(){return[]}var js=Fs,Is=Ds,Rs=js,Ts=Object.prototype.propertyIsEnumerable,Es=Object.getOwnPropertySymbols,Ms=Es?function(e){return null==e?[]:(e=Object(e),Is(Es(e),(function(t){return Ts.call(e,t)})))}:Rs,_s=At,Ls=Ms;function Bs(e,t){return _s(e,Ls(e),t)}var zs=Bs;function Ws(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Us=Ws,Gs=zr(Object.getPrototypeOf,Object),Ns=Us,Vs=Gs,Ks=Ms,$s=js,Ys=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Ns(t,Ks(e)),e=Vs(e);return t}:$s,Xs=At,qs=Ys;function Hs(e,t){return Xs(e,qs(e),t)}var Zs=Hs,Js=Us,Qs=En;function el(e,t,n){var r=t(e);return Qs(e)?r:Js(r,n(e))}var tl=el,nl=Ms,rl=qr;function il(e){return tl(e,rl,nl)}var ol=il,al=el,sl=Ys,ll=bs;function cl(e){return al(e,ll,sl)}var ul=cl,hl=ht(fe,"DataView"),fl=ht(fe,"Promise"),vl=ht(fe,"Set"),pl=ht(fe,"WeakMap"),dl=hl,yl=Uo,ml=fl,gl=vl,bl=pl,wl=je,xl=Xe,kl="[object Map]",Ol="[object Object]",Sl="[object Promise]",Cl="[object Set]",Pl="[object WeakMap]",Al="[object DataView]",Dl=xl(dl),Fl=xl(yl),jl=xl(ml),Il=xl(gl),Rl=xl(bl),Tl=wl;(dl&&Tl(new dl(new ArrayBuffer(1)))!=Al||yl&&Tl(new yl)!=kl||ml&&Tl(ml.resolve())!=Sl||gl&&Tl(new gl)!=Cl||bl&&Tl(new bl)!=Pl)&&(Tl=function(e){var t=wl(e),n=t==Ol?e.constructor:void 0,r=n?xl(n):"";if(r)switch(r){case Dl:return Al;case Fl:return kl;case jl:return Sl;case Il:return Cl;case Rl:return Pl}return t});var El=Tl,Ml=Object.prototype.hasOwnProperty;function _l(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Ml.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Ll=_l,Bl=fe.Uint8Array,zl=Bl;function Wl(e){var t=new e.constructor(e.byteLength);return new zl(t).set(new zl(e)),t}var Ul=Wl,Gl=Ul;function Nl(e,t){var n=t?Gl(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var Vl=Nl,Kl=/\w*$/;function $l(e){var t=new e.constructor(e.source,Kl.exec(e));return t.lastIndex=e.lastIndex,t}var Yl=$l,Xl=ve,ql=Xl?Xl.prototype:void 0,Hl=ql?ql.valueOf:void 0;function Zl(e){return Hl?Object(Hl.call(e)):{}}var Jl=Ul;function Ql(e,t){var n=t?Jl(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var ec=Ul,tc=Vl,nc=Yl,rc=Zl,ic=Ql,oc="[object Boolean]",ac="[object Date]",sc="[object Map]",lc="[object Number]",cc="[object RegExp]",uc="[object Set]",hc="[object String]",fc="[object Symbol]",vc="[object ArrayBuffer]",pc="[object DataView]",dc="[object Float32Array]",yc="[object Float64Array]",mc="[object Int8Array]",gc="[object Int16Array]",bc="[object Int32Array]",wc="[object Uint8Array]",xc="[object Uint8ClampedArray]",kc="[object Uint16Array]",Oc="[object Uint32Array]";function Sc(e,t,n){var r=e.constructor;switch(t){case vc:return ec(e);case oc:case ac:return new r(+e);case pc:return tc(e,n);case dc:case yc:case mc:case gc:case bc:case wc:case xc:case kc:case Oc:return ic(e,n);case sc:return new r;case lc:case hc:return new r(e);case cc:return nc(e);case uc:return new r;case fc:return rc(e)}}var Cc=Sc,Pc=Re,Ac=Object.create,Dc=function(){function e(){}return function(t){if(!Pc(t))return{};if(Ac)return Ac(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}(),Fc=Gs,jc=gn;function Ic(e){return"function"!=typeof e.constructor||jc(e)?{}:Dc(Fc(e))}var Rc=Ic,Tc=El,Ec=kn,Mc="[object Map]";function _c(e){return Ec(e)&&Tc(e)==Mc}var Lc=_c,Bc=kr,zc=Or.exports,Wc=zc&&zc.isMap,Uc=Wc?Bc(Wc):Lc,Gc=El,Nc=kn,Vc="[object Set]";function Kc(e){return Nc(e)&&Gc(e)==Vc}var $c=Kc,Yc=kr,Xc=Or.exports,qc=Xc&&Xc.isSet,Hc=qc?Yc(qc):$c,Zc=is,Jc=Ai,Qc=Ot,eu=ls,tu=Os,nu=Ss.exports,ru=Ps,iu=zs,ou=Zs,au=ol,su=ul,lu=El,cu=Ll,uu=Cc,hu=Rc,fu=En,vu=Mn.exports,pu=Uc,du=Re,yu=Hc,mu=qr,gu=bs,bu=1,wu=2,xu=4,ku="[object Arguments]",Ou="[object Array]",Su="[object Boolean]",Cu="[object Date]",Pu="[object Error]",Au="[object Function]",Du="[object GeneratorFunction]",Fu="[object Map]",ju="[object Number]",Iu="[object Object]",Ru="[object RegExp]",Tu="[object Set]",Eu="[object String]",Mu="[object Symbol]",_u="[object WeakMap]",Lu="[object ArrayBuffer]",Bu="[object DataView]",zu="[object Float32Array]",Wu="[object Float64Array]",Uu="[object Int8Array]",Gu="[object Int16Array]",Nu="[object Int32Array]",Vu="[object Uint8Array]",Ku="[object Uint8ClampedArray]",$u="[object Uint16Array]",Yu="[object Uint32Array]",Xu={};function qu(e,t,n,r,i,o){var a,s=t&bu,l=t&wu,c=t&xu;if(n&&(a=i?n(e,r,i,o):n(e)),void 0!==a)return a;if(!du(e))return e;var u=fu(e);if(u){if(a=cu(e),!s)return ru(e,a)}else{var h=lu(e),f=h==Au||h==Du;if(vu(e))return nu(e,s);if(h==Iu||h==ku||f&&!i){if(a=l||f?{}:hu(e),!s)return l?ou(e,tu(a,e)):iu(e,eu(a,e))}else{if(!Xu[h])return i?e:{};a=uu(e,h,s)}}o||(o=new Zc);var v=o.get(e);if(v)return v;o.set(e,a),yu(e)?e.forEach((function(r){a.add(qu(r,t,n,r,e,o))})):pu(e)&&e.forEach((function(r,i){a.set(i,qu(r,t,n,i,e,o))}));var p=u?void 0:(c?l?su:au:l?gu:mu)(e);return Jc(p||e,(function(r,i){p&&(r=e[i=r]),Qc(a,i,qu(r,t,n,i,e,o))})),a}Xu[ku]=Xu[Ou]=Xu[Lu]=Xu[Bu]=Xu[Su]=Xu[Cu]=Xu[zu]=Xu[Wu]=Xu[Uu]=Xu[Gu]=Xu[Nu]=Xu[Fu]=Xu[ju]=Xu[Iu]=Xu[Ru]=Xu[Tu]=Xu[Eu]=Xu[Mu]=Xu[Vu]=Xu[Ku]=Xu[$u]=Xu[Yu]=!0,Xu[Pu]=Xu[Au]=Xu[_u]=!1;var Hu=qu,Zu=1,Ju=4;function Qu(e){return Hu(e,Zu|Ju)}var eh=Qu,th=Ei;function nh(e,t){var n=[];return th(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}var rh=nh,ih="__lodash_hash_undefined__";function oh(e){return this.__data__.set(e,ih),this}function ah(e){return this.__data__.has(e)}var sh=ca,lh=oh,ch=ah;function uh(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new sh;++t<n;)this.add(e[t])}uh.prototype.add=uh.prototype.push=lh,uh.prototype.has=ch;var hh=uh;function fh(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function vh(e,t){return e.has(t)}var ph=vh,dh=hh,yh=fh,mh=ph,gh=1,bh=2;function wh(e,t,n,r,i,o){var a=n&gh,s=e.length,l=t.length;if(s!=l&&!(a&&l>s))return!1;var c=o.get(e),u=o.get(t);if(c&&u)return c==t&&u==e;var h=-1,f=!0,v=n&bh?new dh:void 0;for(o.set(e,t),o.set(t,e);++h<s;){var p=e[h],d=t[h];if(r)var y=a?r(d,p,h,t,e,o):r(p,d,h,e,t,o);if(void 0!==y){if(y)continue;f=!1;break}if(v){if(!yh(t,(function(e,t){if(!mh(v,t)&&(p===e||i(p,e,n,r,o)))return v.push(t)}))){f=!1;break}}else if(p!==d&&!i(p,d,n,r,o)){f=!1;break}}return o.delete(e),o.delete(t),f}var xh=wh;function kh(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function Oh(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var Sh=Oh,Ch=ve,Ph=Bl,Ah=gt,Dh=xh,Fh=kh,jh=Sh,Ih=1,Rh=2,Th="[object Boolean]",Eh="[object Date]",Mh="[object Error]",_h="[object Map]",Lh="[object Number]",Bh="[object RegExp]",zh="[object Set]",Wh="[object String]",Uh="[object Symbol]",Gh="[object ArrayBuffer]",Nh="[object DataView]",Vh=Ch?Ch.prototype:void 0,Kh=Vh?Vh.valueOf:void 0;function $h(e,t,n,r,i,o,a){switch(n){case Nh:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Gh:return!(e.byteLength!=t.byteLength||!o(new Ph(e),new Ph(t)));case Th:case Eh:case Lh:return Ah(+e,+t);case Mh:return e.name==t.name&&e.message==t.message;case Bh:case Wh:return e==t+"";case _h:var s=Fh;case zh:var l=r&Ih;if(s||(s=jh),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;r|=Rh,a.set(e,t);var u=Dh(s(e),s(t),r,i,o,a);return a.delete(e),u;case Uh:if(Kh)return Kh.call(e)==Kh.call(t)}return!1}var Yh=$h,Xh=ol,qh=1,Hh=Object.prototype.hasOwnProperty;function Zh(e,t,n,r,i,o){var a=n&qh,s=Xh(e),l=s.length;if(l!=Xh(t).length&&!a)return!1;for(var c=l;c--;){var u=s[c];if(!(a?u in t:Hh.call(t,u)))return!1}var h=o.get(e),f=o.get(t);if(h&&f)return h==t&&f==e;var v=!0;o.set(e,t),o.set(t,e);for(var p=a;++c<l;){var d=e[u=s[c]],y=t[u];if(r)var m=a?r(y,d,u,t,e,o):r(d,y,u,e,t,o);if(!(void 0===m?d===y||i(d,y,n,r,o):m)){v=!1;break}p||(p="constructor"==u)}if(v&&!p){var g=e.constructor,b=t.constructor;g==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b||(v=!1)}return o.delete(e),o.delete(t),v}var Jh=is,Qh=xh,ef=Yh,tf=Zh,nf=El,rf=En,of=Mn.exports,af=Dr,sf=1,lf="[object Arguments]",cf="[object Array]",uf="[object Object]",hf=Object.prototype.hasOwnProperty;function ff(e,t,n,r,i,o){var a=rf(e),s=rf(t),l=a?cf:nf(e),c=s?cf:nf(t),u=(l=l==lf?uf:l)==uf,h=(c=c==lf?uf:c)==uf,f=l==c;if(f&&of(e)){if(!of(t))return!1;a=!0,u=!1}if(f&&!u)return o||(o=new Jh),a||af(e)?Qh(e,t,n,r,i,o):ef(e,t,l,n,r,i,o);if(!(n&sf)){var v=u&&hf.call(e,"__wrapped__"),p=h&&hf.call(t,"__wrapped__");if(v||p){var d=v?e.value():e,y=p?t.value():t;return o||(o=new Jh),i(d,y,n,r,o)}}return!!f&&(o||(o=new Jh),tf(e,t,n,r,i,o))}var vf=ff,pf=kn;function df(e,t,n,r,i){return e===t||(null==e||null==t||!pf(e)&&!pf(t)?e!=e&&t!=t:vf(e,t,n,r,df,i))}var yf=is,mf=df,gf=1,bf=2;function wf(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Object(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var l=(s=n[i])[0],c=e[l],u=s[1];if(a&&s[2]){if(void 0===c&&!(l in e))return!1}else{var h=new yf;if(r)var f=r(c,u,l,e,t,h);if(!(void 0===f?mf(u,c,gf|bf,r,h):f))return!1}}return!0}var xf=Re;function kf(e){return e==e&&!xf(e)}var Of=kf,Sf=qr;function Cf(e){for(var t=Sf(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Of(i)]}return t}function Pf(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}}var Af=wf,Df=Cf,Ff=Pf;function jf(e){var t=Df(e);return 1==t.length&&t[0][2]?Ff(t[0][0],t[0][1]):function(n){return n===e||Af(n,e,t)}}function If(e,t){return null!=e&&t in Object(e)}var Rf=Sa,Tf=Tn,Ef=En,Mf=an,_f=Zt,Lf=Da;function Bf(e,t,n){for(var r=-1,i=(t=Rf(t,e)).length,o=!1;++r<i;){var a=Lf(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&_f(i)&&Mf(a,i)&&(Ef(e)||Tf(e))}var zf=If,Wf=Bf;function Uf(e,t){return null!=e&&Wf(e,t,zf)}var Gf=df,Nf=Ma,Vf=Uf,Kf=Xi,$f=kf,Yf=Pf,Xf=Da,qf=1,Hf=2;function Zf(e,t){return Kf(e)&&$f(t)?Yf(Xf(e),t):function(n){var r=Nf(n,e);return void 0===r&&r===t?Vf(n,e):Gf(t,r,qf|Hf)}}function Jf(e){return function(t){return null==t?void 0:t[e]}}var Qf=Ra;function ev(e){return function(t){return Qf(t,e)}}var tv=Jf,nv=ev,rv=Xi,iv=Da;function ov(e){return rv(e)?tv(iv(e)):nv(e)}var av=jf,sv=Zf,lv=Ft,cv=En,uv=ov;function hv(e){return"function"==typeof e?e:null==e?lv:"object"==typeof e?cv(e)?sv(e[0],e[1]):av(e):uv(e)}var fv=hv,vv=Ds,pv=rh,dv=fv,yv=En;function mv(e,t){return(yv(e)?vv:pv)(e,dv(t))}var gv,bv,wv,xv,kv,Ov,Sv,Cv,Pv,Av,Dv,Fv,jv,Iv,Rv,Tv,Ev,Mv,_v=mv;function Lv(e){if(Array.isArray(e))return e}function Bv(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(l){s=!0,i=l}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}function zv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Wv(e,t){if(e){if("string"==typeof e)return zv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zv(e,t):void 0}}function Uv(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Gv(e,t){return Lv(e)||Bv(e,t)||Wv(e,t)||Uv()}function Nv(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Vv(e){return(Vv=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kv(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Vv(e)););return e}function $v(e,t,n){return($v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=Kv(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Yv(e,t){return(Yv=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xv(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Yv(e,t)}function qv(e){return(qv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hv(e,t){if(t&&("object"===qv(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Nv(e)}(Mv=gv||(gv={})).DOWN="down",Mv.UP="up",Mv.LEFT="left",Mv.RIGHT="right",(Ev=bv||(bv={})).Left="left",Ev.Right="right",(Tv=wv||(wv={})).Top="top",Tv.Bottom="bottom",(Rv=xv||(xv={})).Bottom="bottom",Rv.Top="top",Rv.Middle="middle",(Iv=kv||(kv={})).Pan="PAN",Iv.Ban="BAN",Iv.MARKER="MARKER",Iv.Point="POINT",Iv.Circle="CIRCLE",Iv.Line="LINE",Iv.Polyline="POLYLINE",Iv.Rect="RECT",Iv.Polygon="POLYGON",Iv.DrawMask="DRAWMASK",Iv.ClearMask="CLEARMASK",Iv.ImageMask="IMAGEMASK",(jv=Ov||(Ov={})).BoundsChanged="boundsChanged",jv.FeatureSelected="featureSelected",jv.FeatureUnselected="featureUnselected",jv.DrawDone="drawDone",jv.FeatureUpdated="featureUpdated",jv.FeatureDeleted="featureDeleted",jv.Click="click",jv.DblClick="dblClick",jv.MouseDown="mouseDown",jv.MouseMove="mouseMove",jv.MouseUp="mouseUp",jv.MouseOver="mouseOver",jv.MouseOut="mouseOut",(Fv=Sv||(Sv={})).DrawActivePoint="drawActivePoint",Fv.DrawActiveMiddlePoint="drawActiveMiddlePoint",(Dv=Cv||(Cv={})).Grab="-webkit-grab",Dv.Grabbing="-webkit-grabbing",Dv.Crosshair="crosshair",Dv.Pointer="pointer",Dv.Move="move",Dv.NESW_Resize="nesw-resize",Dv.NWSE_Resize="nwse-resize",(Av=Pv||(Pv={})).DrawMask="crosshair",Av.ClearMask="crosshair";var Zv=Ei,Jv=tn;function Qv(e,t){var n=-1,r=Jv(e)?Array(e.length):[];return Zv(e,(function(e,i,o){r[++n]=t(e,i,o)})),r}var ep=oi,tp=fv,np=Qv,rp=En;function ip(e,t){return(rp(e)?ep:np)(e,tp(t))}var op=ip;function ap(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var sp=ap;function lp(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}var cp=lp;function up(e){return e!=e}function hp(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}var fp=cp,vp=up,pp=hp;function dp(e,t,n){return t==t?pp(e,t,n):fp(e,vp,n)}var yp=dp,mp=je,gp=En,bp=kn,wp="[object String]";function xp(e){return"string"==typeof e||!gp(e)&&bp(e)&&mp(e)==wp}var kp=xp,Op=/\s/;function Sp(e){for(var t=e.length;t--&&Op.test(e.charAt(t)););return t}var Cp=Sp,Pp=/^\s+/;function Ap(e){return e?e.slice(0,Cp(e)+1).replace(Pp,""):e}var Dp=Ap,Fp=Re,jp=ui,Ip=NaN,Rp=/^[-+]0x[0-9a-f]+$/i,Tp=/^0b[01]+$/i,Ep=/^0o[0-7]+$/i,Mp=parseInt;function _p(e){if("number"==typeof e)return e;if(jp(e))return Ip;if(Fp(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Fp(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Dp(e);var n=Tp.test(e);return n||Ep.test(e)?Mp(e.slice(2),n?2:8):Rp.test(e)?Ip:+e}var Lp=_p,Bp=1/0,zp=17976931348623157e292;function Wp(e){return e?(e=Lp(e))===Bp||e===-Bp?(e<0?-1:1)*zp:e==e?e:0:0===e?e:0}var Up=Wp;function Gp(e){var t=Up(e),n=t%1;return t==t?n?t-n:t:0}var Np=Gp,Vp=oi;function Kp(e,t){return Vp(t,(function(t){return e[t]}))}var $p=Kp,Yp=qr;function Xp(e){return null==e?[]:$p(e,Yp(e))}var qp=yp,Hp=tn,Zp=kp,Jp=Np,Qp=Xp,ed=Math.max;function td(e,t,n,r){e=Hp(e)?e:Qp(e),n=n&&!r?Jp(n):0;var i=e.length;return n<0&&(n=ed(i+n,0)),Zp(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&qp(e,t,n)>-1}var nd,rd,id=td;(rd=nd||(nd={})).Draw="DRAW",rd.Clear="CLEAR",rd.Image="IMAGE";var od=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};n(this,e),this.id=t,this.type=r,this.props=i,this.style=ri({},e.defaultStyle,o)}return o(e,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){}},{key:"setStyle",value:function(e,t){var n,r=t.refresh,i=void 0===r||r;this.style=e,i&&(null===(n=this.layer)||void 0===n||n.refresh())}},{key:"refresh",value:function(){}},{key:"printInfo",value:function(){}}]),e}();a(od,"defaultStyle",{opacity:1,fillStyle:"rgba(255, 0, 0, 0)",lineWidth:1,strokeStyle:"#000"});var ad=je,sd=kn,ld="[object Boolean]";function cd(e){return!0===e||!1===e||sd(e)&&ad(e)==ld}var ud=cd,hd=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};n(this,e),this.id=t,this.type=r,this.props=i,this.style=ri({},e.defaultStyle,o),this.domId="layer-".concat(t,"-wrapper"),this.setDom()}return o(e,[{key:"setDom",value:function(){this.dom||(this.dom=document.createElement("div"),this.dom.setAttribute("id",this.domId),this.dom.style.position="absolute",this.dom.style.left="0",this.dom.style.top="0");var e=this.style,t=e.zIndex,n=e.opacity;this.dom.style.zIndex="".concat(t),this.dom.style.opacity="".concat(n)}},{key:"onAdd",value:function(e){this.map=e,this.resize()}},{key:"onRemove",value:function(){var e=document.getElementById(this.domId);e&&e.remove(),this.map=null}},{key:"resize",value:function(){var e=this.map.getSize(),t=e.width,n=e.height;this.dom.style.width="".concat(t,"px"),this.dom.style.height="".concat(n,"px")}},{key:"refresh",value:function(){}},{key:"resizeAndRefresh",value:function(){this.resize(),this.refresh()}},{key:"printInfo",value:function(){}}]),e}();function fd(e){var t=vd();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function vd(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(hd,"defaultStyle",{zIndex:1,opacity:1});var pd=function(e){Xv(r,e);var t=fd(r);function r(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n(this,r),(o=t.call(this,e,i,a,s)).createRenderCanvas(),o}return o(r,[{key:"onAdd",value:function(e){$v(Vv(r.prototype),"onAdd",this).call(this,e),this.resize()}},{key:"createRenderCanvas",value:function(){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.dom.appendChild(this.canvas),this.canvasContext=this.canvas.getContext("2d")}},{key:"resize",value:function(){$v(Vv(r.prototype),"resize",this).call(this);var e=this.map.getSize(),t=e.width,n=e.height;this.canvas.width=t*r.dpr,this.canvas.height=n*r.dpr,this.canvas.style.width=t+"px",this.canvas.style.height=n+"px"}},{key:"refresh",value:function(){this.clear(),$v(Vv(r.prototype),"refresh",this).call(this)}},{key:"clear",value:function(){var e;null===(e=this.canvasContext)||void 0===e||e.clearRect(0,0,this.canvas.width,this.canvas.height)}}]),r}(hd);function dd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dd(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}a(pd,"dpr",window.devicePixelRatio);var md=function(){function e(){n(this,e)}return o(e,null,[{key:"setStyle",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=ri({},e.defaultStyle,n);Gi(r,(function(n,r){if(Ue(e.formatStyle[r])){var i=e.formatStyle[r](n);!Ue(t[r])&&(t[r]=i)}else!Ue(t[r])&&(t[r]=n)}))}},{key:"drawPolyline",value:function(t,n,r,i){var o=i.format,a=i.limitCount,s=void 0===a?2:a,l=Ue(o)?o(n):n,c=l.points,u=l.width,h=c.length;if(!(h<s)){e.setStyle(t,r),Wa(u)&&(t.lineWidth=u),t.beginPath();var f=c[0],v=f.x,p=f.y;t.moveTo(v,p);for(var d=1;d<h;d++){var y=c[d],m=y.x,g=y.y;t.lineTo(m,g)}t.stroke()}}},{key:"drawLine",value:function(t,n,r,i){e.setStyle(t,r);var o=(i||{}).format,a=Ue(o)?o(n):n,s=a.start,l=a.end,c=a.width;Wa(c)&&(t.lineWidth=c),t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(l.x,l.y),t.stroke()}},{key:"drawRect",value:function(t,n,r,i){var o=(i||{}).format,a=!ud(r.stroke)||r.stroke,s=!!ud(r.fill)&&r.fill,l=Ue(o)?o(n):n,c=l.x,u=l.y,h=c+l.width,f=u+l.height,v=[{x:c,y:u},{x:h,y:u},{x:h,y:f},{x:c,y:f}];e.drawPolygon(t,v,r,{fill:s,stroke:a})}},{key:"drawPolygon",value:function(t,n,r,i){var o=i.format,a=i.limitCount,s=void 0===a?2:a,l=i.closePath,c=void 0===l||l,u=!ud(r.stroke)||r.stroke,h=!!ud(r.fill)&&r.fill,f=n.length;if(!(f<s)){e.setStyle(t,r),t.beginPath();var v=Ue(o)?o(n[0]):n[0],p=v.x,d=v.y;t.moveTo(p,d);for(var y=1;y<f;y++){var m=Ue(o)?o(n[y]):n[y],g=m.x,b=m.y;t.lineTo(g,b)}c&&t.closePath(),h&&t.fill(),u&&(t.globalAlpha=1,t.stroke())}}},{key:"drawCircle",value:function(t,n,r,i){var o=i.format,a=!ud(r.stroke)||r.stroke,s=!!ud(r.fill)&&r.fill,l=Ue(o)?o(n):n,c=l.cx,u=l.cy,h=l.r;e.setStyle(t,r),t.beginPath(),t.arc(c,u,h,0,2*Math.PI),s&&t.fill(),a&&(t.globalAlpha=1,t.stroke())}},{key:"drawPoint",value:function(t,n,r,i){var o=i.format,a=Ue(o)?o(n):n,s=a.x,l=a.y,c=a.r,u=void 0===c?2:c;e.setStyle(t,r),t.beginPath(),t.arc(s,l,u,0,2*Math.PI),t.fill()}},{key:"drawImage",value:function(e,t,n){var r=t.image,i=t.x,o=t.y,a=t.width,s=t.height;e.drawImage(r,i,o,a,s)}},{key:"drawText",value:function(t,n,r,i){var o=r.background,a=i.format,s=!ud(r.fill)||r.fill,l=Ue(a)?a(n):n,c=l.text,u=l.position,h=l.offset;if(c){e.setStyle(t,r);var f=u.x+h.x,v=u.y-h.y,p=t.lineWidth,d=3*pd.dpr,y=4*pd.dpr,m=t.textBaseline===xv.Bottom,g=t.textBaseline===xv.Top,b=t.textBaseline===xv.Middle;if(o){var w=t.measureText(c).width+2*y,x=parseInt(t.font.replace(/[^0-9.]/gi,""),10)+2*d,k=u.y;m&&(k-=x),g&&(k=k),b&&(k-=x/2);var O={x:u.x+h.x,y:k-h.y,width:w,height:x};e.drawRect(t,O,yd(yd({},r||{}),{},{fill:!0}))}t.globalAlpha=1,s?(t.fillStyle=r.fontColor,m&&o&&t.fillText(c,f+y,v-d+p),b&&o&&t.fillText(c,f+y,v),g&&o&&t.fillText(c,f+y,v+d+p),!o&&t.fillText(c,f,v)):(t.strokeStyle=r.fontColor,m&&o&&t.strokeText(c,f+y,v-d+p),b&&o&&t.strokeText(c,f+y,v),g&&o&&t.strokeText(c,f+y,v+d+p),!o&&t.strokeText(c,f,v))}}},{key:"drawArrow",value:function(t,n,r,i,o){var a=(o||{}).format,s=Ue(a)?a(n):n,l=s.position,c=s.points,u=void 0===c?[]:c;e.setStyle(t,i),t.save(),t.beginPath(),t.translate(l.x,l.y),t.rotate(r),Gi(u,(function(e,n){0===n?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)})),t.closePath(),t.restore(),t.fill(),t.stroke()}}]),e}();function gd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gd(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wd(e){var t=xd();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function xd(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(md,"defaultStyle",{fillStyle:"#FF0000",strokeStyle:"#FF0000",lineWidth:1,font:"normal 12px Arial",globalAlpha:1,lineCap:"round",lineJoin:"round",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0}),a(md,"formatStyle",{lineWidth:function(e){return e*pd.dpr},font:function(e){var t=e.replace(/[^0-9.]/gi,""),n=parseInt(t,10)*pd.dpr,r=new RegExp("".concat(t),"g");return e.replace(r,"".concat(n))}});var kd,Od,Sd,Cd,Pd,Ad,Dd,Fd,jd=function(e){Xv(r,e);var t=wd(r);function r(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n(this,r),(o=t.call(this,e,nd.Clear,a,s)).shape=i,o}return o(r,[{key:"refresh",value:function(){var e=this,t=pd.dpr,n=this.layer.map.getScale(),r=bd(bd({},this.style||{}),{},{lineCap:"round",lineJoin:"round"});this.layer.canvasContext.globalCompositeOperation="destination-out",md.drawPolyline(this.layer.canvasContext,this.shape,r,{format:function(r){var i=r.points,o=r.width;return bd({points:op(i,(function(n){var r=e.layer.map.transformGlobalToScreen(n),i=r.x,o=r.y;return{x:i*t,y:o*t}}))},Wa(o)?{width:o*n*t}:{})}}),this.layer.canvasContext.globalCompositeOperation="source-over"}}]),r}(od);(Fd=kd||(kd={})).Image="IMAGE",Fd.Feature="FEATURE",Fd.Event="EVENT",Fd.Mask="MASK",Fd.Text="TEXT",Fd.Marker="MARKER",Fd.Overlay="OVERLAY",(Dd=Od||(Od={})).LoadStart="loadStart",Dd.LoadEnd="loadEnd",Dd.LoadError="loadError",(Ad=Sd||(Sd={})).Point="POINT",Ad.Line="LINE",Ad.Polyline="POLYLINE",Ad.Polygon="POLYGON",Ad.Rect="RECT",Ad.Circle="CIRCLE",Ad.Arrow="ARROW",(Pd=Cd||(Cd={})).Global="GLOBAL",Pd.Screen="SCREEN";var Id,Rd,Td,Ed=function e(){n(this,e)};function Md(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Md(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Md(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ld(e){var t=Bd();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function Bd(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(Ed,"MathUtil",{getMiddlePoint:function(e,t){var n=e.x,r=e.y;return{x:(n+t.x)/2,y:(r+t.y)/2}},distance:function(e,t){var n=e.x,r=e.y,i=n-t.x,o=r-t.y;return Math.sqrt(i*i+o*o)},pointInPolygon:function(e,t){for(var n=e.x,r=e.y,i=!1,o=-1,a=t.length,s=a-1;++o<a;s=o){var l=t[o],c=l.x,u=l.y,h=t[s],f=h.x,v=h.y;(u<=r&&r<v||v<=r&&r<u)&&n<(f-c)*(r-u)/(v-u)+c&&(i=!i)}return i},pointInPoint:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).tolerance;return Ed.MathUtil.distance(e,t)<=n},pointInPolyline:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).tolerance,r=t.length-1,i=!1;return Gi(t,(function(o,a){if(a!==r){var s=t[a+1];return Ed.MathUtil.distancePoint2Line(e,o,s)<=n?(i=!0,!1):void 0}})),i},distancePoint2Line:function(e,t,n){var r,i,o=e.x,a=e.y,s=t.x,l=t.y,c=n.x,u=n.y,h=c-s,f=u-l,v=h*h+f*f,p=-1;0!==v&&(p=((o-s)*h+(a-l)*f)/v),p<0?(r=s,i=l):p>1?(r=c,i=u):(r=s+p*h,i=l+p*f);var d=o-r,y=a-i;return Math.sqrt(d*d+y*y)}}),a(Ed,"EventUtil",{getButtonIndex:function(e){if(!+[1])switch(e.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}return e.button},getMouseDirection:function(e,t){var n=e.offsetLeft,r=-e.offsetTop,i=n+e.offsetWidth,o=r-e.offsetHeight,a=(n+i)/2,s=(r+o)/2,l=(o-r)/(i-n),c=t||window.event,u=c.clientX,h=-c.clientY,f=(h-s)/(u-a);return l<f&&f<-l?u>a?1:3:h>s?0:2}}),(Id||(Id={})).Marker="MARKER",(Td=Rd||(Rd={})).Click="click",Td.MouseDown="mouseDown",Td.MouseUp="mouseUp",Td.MouseOver="mouseOver",Td.MouseOut="mouseOut",Td.DragStart="dragStart",Td.Dragging="dragging",Td.DragEnd="dragEnd",Td.RightClick="rightClick";var zd=function(e){Xv(r,e);var t=Ld(r);function r(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n(this,r),a(Nv(i=t.call(this,e,kd.Event,o,s)),"dragging",!1),a(Nv(i),"breakFeatureCapture",!1),a(Nv(i),"tmpPointsStore",[]),a(Nv(i),"hoverFeature",null),a(Nv(i),"hoverFeatureIndex",void 0),i.onMouseDown=i.onMouseDown.bind(Nv(i)),i.onMouseMove=i.onMouseMove.bind(Nv(i)),i.onMouseUp=i.onMouseUp.bind(Nv(i)),i.onMouseOut=i.onMouseOut.bind(Nv(i)),i.onMouseOver=i.onMouseOver.bind(Nv(i)),i.onMouseClick=i.onMouseClick.bind(Nv(i)),i.onMouseDblClick=i.onMouseDblClick.bind(Nv(i)),i.onMouseWheel=i.onMouseWheel.bind(Nv(i)),i}return o(r,[{key:"onAdd",value:function(e){$v(Vv(r.prototype),"onAdd",this).call(this,e),this.createEventDom(),this.dom.appendChild(this.eventDom),this.addEventListener()}},{key:"createEventDom",value:function(){this.eventDom=document.createElement("div"),this.eventDom.style.position="absolute",this.eventDom.style.left="0",this.eventDom.style.right="0",this.eventDom.style.top="0",this.eventDom.style.bottom="0",this.eventDom.style.zIndex="1",this.eventDom.ondragstart=function(e){e.preventDefault(),e.stopPropagation()}}},{key:"addEventListener",value:function(){this.eventDom.addEventListener("mousedown",this.onMouseDown),this.eventDom.addEventListener("mousemove",this.onMouseMove),this.eventDom.addEventListener("mouseup",this.onMouseUp),this.eventDom.addEventListener("click",this.onMouseClick),this.eventDom.addEventListener("dblclick",this.onMouseDblClick),this.eventDom.addEventListener("mousewheel",this.onMouseWheel),this.eventDom.addEventListener("mouseout",this.onMouseOut),this.eventDom.addEventListener("mouseover",this.onMouseOver)}},{key:"removeEventListener",value:function(){this.eventDom.removeEventListener("mousedown",this.onMouseDown),this.eventDom.removeEventListener("mousemove",this.onMouseMove),this.eventDom.removeEventListener("mouseup",this.onMouseUp),this.eventDom.removeEventListener("click",this.onMouseClick),this.eventDom.removeEventListener("dblclick",this.onMouseDblClick),this.eventDom.removeEventListener("mousewheel",this.onMouseWheel),this.eventDom.removeEventListener("mouseout",this.onMouseOut),this.eventDom.removeEventListener("mouseover",this.onMouseOver)}},{key:"handleMapPanStart",value:function(e){var t=this;this.dragging=!0,this.map.setCursor(Cv.Grabbing),document.onmousemove=function(e){return t.handleMapPanMove(e)},document.onmouseup=function(e){return t.handleMapPanEnd(e)}}},{key:"handleMapPanMove",value:function(e){var t=this.getDltXY(e),n=t.x,r=t.y;this.map.onDrag(n,r)}},{key:"handleMapPanEnd",value:function(e){this.dragging=!1,this.map.setCursor(Cv.Grab),document.onmousemove=null,document.onmouseup=null;var t=this.getDltXY(e),n=t.x,r=t.y,i=this.map.getScreenCenter(),o=i.x-n,a=i.y-r,s=this.map.transformScreenToGlobal({x:o,y:a});this.map.reset().setCenter(s)}},{key:"getDltXY",value:function(e,t){var n=(t||{}).transform,r=void 0!==n&&n,i=this.map.getScale(),o=e.screenX,a=e.screenY,s=this.startPageScreenPoint,l=o-s.x,c=a-s.y;return{x:r?l/i:l,y:r?c/i:c}}},{key:"clearDownTimer",value:function(){this.downTimer&&(window.clearTimeout(this.downTimer),this.downTimer=null)}},{key:"handleMarkerStart",value:function(e){var t=this;this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.map.eventsObServer.emit(Ov.DrawDone,t.map.mode,{x:t.startPoint.global.x,y:t.startPoint.global.y})}),300)}},{key:"handlePointStart",value:function(e){var t=this;this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.map.eventsObServer.emit(Ov.DrawDone,t.map.mode,{x:t.startPoint.global.x,y:t.startPoint.global.y}),t.reset()}),300)}},{key:"handleCircleStart",value:function(e){var t=this;this.dragging=!0,document.onmousemove=function(e){return t.handleCircleMove(e)},document.onmouseup=function(e){return t.handleCircleEnd(e)};var n=this.startPoint.global;this.setTip({text:"移动开始绘制",position:n})}},{key:"handleCircleMove",value:function(e){var t=this.startPoint.global,n=this.getDltXY(e,{transform:!0}),r=n.x,i=n.y,o=this.getDltXY(e,{transform:!1}),a=o.x,s=o.y,l=Math.sqrt(a*a+s*s),c=this.map.xAxis.direction===bv.Right?r:-r,u=this.map.yAxis.direction===wv.Top?i:-i,h={x:t.x+c,y:t.y-u},f={cx:t.x,cy:t.y,sr:l};this.map.overlayLayer.addCircleFeature(f),this.setTip({text:"抬起完成绘制",position:h})}},{key:"handleCircleEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null;var t=this.startPoint.global,n=t.x,r=t.y,i=this.getDltXY(e,{transform:!0}),o=i.x,a=i.y,s=this.getDltXY(e,{transform:!1}),l=s.x,c=s.y,u=Math.sqrt(o*o+a*a),h=Math.sqrt(l*l+c*c);if(this.reset(),!(Math.abs(h)<=2)){var f={cx:n,cy:r,r:u},v={cx:n,cy:r,sr:h};this.map.eventsObServer.emit(Ov.DrawDone,this.map.mode,f,v)}}},{key:"handleLineStart",value:function(e){var t=this;if(0===this.tmpPointsStore.length)this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.tmpPointsStore.push(t.startPoint),t.setTip({text:"移动开始绘制",position:t.startPoint.global})}),300);else if(1===this.tmpPointsStore.length){var n=this.tmpPointsStore[0].global,r=this.startPoint.global;this.map.eventsObServer.emit(Ov.DrawDone,this.map.mode,{start:n,end:r}),this.reset()}}},{key:"handleLineMove",value:function(e){var t=e.offsetX,n=e.offsetY,r={x:t,y:n},i=this.map.transformScreenToGlobal(r),o=this.tmpPointsStore.length;if(0===o)this.setTip({text:"单击确定起点",position:i});else if(1===o){var a=this.tmpPointsStore[0].global,s=this.map.transformScreenToGlobal({x:t,y:n});this.map.overlayLayer.addLineFeature({start:a,end:s}),this.setTip({text:"单击确定终点",position:i})}}},{key:"handlePolylineStart",value:function(e){var t=this;0===this.tmpPointsStore.length?(this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.tmpPointsStore.push(t.startPoint),t.setTip({text:"移动开始绘制",position:t.startPoint.global})}),300)):(this.tmpPointsStore.push(this.startPoint),this.map.withHotKeys&&this.setTip({text:"ctrl+z撤销",position:this.startPoint.global}))}},{key:"handlePolylineMove",value:function(e){var t=e.offsetX,n=e.offsetY,r=this.map.transformScreenToGlobal({x:t,y:n}),i=op(this.tmpPointsStore,(function(e){return e.global}));i.push(r),1===i.length?this.setTip({text:"单击确定起点",position:r}):i.length>1&&(this.map.overlayLayer.addPolylineFeature({points:i}),this.setTip({text:"单击绘制/双击结束",position:r}))}},{key:"handlePolylineEnd",value:function(e){this.tmpPointsStore.pop(),this.tmpPointsStore.length>=2&&this.map.eventsObServer.emit(Ov.DrawDone,this.map.mode,op(this.tmpPointsStore,(function(e){return e.global}))),this.reset()}},{key:"handleRectStart",value:function(e){var t=this;this.dragging=!0,document.onmousemove=function(e){return t.handleRectMove(e)},document.onmouseup=function(e){return t.handleRectEnd(e)};var n=this.startPoint.global;this.setTip({text:"移动开始绘制",position:n})}},{key:"handleRectMove",value:function(e){var t=this.startPoint.global,n=t.x,r=t.y,i=this.getDltXY(e,{transform:!0}),o=i.x,a=i.y,s=this.map.xAxis.direction===bv.Right,l=this.map.yAxis.direction===wv.Top,c={x:s?n+o:n-o,y:l?r-a:r+a},u={x:s?Math.min(n,n+o):Math.max(n,n-o),y:l?Math.max(r,r-a):Math.min(r,r+a),width:Math.abs(o),height:Math.abs(a)};this.map.overlayLayer.addRectFeature(u),this.setTip({text:"抬起完成绘制",position:c})}},{key:"handleRectEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null;var t=this.map.getScale(),n=this.startPoint.screen,r=n.x,i=n.y,o=this.getDltXY(e),a=o.x,s=o.y,l=Math.abs(a)/t,c=Math.abs(s)/t,u=r+a,h=i+s,f=Math.min(u,r),v=Math.min(h,i),p=this.map.transformScreenToGlobal({x:f,y:v});if(this.reset(),!(Math.abs(a)<=3||Math.abs(s)<=3)){var d={x:p.x,y:p.y,width:l,height:c};this.map.eventsObServer.emit(Ov.DrawDone,this.map.mode,d)}}},{key:"handlePolygonStart",value:function(e){var t=this;0===this.tmpPointsStore.length?(this.clearDownTimer(),this.downTimer=window.setTimeout((function(){t.tmpPointsStore.push(t.startPoint),t.setTip({text:"移动开始绘制",position:t.startPoint.global})}),300)):(this.tmpPointsStore.push(this.startPoint),this.map.withHotKeys&&this.setTip({text:"ctrl+z撤销",position:this.startPoint.global}))}},{key:"handlePolygonMove",value:function(e){var t=e.offsetX,n=e.offsetY,r=this.map.transformScreenToGlobal({x:t,y:n}),i=op(this.tmpPointsStore,(function(e){return e.global}));i.push(r);var o=i.length;if(1===o)this.setTip({text:"单击确定起点",position:r});else if(o>1){this.map.overlayLayer.addPolygonFeature({points:i},{node:!0});var a=2===o?"单击绘制":"单击绘制/双击结束";this.setTip({text:a,position:r})}}},{key:"handlePolygonEnd",value:function(e){if(this.tmpPointsStore.pop(),this.tmpPointsStore.length>=3){var t=op(this.tmpPointsStore,(function(e){return e.global}));this.map.eventsObServer.emit(Ov.DrawDone,this.map.mode,t)}this.reset()}},{key:"handleMaskStart",value:function(e){var t=this;this.dragging=!0,document.onmousemove=function(e){return t.handleMaskMove(e)},document.onmouseup=function(e){return t.handleMaskEnd(e)},this.tmpPointsStore.push(this.startPoint);var n=op(this.tmpPointsStore,(function(e){return e.global}));switch(this.map.mode){case kv.DrawMask:this.map.overlayLayer.addDrawAction({points:n});break;case kv.ClearMask:this.handleMaskClearMoving({points:n})}}},{key:"handleMaskMove",value:function(e){var t=this.startPoint.screen,n=t.x,r=t.y,i=this.getDltXY(e),o={x:n+i.x,y:r+i.y},a=this.map.transformScreenToGlobal(o),s=sp(this.tmpPointsStore);if(s){var l=s.screen;if(Ed.MathUtil.distance(l,o)<=3)return}this.tmpPointsStore.push({screen:o,global:a});var c=op(this.tmpPointsStore,(function(e){return e.global}));switch(this.map.mode){case kv.DrawMask:this.map.overlayLayer.addDrawAction({points:c});break;case kv.ClearMask:this.handleMaskClearMoving({points:c})}}},{key:"handleMaskEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null;var t=op(this.tmpPointsStore,(function(e){return e.global}));this.map.eventsObServer.emit(Ov.DrawDone,this.map.mode,t),this.reset(),this.handleMaskClearMoving({reset:!0})}},{key:"handleMaskClearMoving",value:function(e){var t=e.points,n=void 0===t?[]:t,r=e.reset,i=void 0!==r&&r,o=this.map.getLayers(),a=this.map.drawingStyle,s=a.lineWidth,l=(void 0===s?10:s)/this.map.getScale();Gi(o,(function(e){if(e.type!==kd.Mask||i)e.type===kd.Mask&&i&&e.setMovingClearAction(null);else{var t=new jd("".concat(+new Date),{points:n,width:l},{},a);e.setMovingClearAction(t)}}))}},{key:"handleMapZoom",value:function(e){var t=90+this.map.zoomWheelRatio,n={x:e.offsetX,y:e.offsetY},r={screen:n,global:this.map.transformScreenToGlobal(n)},i=e.deltaY<0?this.map.zoom*t/100:100*this.map.zoom/t,o=this.map.getScreenCenter(),a=this.map.transformScreenToGlobal(o,{basePoint:r,zoom:i});this.map.centerAndZoom({center:a,zoom:i},{refreshDelay:!0})}},{key:"handleFeatureSelect",value:function(e){var t=this.map.getTargetFeatureWithPoint(this.startPoint.global);t&&this.map.eventsObServer.emit(Ov.FeatureSelected,t)}},{key:"handleActiveFeatureCapture",value:function(e){var t=this,n={x:e.offsetX,y:e.offsetY},r=this.map.transformScreenToGlobal(n),i=this.map.activeFeature,o=i||{},a=o.type,s=o.shape;switch(this.hoverFeature=null,this.hoverFeatureIndex=void 0,a){case Sd.Point:i.captureWithPoint(r)&&(this.hoverFeature=i,this.map.setCursor(Cv.Pointer),this.map.eventLayer.breakFeatureCapture=!0,this.setTip({text:"按下移动图形/右键删除",position:r}));break;case Sd.Rect:case Sd.Circle:var l=a===Sd.Rect?i.getPoints():i.getEdgePoints();Gi(l,(function(e,i){var o=t.map.transformGlobalToScreen(e);if(Ed.MathUtil.distance(o,n)<=5){t.hoverFeatureIndex=i;var a=1===i||3===i?Cv.NESW_Resize:Cv.NWSE_Resize;return t.map.setCursor(a),t.map.eventLayer.breakFeatureCapture=!0,t.setTip({text:"按下拖动",position:r}),!1}})),!Wa(this.hoverFeatureIndex)&&i.captureWithPoint(r)&&(this.hoverFeature=i,this.map.setCursor(Cv.Move),this.map.eventLayer.breakFeatureCapture=!0,this.setTip({text:"按下移动图形",position:r}));break;case Sd.Line:case Sd.Polyline:case Sd.Polygon:var c=a===Sd.Line,u=a===Sd.Polyline;Sd.Polygon;var h=s,f=h.start,v=h.end,p=s.points,d=c?[f,v]:void 0===p?[]:p,y=d.length;Gi(d,(function(e,i){var o=t.map.transformGlobalToScreen(e);if(Ed.MathUtil.distance(o,n)<=5){t.hoverFeatureIndex=i,t.map.setCursor(Cv.Pointer);var a=y>(c||u?2:3)?"/右键删除":"";return t.map.eventLayer.breakFeatureCapture=!0,t.setTip({text:"按下拖动".concat(a),position:r}),!1}if(!c){if(u&&!d[i+1])return!1;var s=d[i+1]||d[0],l=Ed.MathUtil.getMiddlePoint(e,s),h=t.map.transformGlobalToScreen(l);return Ed.MathUtil.distance(h,n)<=5?(t.hoverFeatureIndex=i+.5,t.map.setCursor(Cv.Pointer),t.map.eventLayer.breakFeatureCapture=!0,t.setTip({text:"按下拖动添加新节点",position:r}),!1):void 0}})),!Wa(this.hoverFeatureIndex)&&i.captureWithPoint(r)&&(this.hoverFeature=i,this.map.setCursor(Cv.Move),this.map.eventLayer.breakFeatureCapture=!0,this.setTip({text:"按下移动图形",position:r}))}}},{key:"handleActiveFeatureStart",value:function(e){var t=this;this.map.tipLayer.removeAllFeatureActionText();var n=Ed.EventUtil.getButtonIndex(e);0===n?(this.dragging=!0,document.onmousemove=function(e){return t.handleActiveFeatureMove(e)},document.onmouseup=function(e){return t.handleActiveFeatureEnd(e)}):2===n&&this.handleActiveFeatureElse(e)}},{key:"handleActiveFeatureMove",value:function(e){var t=this,n=this.getDltXY(e,{transform:!0}),r=n.x,i=n.y,o=this.getDltXY(e,{transform:!1}),a=o.x;o.y;var s=this.map.activeFeature,l=s.type,c=s.shape,u=s.style,h=this.map.xAxis.direction===bv.Right,f=this.map.yAxis.direction===wv.Top,v=h?r:-r,p=f?i:-i,d=h?a:-a;switch(l){case Sd.Point:var y,m=c,g=m.x,b=m.y;this.toUpdateShape=_d(_d({},c),{},{x:g+v,y:b-p}),this.map.overlayLayer.addActiveFeature(s),this.map.overlayLayer.addPointFeature(this.toUpdateShape,{clear:!1,style:_d(_d({},u),{},{fillStyle:null===(y=this.map)||void 0===y?void 0:y.editingColor})});break;case Sd.Circle:var w,x=c,k=x.cx,O=x.cy,S=x.r,C=x.sr;if(this.hoverFeature)this.toUpdateShape=_d(_d({},c),{},{cx:k+v,cy:O-p});else if(Wa(this.hoverFeatureIndex)){0===this.hoverFeatureIndex||this.hoverFeatureIndex;var P=1===this.hoverFeatureIndex||2===this.hoverFeatureIndex,A=s.getSubType()===Cd.Global,D=A?P?S+v:S-v:P?C+d:C-d;if(D<=0)return;this.toUpdateShape=_d(_d({},c),A?{r:D}:{sr:D})}this.map.overlayLayer.addActiveFeature(s),this.map.overlayLayer.addCircleFeature(this.toUpdateShape,{clear:!1,style:_d(_d({},u),{},{lineWidth:1,strokeStyle:null===(w=this.map)||void 0===w?void 0:w.editingColor})});break;case Sd.Rect:var F,j=c,I=j.x,R=j.y,T=j.width,E=j.height,M=null;if(this.hoverFeature)M={x:I+v,y:R-p,width:T,height:E};else if(Wa(this.hoverFeatureIndex)){var _=0===this.hoverFeatureIndex||3===this.hoverFeatureIndex,L=0===this.hoverFeatureIndex||1===this.hoverFeatureIndex,B=_?I+v:I,z=L?R-p:R,W=_?T-r:T+r,U=L?E-i:E+i,G=h?B+W:B-W,N=f?z-U:z+U;M={x:h?Math.min(B,G):Math.max(B,G),y:f?Math.max(z,N):Math.min(z,N),width:Math.abs(W),height:Math.abs(U)}}this.toUpdateShape=_d(_d({},c),M),this.map.overlayLayer.addActiveFeature(s),this.map.overlayLayer.addRectFeature(this.toUpdateShape,{clear:!1,style:_d(_d({},u),{},{lineWidth:1,strokeStyle:null===(F=this.map)||void 0===F?void 0:F.editingColor})});break;case Sd.Line:case Sd.Polyline:case Sd.Polygon:var V,K,$,Y=l===Sd.Line,X=l===Sd.Polyline,q=l===Sd.Polygon,H=c,Z=H.start,J=H.end,Q=c.points,ee=Y?[Z,J]:void 0===Q?[]:Q,te=[];if(this.hoverFeature)te=op(ee,(function(e){var t=e.x,n=e.y;return{x:t+v,y:n-p}}));else if(Wa(this.hoverFeatureIndex)){var ne=parseInt("".concat(this.hoverFeatureIndex),10);Gi(ee,(function(e,n){var r=e.x,i=e.y;if(n===ne&&ne===t.hoverFeatureIndex)te.push({x:r+v,y:i-p});else if(n===ne&&ne!==t.hoverFeatureIndex){var o=ee[n+1]||ee[0],a=Ed.MathUtil.getMiddlePoint({x:r,y:i},o);te.push({x:r,y:i}),te.push({x:a.x+v,y:a.y-p})}else te.push({x:r,y:i})}))}if(Y){var re=Gv(te,2),ie=re[0],oe=re[1];this.toUpdateShape=_d(_d({},c),{},{start:ie,end:oe})}else this.toUpdateShape=_d(_d({},c),{},{points:te});this.map.overlayLayer.addActiveFeature(s),Y&&this.map.overlayLayer.addLineFeature(this.toUpdateShape,{clear:!1,style:_d(_d({},u),{},{strokeStyle:null===(V=this.map)||void 0===V?void 0:V.editingColor})}),X&&this.map.overlayLayer.addPolylineFeature(this.toUpdateShape,{clear:!1,style:_d(_d({},u),{},{strokeStyle:null===(K=this.map)||void 0===K?void 0:K.editingColor})}),q&&this.map.overlayLayer.addPolygonFeature(this.toUpdateShape,{clear:!1,style:_d(_d({},u),{},{lineWidth:1,strokeStyle:null===($=this.map)||void 0===$?void 0:$.editingColor})})}}},{key:"handleActiveFeatureEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null,this.map.overlayLayer.removeAllFeatureActionText();var t=this.map.activeFeature;if(t&&this.map.overlayLayer.addActiveFeature(t),this.toUpdateShape&&t){switch(t.type){case Sd.Point:case Sd.Circle:case Sd.Line:case Sd.Polyline:case Sd.Rect:case Sd.Polygon:this.map.eventsObServer.emit(Ov.FeatureUpdated,t,this.toUpdateShape)}this.toUpdateShape=null}}},{key:"handleActiveFeatureElse",value:function(e){var t=this.map.activeFeature;if(t){var n=t.type,r=t.shape;switch(n){case Sd.Point:this.map.eventsObServer.emit(Ov.FeatureDeleted,t);break;case Sd.Polyline:case Sd.Polygon:var i=n===Sd.Polyline;Sd.Polygon;var o=i?2:3,a=r.points,s=void 0===a?[]:a;if(Wa(this.hoverFeatureIndex)&&s.length>o){var l=parseInt("".concat(this.hoverFeatureIndex),10);if(l===this.hoverFeatureIndex){var c=_v(s,(function(e,t){return t!==l})),u=_d(_d({},r),{},{points:c});this.map.eventsObServer.emit(Ov.FeatureUpdated,t,u)}}}}}},{key:"handleFeatureCapture",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).extraTip,n=void 0===t?"":t,r=this.dragging||this.tmpPointsStore.length;this.map.featureCaptureWhenMove&&!r&&this.map.getTargetFeatureWithPoint(e)&&this.setTip({text:(n?n+"/":"")+"双击选中",position:e})}},{key:"clearMousemoveTimer",value:function(){this.mousemoveTimer&&(window.clearTimeout(this.mousemoveTimer),this.mousemoveTimer=null)}},{key:"getMouseEventPoint",value:function(e){var t={x:e.offsetX,y:e.offsetY};return{screen:t,global:this.map.transformScreenToGlobal(t)}}},{key:"onMouseDown",value:function(e){var t=e.screenX,n=e.screenY;this.startPoint=this.getMouseEventPoint(e),this.startPageScreenPoint={x:t,y:n};var r=this.map.mode,i=this.dragging,o=this.hoverFeature||Wa(this.hoverFeatureIndex),a=!i&&!o;this.map.eventsObServer.emit(Ov.MouseDown,this.startPoint),!this.map.activeFeature||o?r!==kv.Ban&&(r===kv.Pan&&a?this.handleMapPanStart(e):r===kv.MARKER&&a?this.handleMarkerStart(e):r===kv.Point&&a?this.handlePointStart(e):r===kv.Circle&&a?this.handleCircleStart(e):r===kv.Line&&a?this.handleLineStart(e):r===kv.Polyline&&a?this.handlePolylineStart(e):r===kv.Rect&&a?this.handleRectStart(e):r===kv.Polygon&&a?this.handlePolygonStart(e):r!==kv.DrawMask&&r!==kv.ClearMask||!a||this.handleMaskStart(e),o&&!i&&this.handleActiveFeatureStart(e)):this.map.eventsObServer.emit(Ov.FeatureUnselected,this.map.activeFeature,"cancel by click")}},{key:"onMouseMove",value:function(e){this.mouseMoveEvent=e;var t=this.getMouseEventPoint(e),n=t.screen,r=t.global,i=this.map.mode,o=this.dragging;if(this.map.eventsObServer.emit(Ov.MouseMove,{screen:n,global:r}),this.map.activeFeature||o||this.map.overlayLayer.removeAllFeatureActionText(),i!==kv.Ban){if(i!==kv.Pan||o)if(i!==kv.MARKER||o)if(i!==kv.Point||o)if(i!==kv.Circle||o)if(i!==kv.Line||o)if(i!==kv.Polyline||o)if(i!==kv.Rect||o)if(i!==kv.Polygon||o){if(i===kv.DrawMask){var a=Ma(this.map.drawingStyle,"lineWidth",1);this.map.setCursor(Pv.DrawMask,{type:Sd.Circle,shape:{sr:a/2,cx:r.x,cy:r.y}})}else if(i===kv.ClearMask){var s=Ma(this.map.drawingStyle,"lineWidth",1);this.map.setCursor(Pv.ClearMask,{type:Sd.Circle,shape:{sr:s/2,cx:r.x,cy:r.y}})}}else this.map.setCursor(Cv.Crosshair),this.handlePolygonMove(e),this.handleFeatureCapture(r);else this.map.setCursor(Cv.Crosshair),this.setTip({text:"按下确定起点",position:r}),this.handleFeatureCapture(r);else this.map.setCursor(Cv.Crosshair),this.handlePolylineMove(e),this.handleFeatureCapture(r);else this.map.setCursor(Cv.Crosshair),this.handleLineMove(e),this.handleFeatureCapture(r);else this.map.setCursor(Cv.Crosshair),this.setTip({text:"按下确定圆心",position:r}),this.handleFeatureCapture(r);else this.map.setCursor(Cv.Crosshair),this.setTip({text:"点击绘制点",position:r}),this.handleFeatureCapture(r);else this.map.setCursor(Cv.Crosshair);else this.map.setCursor(Cv.Grab);this.map.activeFeature&&!o&&this.setTip({text:"单击取消选中",position:r}),id([kv.Point,kv.Circle,kv.Line,kv.Polyline,kv.Rect,kv.Polygon],i)&&!o&&this.handleActiveFeatureCapture(e)}}},{key:"onMouseUp",value:function(e){this.map.eventsObServer.emit(Ov.MouseUp,this.getMouseEventPoint(e))}},{key:"onMouseClick",value:function(e){this.map.eventsObServer.emit(Ov.Click,this.getMouseEventPoint(e))}},{key:"onMouseDblClick",value:function(e){var t=this.map.mode;this.clearDownTimer();var n=this.dragging||this.tmpPointsStore.length;this.map.eventsObServer.emit(Ov.DblClick,this.getMouseEventPoint(e)),t!==kv.Ban&&(t===kv.Polyline&&n?this.handlePolylineEnd(e):t===kv.Polygon&&n&&this.handlePolygonEnd(e),id([kv.Point,kv.Circle,kv.Line,kv.Polyline,kv.Rect,kv.Polygon],t)&&!n&&this.handleFeatureSelect(e))}},{key:"onMouseWheel",value:function(e){var t=this.map.mode;switch(t!==kv.Ban&&e.preventDefault(),t){case kv.Ban:break;case kv.Pan:this.handleMapZoom(e);break;default:this.map.zoomWhenDrawing&&this.handleMapZoom(e)}}},{key:"clearPanWhenDrawingTimer",value:function(){this.panWhenDrawingTimer&&(window.clearInterval(this.panWhenDrawingTimer),this.panWhenDrawingTimer=null)}},{key:"handlePanWhenDrawing",value:function(e){var t=this,n=Ed.EventUtil.getMouseDirection(this.map.dom,e);this.clearPanWhenDrawingTimer();var r=10;this.map.panWhenDrawing&&this.tmpPointsStore.length&&(this.panWhenDrawingTimer=window.setInterval((function(){var e=t.map.getScale(),i=r/e,o=t.map.getCenter(),a=t.map.xAxis.direction===bv.Right,s=t.map.yAxis.direction===wv.Top,l=o;switch(n){case 0:l={x:o.x,y:s?o.y+i:o.y-i};break;case 1:l={x:a?o.x+i:o.x-i,y:o.y};break;case 2:l={x:o.x,y:s?o.y-i:o.y+i};break;case 3:l={x:a?o.x-i:o.x+i,y:o.y}}t.map.setCenter(l)}),100))}},{key:"onMouseOut",value:function(e){e.preventDefault(),this.map.tipLayer.removeAllFeatureActionText(),this.map.cursorLayer.removeAllFeatureActionText(),e.toElement&&e.toElement.getAttribute("data-type")===Id.Marker||(this.handlePanWhenDrawing(e),this.map.eventsObServer.emit(Ov.MouseOut,this.getMouseEventPoint(e)))}},{key:"onMouseOver",value:function(e){e.preventDefault(),this.map.tipLayer.removeAllFeatureActionText(),this.clearPanWhenDrawingTimer(),this.map.eventsObServer.emit(Ov.MouseOver,this.getMouseEventPoint(e))}},{key:"revokeTmpPointsStore",value:function(){if(this.tmpPointsStore.length){this.tmpPointsStore.pop();var e=this.mouseMoveEvent;e&&this.onMouseMove(e)}}},{key:"setTip",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.map.drawingTip?this.map.tipLayer.addText(e,t):this.map.tipLayer.removeAllFeatureActionText()}},{key:"reset",value:function(){this.tmpPointsStore=[],this.map.overlayLayer.removeAllFeatureActionText(),this.map.tipLayer.removeAllFeatureActionText()}},{key:"refresh",value:function(){$v(Vv(r.prototype),"refresh",this).call(this)}}]),r}(hd),Wd={BASE64:"base64",BLOB:"blob"},Ud=function(){function e(t){n(this,e),a(this,"objects",[]),a(this,"map",{activeFeature:null,setActiveFeature:function(){},getScale:function(){return 1},transformGlobalToScreen:function(e){var t=e.x,n=e.y,r=this.bounds;return{x:t-r.x,y:n-r.y}}}),this.bounds=t,this.createRenderCanvas(),this.map.getScale=this.map.getScale.bind(this),this.map.transformGlobalToScreen=this.map.transformGlobalToScreen.bind(this)}return o(e,[{key:"createRenderCanvas",value:function(){var e=this.bounds,t=e.width,n=e.height;this.canvas=document.createElement("canvas"),this.canvas.width=t*pd.dpr,this.canvas.height=n*pd.dpr,this.canvas.style.width=t+"px",this.canvas.style.height=n+"px",this.canvasContext=this.canvas.getContext("2d"),md.drawRect(this.canvasContext,{x:0,y:0,width:this.canvas.width,height:this.canvas.height},{fill:!0,fillStyle:"#fff",stroke:!1})}},{key:"addObject",value:function(e){e.onAdd(this),this.objects.push(e)}},{key:"addObjects",value:function(e){var t=this;Gi(e,(function(e){return t.addObject(e)}))}},{key:"putImage",value:function(e){this.canvasContext.drawImage(e,0,0)}},{key:"addImageLayer",value:function(e){var t=this.map.transformGlobalToScreen(e.position),n=t.x,r=t.y,i=pd.dpr,o=this.map.getScale(),a=e.imageInfo,s=a.width*o,l=a.height*o;e.image&&e.imageSuccess&&md.drawImage(this.canvasContext,{image:e.image,x:n*i,y:r*i,width:s*i,height:l*i},{})}},{key:"convertCanvasToImage",value:function(e,t,n){return e===Wd.BASE64?this.convertCanvasToBase64(t,n):e===Wd.BLOB?this.convertCanvasToBlob(t,n):new Promise((function(t,n){n(new Error("export params error："+e))}))}},{key:"convertCanvasToBlob",value:function(e,t){var n=this;return new Promise((function(r,i){n.canvas.toBlob((function(t){n.canvas=null;var o=n.bounds,a=o.width,s=o.height;n.resizeBlobImage(t,{width:a,height:s},e,r,i)}),e,t)}))}},{key:"resizeBlobImage",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=new Image,a=URL.createObjectURL(e);o.src=a;var s=t.width,l=t.height,c=document.createElement("canvas"),u=c.getContext("2d");c.width=s,c.height=l,c.style.width=s+"px",c.style.height=l+"px",o.onload=function(){URL.revokeObjectURL(a),u.drawImage(o,0,0,s,l),c.toBlob((function(e){c=null,r(e)}),n,1)},o.onerror=function(){i(new Error("resize image error"))}}},{key:"convertCanvasToBase64",value:function(e,t){var n=this.canvas.toDataURL(e);this.canvas=null;var r=this.bounds,i=r.width,o=r.height;return this.resizeBase64Image(n,{width:i,height:o},e)}},{key:"resizeBase64Image",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",r=new Image;r.src=e;var i=t.width,o=t.height,a=document.createElement("canvas"),s=a.getContext("2d");return a.width=i,a.height=o,a.style.width=i+"px",a.style.height=o+"px",new Promise((function(e,t){r.onload=function(){s.drawImage(r,0,0,i,o),e(a.toDataURL(n))},r.onerror=function(){t(new Error("resize image error"))}}))}},{key:"refresh",value:function(){Gi(this.objects,(function(e){return e.refresh()}))}},{key:"clear",value:function(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)}}]),e}(),Gd=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};n(this,e),this.id=t,this.type=r,this.props=i,this.style=ri({},e.defaultStyle,o)}return o(e,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){var e,t,n=null===(e=this.layer)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.activeFeature;n&&n.id===this.id&&this.layer.map.setActiveFeature(null)}},{key:"getBounds",value:function(){return{x:0,y:0,width:0,height:0}}},{key:"captureWithPoint",value:function(e){return!1}},{key:"updateShape",value:function(e){var t,n,r;this.shape=e,null===(t=this.layer)||void 0===t||t.refresh();var i=null===(n=this.layer)||void 0===n||null===(r=n.map)||void 0===r?void 0:r.activeFeature;i&&i.id===this.id&&this.layer.map.setActiveFeature(this)}},{key:"onMove",value:function(e){}},{key:"setStyle",value:function(e,t){var n,r=t.refresh,i=void 0===r||r;this.style=e,i&&(null===(n=this.layer)||void 0===n||n.refresh())}},{key:"refresh",value:function(){}},{key:"printInfo",value:function(){}}]),e}();function Nd(e){var t=Vd();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function Vd(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(Gd,"moveStep",1),a(Gd,"defaultStyle",{opacity:1,fillStyle:"rgba(255, 0, 0, 0)",lineWidth:1,strokeStyle:"#000"});var Kd=function(e){Xv(r,e);var t=Nd(r);function r(e,i){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4?arguments[4]:void 0;return n(this,r),a(Nv(o=t.call(this,e,Sd.Point,s,l)),"option",{}),o.shape=i,o.option=ri({},r.defaultOption,c||{}),o}return o(r,[{key:"captureWithPoint",value:function(e){var t,n,r=this.shape,i=r.x,o=r.y,a=r.r,s=r.sr,l=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),c=l?3/l:0,u=Wa(a)?a+c:Wa(s)?s/l+c:c;return Ed.MathUtil.pointInPoint(e,{x:i,y:o},{tolerance:u})}},{key:"refresh",value:function(){var e,t=this.shape,n=t.x,r=t.y,i=t.r,o=t.sr;if(null!==(e=this.layer)&&void 0!==e&&e.map){var a=this.layer.map.transformGlobalToScreen({x:n,y:r}),s=a.x,l=a.y,c=pd.dpr,u=this.layer.map.getScale(),h=s*c,f=l*c,v=(Wa(i)?i*u:Wa(o)?o:2)*c;if(md.drawPoint(this.layer.canvasContext,{x:h,y:f,r:v},this.style,{}),this.option.active){var p=h-v-2,d=f-v-2,y=2*v+4,m=2*v+4,g=p+y,b=d,w=g,x=b+m,k=p,O=x;md.drawLine(this.layer.canvasContext,{start:{x:p,y:d},end:{x:w,y:x}},{strokeStyle:"#fff"}),md.drawLine(this.layer.canvasContext,{start:{x:g,y:b},end:{x:k,y:O}},{strokeStyle:"#fff"}),md.drawRect(this.layer.canvasContext,{x:p,y:d,width:y,height:m},{strokeStyle:"#666"})}}}}]),r}(Gd);function $d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$d(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xd(e){var t=qd();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function qd(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(Kd,"defaultOption",{active:!1});var Hd=function(e){Xv(r,e);var t=Xd(r);function r(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n(this,r),(o=t.call(this,e,Sd.Line,a,s)).shape=i,o}return o(r,[{key:"captureWithPoint",value:function(e){var t,n,r=this.shape,i=r.start,o=r.end,a=r.width,s=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),l=s?3/s:0,c=Wa(a)?a/2+l:l;return Ed.MathUtil.pointInPolyline(e,[i,o],{tolerance:c})}},{key:"getLineWidth",value:function(){var e,t,n=this.shape.width,r=this.style.lineWidth||1,i=null===(e=this.layer)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.getScale();return n?n*i:r}},{key:"refresh",value:function(){var e;if(null!==(e=this.layer)&&void 0!==e&&e.map){var t=this.shape,n=t.start,r=t.end,i=t.width,o=this.layer.map.transformGlobalToScreen(n),a=o.x,s=o.y,l=this.layer.map.transformGlobalToScreen(r),c=l.x,u=l.y,h=pd.dpr,f=(i||0)*this.layer.map.getScale(),v=this.getLineWidth(),p=Math.atan((u-s)/(c-a));p+=(c>a?90:-90)*Math.PI/180;var d=1.2*v*h,y=1.4*v*h;this.style.arrow&&md.drawArrow(this.layer.canvasContext,{position:{x:c*h,y:u*h},points:[{x:0*h,y:0-y},{x:d,y:2*d-y},{x:-d,y:2*d-y}]},p,Yd(Yd({},this.style),{},{lineWidth:2},this.style.strokeStyle?{fillStyle:this.style.strokeStyle}:{})),md.drawLine(this.layer.canvasContext,Yd({start:{x:a*h,y:s*h},end:{x:c*h,y:u*h}},Wa(i)?{width:f*h}:{}),this.style,{})}}}]),r}(Gd);function Zd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zd(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qd(e){var t=ey();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function ey(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ty=function(e){Xv(r,e);var t=Qd(r);function r(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n(this,r),(o=t.call(this,e,Sd.Polyline,a,s)).shape=i,o}return o(r,[{key:"captureWithPoint",value:function(e){var t,n,r=this.shape,i=r.points,o=void 0===i?[]:i,a=r.width,s=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),l=s?3/s:0,c=Wa(a)?a/2+l:l;return Ed.MathUtil.pointInPolyline(e,o,{tolerance:c})}},{key:"refresh",value:function(){var e,t=this;if(null!==(e=this.layer)&&void 0!==e&&e.map){var n=pd.dpr,r=this.layer.map.getScale();md.drawPolyline(this.layer.canvasContext,this.shape,this.style,{format:function(e){var i=e.points,o=e.width;return Jd({points:op(i,(function(e){var r=t.layer.map.transformGlobalToScreen(e),i=r.x,o=r.y;return{x:i*n,y:o*n}}))},Wa(o)?{width:o*r*n}:{})}})}}}]),r}(Gd);function ny(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ry(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ny(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ny(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function iy(e){var t=oy();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function oy(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ay=function(e){Xv(r,e);var t=iy(r);function r(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n(this,r),(o=t.call(this,e,Sd.Rect,a,s)).shape=i,o}return o(r,[{key:"captureWithPoint",value:function(e){var t=this.getPoints();return Ed.MathUtil.pointInPolygon(e,t)}},{key:"getPoints",value:function(){var e,t,n,r,i=(null===(e=this.layer)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.xAxis.direction)===bv.Left,o=(null===(n=this.layer)||void 0===n||null===(r=n.map)||void 0===r?void 0:r.yAxis.direction)===wv.Bottom,a=this.shape,s=a.x,l=a.y,c=a.width,u=a.height,h=i?s-c:s+c,f=o?l+u:l-u;return[{x:s,y:l},{x:h,y:l},{x:h,y:f},{x:s,y:f}]}},{key:"onMove",value:function(e){var t,n,r,i,o,a,s,l,c,u,h,f=Gd.moveStep,v=this.shape,p=v.x,d=v.y,y=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),m=(null===(r=this.layer)||void 0===r||null===(i=r.map)||void 0===i||null===(o=i.xAxis)||void 0===o?void 0:o.direction)===bv.Left,g=(null===(a=this.layer)||void 0===a||null===(s=a.map)||void 0===s||null===(l=s.yAxis)||void 0===l?void 0:l.direction)===wv.Bottom,b=f/y,w={};switch(e){case gv.UP:w={y:g?d-b:d+b};break;case gv.DOWN:w={y:g?d+b:d-b};break;case gv.LEFT:w={x:m?p+b:p-b};break;case gv.RIGHT:w={x:m?p-b:p+b}}var x=ry(ry({},this.shape),w);null===(c=this.layer)||void 0===c||null===(u=c.map)||void 0===u||null===(h=u.eventsObServer)||void 0===h||h.emit(Ov.FeatureUpdated,this,x)}},{key:"refresh",value:function(){var e,t=this;if(null!==(e=this.layer)&&void 0!==e&&e.map){var n=pd.dpr,r=this.layer.map.getScale();md.drawRect(this.layer.canvasContext,this.shape,this.style,{format:function(e){var i=e.x,o=e.y,a=e.width,s=e.height,l=t.layer.map.transformGlobalToScreen({x:i,y:o}),c=l.x,u=l.y;return{x:c*n,y:u*n,width:a*r*n,height:s*r*n}}})}}}]),r}(Gd);function sy(e){var t=ly();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function ly(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var cy=function(e){Xv(r,e);var t=sy(r);function r(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n(this,r),(o=t.call(this,e,Sd.Polygon,a,s)).shape=i,o}return o(r,[{key:"captureWithPoint",value:function(e){var t=this.shape.points,n=void 0===t?[]:t;return Ed.MathUtil.pointInPolygon(e,n)}},{key:"refresh",value:function(){var e,t=this;if(null!==(e=this.layer)&&void 0!==e&&e.map){var n=this.shape,r=n.points;n.inner;var i=pd.dpr;md.drawPolygon(this.layer.canvasContext,r,this.style,{format:function(e){var n=t.layer.map.transformGlobalToScreen(e),r=n.x,o=n.y;return{x:r*i,y:o*i}}})}}}]),r}(Gd);function uy(e){var t=hy();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function hy(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var fy=function(e){Xv(r,e);var t=uy(r);function r(e,i){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4?arguments[4]:void 0;return n(this,r),a(Nv(o=t.call(this,e,Sd.Circle,s,l)),"option",{}),o.shape=i,o.option=ri({},r.defaultOption,c||{}),o}return o(r,[{key:"getSubType",value:function(){var e=this.shape,t=e.r,n=e.sr;return Wa(t)?Cd.Global:Wa(n)?Cd.Screen:void 0}},{key:"captureWithPoint",value:function(e){var t,n,r=this.getSubType()===Cd.Global,i=this.getSubType()===Cd.Screen,o=this.shape,a=o.cx,s=o.cy,l=o.r,c=o.sr,u=null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.getScale(),h=u?3/u:0,f=r?l+h:i?c/u+h:h;return Ed.MathUtil.pointInPoint(e,{x:a,y:s},{tolerance:f})}},{key:"getEdgePoints",value:function(){var e,t,n,r,i=this.getSubType()===Cd.Global,o=this.getSubType()===Cd.Screen,a=(null===(e=this.layer)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.xAxis.direction)===bv.Left,s=(null===(n=this.layer)||void 0===n||null===(r=n.map)||void 0===r?void 0:r.yAxis.direction)===wv.Bottom,l=this.shape,c=l.cx,u=l.cy,h=l.r,f=l.sr,v=i?h:o?f:0,p=Math.sqrt(v*v/2),d=a?-p:p,y=s?-p:p;if(i)return[{x:c-d,y:u+y},{x:c+d,y:u+y},{x:c+d,y:u-y},{x:c-d,y:u-y}];if(o){var m,g,b=null===(m=this.layer)||void 0===m||null===(g=m.map)||void 0===g?void 0:g.getScale();if(!b)return[];var w=p/b,x=a?-w:w,k=s?-w:w;return[{x:c-x,y:u+k},{x:c+x,y:u+k},{x:c+x,y:u-k},{x:c-x,y:u-k}]}return[]}},{key:"refresh",value:function(){var e,t=this;if(null!==(e=this.layer)&&void 0!==e&&e.map){var n=this.getSubType()===Cd.Global,r=pd.dpr,i=this.layer.map.getScale();if(md.drawCircle(this.layer.canvasContext,this.shape,this.style,{format:function(e){var o=e.cx,a=e.cy,s=e.r,l=e.sr,c=n?s*i:Wa(l)?l:2,u=t.layer.map.transformGlobalToScreen({x:o,y:a}),h=u.x,f=u.y;return{cx:h*r,cy:f*r,r:c*r}}}),this.option.active){var o=this.getEdgePoints();Gi(o,(function(e){var n=e.x,i=e.y;md.drawCircle(t.layer.canvasContext,{sr:3.5,cx:n,cy:i},{strokeStyle:"#666",fillStyle:"#fff",stroke:!0,fill:!0,lineWidth:1},{format:function(e){var n=e.cx,i=e.cy,o=e.sr,a=t.layer.map.transformGlobalToScreen({x:n,y:i}),s=a.x,l=a.y;return{cx:s*r,cy:l*r,r:o*r}}})}))}}}}]),r}(Gd);function vy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function py(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vy(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vy(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function dy(e){var t=yy();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function yy(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(fy,"defaultOption",{active:!1});var my,gy=function(e){Xv(r,e);var t=dy(r);function r(e,i,o){var s,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return n(this,r),a(Nv(s=t.call(this,e,nd.Draw,l,c)),"category",""),s.shape=o,s.category=i,s}return o(r,[{key:"refresh",value:function(){var e=this,t=pd.dpr,n=this.layer.map.getScale(),r=py(py({},this.style||{}),{},{lineCap:"round",lineJoin:"round"});md.drawPolyline(this.layer.canvasContext,this.shape,r,{format:function(r){var i=r.points,o=r.width;return py({points:op(i,(function(n){var r=e.layer.map.transformGlobalToScreen(n),i=r.x,o=r.y;return{x:i*t,y:o*t}}))},Wa(o)?{width:o*n*t}:{})}})}}]),r}(od);function by(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?by(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):by(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}(my||(my={})).Text="TEXT";var xy=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};n(this,e),this.id=t,this.type=my.Text,this.props=i,this.textInfo=ri({},e.defaultTextInfo,r),this.style=ri({},e.defaultStyle,o)}return o(e,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){}},{key:"updateText",value:function(e){if(kp(e)&&e){var t,n=this.textInfo;this.textInfo=wy(wy({},n),{},{text:e}),null===(t=this.layer)||void 0===t||t.refresh()}}},{key:"updatePosition",value:function(e){var t,n=this.textInfo;this.textInfo=wy(wy({},n),{},{position:e}),null===(t=this.layer)||void 0===t||t.refresh()}},{key:"refresh",value:function(){var e,t=this;if(null!==(e=this.layer)&&void 0!==e&&e.map){var n=this.textInfo,r=pd.dpr;md.drawText(this.layer.canvasContext,n,this.style,{format:function(e){var n=e.position,i=e.offset,o=t.layer.map.transformGlobalToScreen(n),a=o.x,s=o.y,l=i.x,c=i.y;return wy(wy({},e),{},{position:{x:a*r,y:s*r},offset:{x:l*r,y:c*r}})}})}}},{key:"printInfo",value:function(){}}]),e}();function ky(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ky(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ky(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Sy(e){var t=Cy();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function Cy(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(xy,"defaultStyle",{opacity:1,strokeStyle:"#FF0000",background:!0,fontColor:"#FFFFFF",fillStyle:"#FF0000",font:"normal 12px Arial",textAlign:"left",textBaseline:"bottom"}),a(xy,"defaultTextInfo",{text:"",position:{x:0,y:0},offset:{x:0,y:0}});var Py=function(e){Xv(r,e);var t=Sy(r);function r(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n(this,r),a(Nv(i=t.call(this,e,kd.Overlay,o,s)),"featureActionTexts",[]),a(Nv(i),"defaultActiveFeatureStyle",{strokeStyle:"#FF0000",fillStyle:"#FF0000",lineWidth:1}),a(Nv(i),"defaultTextStyle",{fillStyle:"#FFFFFF",strokeStyle:"#D2691E",background:!0,globalAlpha:1,fontColor:"#333",font:"normal 10px Arial",textBaseline:"top"}),i}return o(r,[{key:"addFeatureActionText",value:function(e,t){var n=(t||{}).clear;void 0!==n&&n&&this.removeAllFeatureActionText(),e.onAdd(this),this.featureActionTexts.push(e)}},{key:"addPointFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=t.active,a=void 0!==o&&o,s=new Kd("".concat(+new Date),e,{},n||this.map.drawingStyle,{active:a});this.addFeatureActionText(s,{clear:i})}},{key:"addLineFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=new Hd("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureActionText(o,{clear:i});var a=e,s=a.start,l=a.end;this.addDrawingPoints([s,l])}},{key:"addPolylineFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=new ty("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureActionText(o,{clear:i}),this.addDrawingPoints(e.points)}},{key:"addRectFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=new ay("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureActionText(o,{clear:i});var a=o.getPoints();this.addDrawingPoints(a)}},{key:"addPolygonFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,i=void 0===r||r,o=new cy("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureActionText(o,{clear:i}),this.addDrawingPoints(e.points)}},{key:"addCircleFeature",value:function(e,t){var n=t||{},r=n.clear,i=void 0===r||r,o=n.style,a=n.active,s=void 0!==a&&a,l=new fy("".concat(+new Date),e,{},o||this.map.drawingStyle,{active:s});this.addFeatureActionText(l,{clear:i})}},{key:"addDrawAction",value:function(e){var t=new gy("".concat(+new Date),"drawAction",e,{},this.map.drawingStyle);this.addFeatureActionText(t,{clear:!0})}},{key:"addText",value:function(e,t){var n=(t||{}).clear,r=void 0===n||n,i=new xy("".concat(+new Date),Oy(Oy({},e),{},{offset:{x:5,y:-5}}),{},this.defaultTextStyle);this.addFeatureActionText(i,{clear:r})}},{key:"addActiveFeature",value:function(e){if(e){var t=this.defaultActiveFeatureStyle,n=e.type,r=e.shape;switch(n){case Sd.Point:this.addPointFeature(r,{style:t,active:!0});break;case Sd.Line:this.addLineFeature(r,{style:t});break;case Sd.Polyline:this.addPolylineFeature(r,{style:t}),this.addActiveMiddlePoints(r.points,{withClose:!1});break;case Sd.Rect:this.addRectFeature(r,{style:t});break;case Sd.Polygon:this.addPolygonFeature(r,{style:t}),this.addActiveMiddlePoints(r.points,{withClose:!0});break;case Sd.Circle:this.addCircleFeature(r,{style:t,active:!0})}}else this.removeAllFeatureActionText()}},{key:"addActiveMiddlePoints",value:function(e){var t=this,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).withClose,r=void 0===n||n;Gi(e,(function(n,i){var o=r?e[i+1]||e[0]:e[i+1];if(o){var a=Ed.MathUtil.getMiddlePoint(n,o);t.addDrawingPoint(a,{strokeStyle:"#228B22",withAddIcon:!0,isMiddlePoint:!0})}}))}},{key:"addDrawingPoints",value:function(e){var t=this;Gi(e,(function(e){t.addDrawingPoint(e)}))}},{key:"addDrawingPoint",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.strokeStyle,o=void 0===i?"#666":i,a=r.fillStyle,s=void 0===a?"#fff":a,l=r.withAddIcon,c=void 0!==l&&l,u=r.iconColor,h=void 0===u?"#228B22":u,f=r.isMiddlePoint,v=void 0!==f&&f,p=e.x,d=e.y,y=null===(t=this.map)||void 0===t?void 0:t.slotsObServer[Sv.DrawActivePoint];if(v||!Ue(y)||!1!==y(e,this)){var m=null===(n=this.map)||void 0===n?void 0:n.slotsObServer[Sv.DrawActiveMiddlePoint];v&&Ue(m)&&!1===m(e,this)||(this.addCircleFeature({sr:3.5,cx:p,cy:d},{clear:!1,style:{strokeStyle:o,fillStyle:s,stroke:!0,fill:!0,lineWidth:1}}),c&&this.addCircleFeature({sr:1.25,cx:p,cy:d},{clear:!1,style:{fillStyle:h,stroke:!1,fill:!0}}))}}},{key:"removeAllFeatureActionText",value:function(){this.featureActionTexts=[],this.clear()}},{key:"refresh",value:function(){$v(Vv(r.prototype),"refresh",this).call(this),Gi(this.featureActionTexts,(function(e){return e.refresh()}))}}]),r}(pd),Ay=fv,Dy=tn,Fy=qr;function jy(e){return function(t,n,r){var i=Object(t);if(!Dy(t)){var o=Ay(n);t=Fy(t),n=function(e){return o(i[e],e,i)}}var a=e(t,n,r);return a>-1?i[o?t[a]:a]:void 0}}var Iy=jy,Ry=cp,Ty=fv,Ey=Np,My=Math.max;function _y(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:Ey(n);return i<0&&(i=My(r+i,0)),Ry(e,Ty(t),i)}var Ly=Iy(_y);function By(e){var t=zy();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function zy(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Wy=function(e){Xv(r,e);var t=By(r);function r(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n(this,r),a(Nv(i=t.call(this,e,kd.Marker,o,s)),"markers",[]),i}return o(r,[{key:"addMarker",value:function(e,t){e.onAdd(this),this.markers.push(e)}},{key:"removeMarkerById",value:function(e){var t=_v(this.markers,(function(t){return t.id!==e||(t.onRemove(),!1)}));this.markers=t,this.refresh()}},{key:"getMarkerById",value:function(e){return Ly(this.markers,(function(t){return t.id===e}))}},{key:"getAllMarkers",value:function(){return this.markers}},{key:"removeAllMarkers",value:function(){var e=_v(this.markers,(function(e){return e.onRemove(),!1}));this.markers=e,this.refresh()}},{key:"resize",value:function(){this.dom.style.width="0px",this.dom.style.height="0px"}},{key:"refresh",value:function(){$v(Vv(r.prototype),"refresh",this).call(this),Gi(this.markers,(function(e){return e.refresh()}))}}]),r}(hd),Uy=function(){function e(t,r){var i=this;n(this,e),a(this,"controls",[]),a(this,"layers",[]),a(this,"drawingStyle",{}),a(this,"drawingTip",!0),a(this,"editingColor","#FF0000"),a(this,"slotsObServer",{}),a(this,"activeFeature",null),a(this,"events",{on:function(e,t){i.eventsObServer.on(e,t)}}),a(this,"slots",{on:function(e,t){i.slotsObServer[e]=t}}),this.wrapperDomId=t,this.wrapperDom=document.getElementById(t),this.createMainDom(),this.mapOptions=ri({},e.defaultMapOptions,r),this.zoom=this.mapOptions.zoom,this.center=this.mapOptions.center,this.mode=this.mapOptions.mode,this.refreshDelayWhenZooming=this.mapOptions.refreshDelayWhenZooming,this.zoomWhenDrawing=this.mapOptions.zoomWhenDrawing,this.panWhenDrawing=this.mapOptions.panWhenDrawing,this.featureCaptureWhenMove=this.mapOptions.featureCaptureWhenMove,this.withHotKeys=this.mapOptions.withHotKeys,this.zoomWheelRatio=this.mapOptions.zoomWheelRatio,this.xAxis=this.mapOptions.xAxis,this.yAxis=this.mapOptions.yAxis,this.size=this.mapOptions.size||{width:Ma(this.dom,"clientWidth",0),height:Ma(this.dom,"clientHeight",0)},this.setDomStyle(),this.createSubDoms(),this.addOverlayLayer(),this.addTipLayer(),this.addCursorLayer(),this.addEventLayer(),this.addMarkerLayer(),this.eventsObServer=new I.EventEmitter,this.withHotKeys&&this.registerHotkey()}return o(e,[{key:"setDomStyle",value:function(){this.dom.ondragstart=function(e){e.preventDefault(),e.stopPropagation()},this.dom.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation()}}},{key:"setMode",value:function(e){this.mode=e,this.eventLayer.reset(),this.activeFeature&&this.eventsObServer.emit(Ov.FeatureUnselected,this.activeFeature,"cancel by switch mode")}},{key:"setDrawingStyle",value:function(e){this.drawingStyle=e}},{key:"setEditingColor",value:function(e){this.editingColor=e}},{key:"enableDrawingTip",value:function(){this.drawingTip=!0}},{key:"disableDrawingTip",value:function(){this.drawingTip=!1}},{key:"getSize",value:function(){return this.size}},{key:"getScale",value:function(e){var t=Wa(e)?e:this.zoom,n=1e6,r=this.getSize().width;return parseInt(r*n/t+"",10)/n}},{key:"setCenter",value:function(e){return this.center=e,this.refresh(),this.triggerBoundsChanged(),this}},{key:"getCenter",value:function(){return this.center}},{key:"getScreenCenter",value:function(){var e=this.getSize();return{x:e.width/2,y:e.height/2}}},{key:"getBounds",value:function(e){var t=this.getSize(),n=t.width,r=t.height,i=this.transformScreenToGlobal({x:0,y:0}),o=i.x,a=i.y,s=this.transformScreenToGlobal({x:n,y:r});return{x:o,y:a,width:s.x-o,height:a-s.y}}},{key:"enableZoomWhenDrawing",value:function(){this.zoomWhenDrawing=!0}},{key:"disableZoomWhenDrawing",value:function(){this.zoomWhenDrawing=!1}},{key:"enablePanWhenDrawing",value:function(){this.panWhenDrawing=!0}},{key:"disablePanWhenDrawing",value:function(){this.panWhenDrawing=!1}},{key:"enableFeatureCaptureWhenMove",value:function(){this.featureCaptureWhenMove=!0}},{key:"disableFeatureCaptureWhenMove",value:function(){this.featureCaptureWhenMove=!1}},{key:"enableHotKeys",value:function(){this.withHotKeys||(this.withHotKeys=!0,this.registerHotkey())}},{key:"disableHotKeys",value:function(){this.withHotKeys&&(this.withHotKeys=!1,this.unbindHotkey())}},{key:"centerAndZoom",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).refreshDelay,n=void 0!==t&&t,r=e.center,i=e.zoom;return r&&(this.center=r),Wa(i)&&(this.zoom=i),this.refresh(n&&this.refreshDelayWhenZooming),this.triggerBoundsChanged(),this}},{key:"zoomTo",value:function(e){this.zoom=e,this.refresh(),this.triggerBoundsChanged()}},{key:"zoomIn",value:function(){this.zoom=this.zoom/2,this.refresh(),this.triggerBoundsChanged()}},{key:"zoomOut",value:function(){this.zoom=2*this.zoom,this.refresh(),this.triggerBoundsChanged()}},{key:"setZoomWheelRatio",value:function(e){this.zoomWheelRatio=e}},{key:"addControl",value:function(e){e.onAdd(this),this.controls.push(e)}},{key:"removeControlById",value:function(e){var t=_v(this.controls,(function(t){return t.id!==e||(t.onRemove(),!1)}));this.controls=t}},{key:"addLayer",value:function(e){var t=e.dom;this.layerDom.appendChild(t),e.onAdd(this),this.layers.push(e)}},{key:"removeLayerById",value:function(e){var t=_v(this.layers,(function(t){return t.id!==e||(t.onRemove(),!1)}));this.layers=t,this.refresh()}},{key:"removeAllLayers",value:function(){var e=_v(this.layers,(function(e){return e.onRemove(),!1}));this.layers=e,this.refresh()}},{key:"getLayers",value:function(){return this.layers}},{key:"triggerBoundsChanged",value:function(){var e=this;this.boundsChangedTimer&&(window.clearTimeout(this.boundsChangedTimer),this.boundsChangedTimer=null),this.boundsChangedTimer=window.setTimeout((function(){e.eventsObServer.emit(Ov.BoundsChanged)}),666),this.overlayLayer.refresh()}},{key:"refresh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Gi(this.layers,(function(t){return t.refresh(e)})),this.markerLayer.refresh()}},{key:"resize",value:function(e){this.size=e||{width:Ma(this.dom,"clientWidth",0),height:Ma(this.dom,"clientHeight",0)},this.setLayerDomSize(),this.setPlatformDomSize(),Gi(this.layers,(function(e){return e.resizeAndRefresh()})),this.markerLayer.resizeAndRefresh(),this.overlayLayer.resizeAndRefresh(),this.tipLayer.resizeAndRefresh(),this.eventLayer.resizeAndRefresh()}},{key:"setActiveFeature",value:function(e){this.activeFeature=e,this.overlayLayer.addActiveFeature(e);var t=this.eventLayer.mouseMoveEvent;t&&this.eventLayer.onMouseMove(t)}},{key:"getActiveFeature",value:function(){return this.activeFeature}},{key:"removeDrawingPoints",value:function(){this.eventLayer.revokeTmpPointsStore()}},{key:"getTargetFeatureWithPoint",value:function(e){var t=this.getLayers(),n=[];return Gi(t,(function(t){if(t.type===kd.Feature){var r=t.getTargetFeatureWithPoint(e);if(r)return n.push(r),!1}})),Ma(n,"[0]",null)}},{key:"exportLayersToImage",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.layers,i=void 0===r?this.getLayers():r,o=n.type,a=void 0===o?"base64":o,s=n.format,l=void 0===s?"image/png":s,c=n.quality,h=void 0===c?1:c,f=i,v=new Ud(e),p=[];return Gi(f,function(){var n=t(u.mark((function t(n){var r,i,o,a,s,l;return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.type===kd.Feature?(r=n.getAllFeatures(),i=eh(r),v.addObjects(i),p.push(new Promise((function(e){e(!0)})))):n.type===kd.Text?(o=n.getAllTexts(),a=eh(o),v.addObjects(a),p.push(new Promise((function(e){e(!0)})))):n.type===kd.Mask?(s=n.getImageWithBounds(e),p.push(new Promise((function(e,t){var n=new Image;n.onload=function(){v.putImage(n),e(!0)},n.onerror=function(){t()},n.src=s})))):n.type===kd.Image&&(l=eh(n),v.addImageLayer(l),p.push(new Promise((function(e){e(!0)}))));case 1:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}()),new Promise((function(e,t){Promise.all(p).then((function(){v.convertCanvasToImage(a,l,h).then((function(t){v=null,e(t)})).catch((function(e){}))})).catch((function(e){}))}))}},{key:"transformScreenToGlobal",value:function(e,t){var n=t||{},r=n.basePoint,i=n.zoom,o=this.getScale(i),a=this.getScreenCenter(),s=a.x,l=a.y,c=e.x,u=e.y,h=Ma(r,"screen.x",s),f=Ma(r,"screen.y",l),v=Ma(r,"global",this.center),p=v.x,d=v.y,y=c-h,m=u-f;return{x:this.xAxis.direction===bv.Right?p+y/o:p-y/o,y:this.yAxis.direction===wv.Top?d-m/o:d+m/o}}},{key:"transformGlobalToScreen",value:function(e,t){var n=t||{},r=n.basePoint,i=n.zoom,o=this.getScale(i),a=this.getScreenCenter(),s=a.x,l=a.y,c=e.x,u=e.y,h=Ma(r,"screen.x",s),f=Ma(r,"screen.y",l),v=Ma(r,"global",this.center),p=c-v.x,d=u-v.y;return{x:this.xAxis.direction===bv.Right?h+p*o:h-p*o,y:this.yAxis.direction===wv.Top?f-d*o:f+d*o}}},{key:"createMainDom",value:function(){this.domId="main-wrapper-".concat(Ci()),this.dom=document.createElement("div"),this.dom.setAttribute("id",this.domId),this.dom.style.position="absolute",this.dom.style.left="0",this.dom.style.top="0",this.dom.style.right="0",this.dom.style.bottom="0",this.wrapperDom.appendChild(this.dom)}},{key:"createSubDoms",value:function(){this.setLayerDom(),this.setPlatformDom(),this.setLayerDom2(),this.setControlDom()}},{key:"setLayerDom",value:function(){this.layerDomId="layer-wrapper-".concat(Ci()),this.layerDom=document.createElement("div"),this.layerDom.setAttribute("id",this.layerDomId),this.layerDom.style.position="absolute",this.layerDom.style.left="0",this.layerDom.style.top="0",this.layerDom.style.zIndex="1",this.setLayerDomSize(),this.dom.appendChild(this.layerDom)}},{key:"setLayerDomSize",value:function(){var e=this.getSize(),t=e.width,n=e.height;this.layerDom.style.width="".concat(t,"px"),this.layerDom.style.height="".concat(n,"px")}},{key:"setPlatformDom",value:function(){this.platformDomId="platform-wrapper-".concat(Ci()),this.platformDom=document.createElement("div"),this.platformDom.setAttribute("id",this.platformDomId),this.platformDom.style.position="absolute",this.platformDom.style.left="0",this.platformDom.style.top="0",this.platformDom.style.zIndex="5",this.setPlatformDomSize(),this.dom.appendChild(this.platformDom)}},{key:"setPlatformDomSize",value:function(){var e=this.getSize(),t=e.width,n=e.height;this.platformDom.style.width="".concat(t,"px"),this.platformDom.style.height="".concat(n,"px")}},{key:"setLayerDom2",value:function(){this.layerDom2Id="layer2-wrapper-".concat(Ci()),this.layerDom2=document.createElement("div"),this.layerDom2.setAttribute("id",this.layerDom2Id),this.layerDom2.style.position="absolute",this.layerDom2.style.left="0",this.layerDom2.style.right="0",this.layerDom2.style.width="0",this.layerDom2.style.height="0",this.layerDom2.style.zIndex="10",this.dom.appendChild(this.layerDom2)}},{key:"setControlDom",value:function(){this.controlDomId="control-wrapper-".concat(Ci()),this.controlDom=document.createElement("div"),this.controlDom.setAttribute("id",this.controlDomId),this.controlDom.style.position="absolute",this.controlDom.style.left="0",this.controlDom.style.right="0",this.controlDom.style.width="0",this.controlDom.style.height="0",this.controlDom.style.zIndex="15",this.dom.appendChild(this.controlDom)}},{key:"addEventLayer",value:function(){this.eventLayer=new zd("event-".concat(Ci()),{},{zIndex:5}),this.platformDom.appendChild(this.eventLayer.dom),this.eventLayer.onAdd(this)}},{key:"addOverlayLayer",value:function(){this.overlayLayer=new Py("overlay-".concat(Ci()),{},{zIndex:1}),this.platformDom.appendChild(this.overlayLayer.dom),this.overlayLayer.onAdd(this)}},{key:"addTipLayer",value:function(){this.tipLayer=new Py("tip-".concat(Ci()),{},{zIndex:2}),this.platformDom.appendChild(this.tipLayer.dom),this.tipLayer.onAdd(this)}},{key:"addCursorLayer",value:function(){this.cursorLayer=new Py("cursor-".concat(Ci()),{},{zIndex:3}),this.platformDom.appendChild(this.cursorLayer.dom),this.cursorLayer.onAdd(this)}},{key:"addMarkerLayer",value:function(){this.markerLayer=new Wy("marker-".concat(Ci()),{},{zIndex:10}),this.layerDom2.appendChild(this.markerLayer.dom),this.markerLayer.onAdd(this)}},{key:"registerHotkey",value:function(){var e=this;oe("ctrl+z",(function(t,n){e.removeDrawingPoints()})),oe("up,down,left,right",(function(t,n){t.preventDefault(),t.stopPropagation();var r=e.getActiveFeature();r&&r.onMove(n.key)}))}},{key:"unbindHotkey",value:function(){oe.unbind("ctrl+z"),oe.unbind("up,down,left,right")}},{key:"setCursor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.cursorLayer.removeAllFeatureActionText(),this.platformDom.style.cursor=e,this.setCursorFeature(t),this}},{key:"setUrlCursor",value:function(e){return this}},{key:"setCursorFeature",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=e.shape;t===Sd.Circle&&this.cursorLayer.addCircleFeature(n,{style:{lineWidth:1,strokeStyle:"#aaa",fillStyle:"#ffffffb3",stroke:!0,fill:!0}})}},{key:"onDrag",value:function(e,t){this.layerDom.style.left="".concat(e,"px"),this.layerDom.style.top="".concat(t,"px"),this.layerDom2.style.left="".concat(e,"px"),this.layerDom2.style.top="".concat(t,"px")}},{key:"onZoom",value:function(e){this.dom.style.transform="scale(".concat(e,")")}},{key:"reset",value:function(){return this.layerDom.style.left="0",this.layerDom.style.top="0",this.layerDom2.style.left="0",this.layerDom2.style.top="0",this}},{key:"destroy",value:function(){this.dom.remove()}},{key:"printInfo",value:function(){}}]),e}();function Gy(e){var t=Ny();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function Ny(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(Uy,"defaultMapOptions",{center:{x:0,y:0},zoom:1e3,zoomWheelRatio:5,mode:kv.Pan,size:null,refreshDelayWhenZooming:!0,zoomWhenDrawing:!1,featureCaptureWhenMove:!1,withHotKeys:!0,panWhenDrawing:!1,xAxis:{direction:bv.Right},yAxis:{direction:wv.Bottom}});var Vy=function(e){Xv(r,e);var t=Gy(r);function r(e,i){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n(this,r),a(Nv(o=t.call(this,e,kd.Image,s,l)),"imageSuccess",!1),a(Nv(o),"events",{on:function(e,t){o.eventsObServer.on(e,t)}}),o.eventsObServer=new I.EventEmitter,o.imageInfo=ri({},r.defaultImageInfo,i),o.position=o.imageInfo.position,o.grid=o.imageInfo.grid,o}return o(r,[{key:"updateImageInfo",value:function(e){this.imageInfo=ri({},this.imageInfo,e),e.position&&(this.position=this.imageInfo.position),e.src&&this.updateImage(),this.refresh()}},{key:"updateImage",value:function(){var e=this;this.imageInfo.src&&(this.imageSuccess=!1,this.eventsObServer.emit(Od.LoadStart,this.imageInfo.src,this),this.image=new Image,this.imageInfo.crossOrigin?this.image.setAttribute("crossOrigin","anonymous"):this.image.removeAttribute("crossOrigin"),this.image.src=this.imageInfo.src,this.image.onload=function(){e.imageSuccess=!0,e.map&&e.refresh(),e.eventsObServer.emit(Od.LoadEnd,e.imageInfo.src,e)},this.image.onerror=function(){e.imageSuccess=!1,e.eventsObServer.emit(Od.LoadError,e.imageInfo.src,e)})}},{key:"updateGrid",value:function(e){this.grid=e,this.refresh()}},{key:"onAdd",value:function(e){$v(Vv(r.prototype),"onAdd",this).call(this,e),this.updateImage(),this.refresh()}},{key:"drawImage",value:function(){var e=this.map.transformGlobalToScreen(this.position),t=e.x,n=e.y,r=pd.dpr,i=this.map.getScale(),o=this.imageInfo,a=o.width*i,s=o.height*i;this.image&&this.imageSuccess&&md.drawImage(this.canvasContext,{image:this.image,x:t*r,y:n*r,width:a*r,height:s*r},{})}},{key:"drawGrid",value:function(){var e=this,t=this.imageInfo,n=t.width,r=t.height,i=this.position,o=i.x,a=i.y,s=pd.dpr,l=this.map.xAxis.direction===bv.Right,c=this.map.yAxis.direction===wv.Top,u=Ma(this.grid,"columns",[]),h=Ma(this.grid,"rows",[]),f=u.length,v=n/(f+1);Gi(u,(function(t,n){var i=t||{},u=i.color,h=void 0===u?"#333":u,f=i.width,p=void 0===f?1:f,d=(n+1)*v,y=l?o+d:o-d,m=a,g=c?a-r:a+r,b=e.map.transformGlobalToScreen({x:y,y:m}),w=e.map.transformGlobalToScreen({x:y,y:g});md.drawLine(e.canvasContext,{start:{x:b.x*s,y:b.y*s},end:{x:w.x*s,y:w.y*s}},{strokeStyle:h,lineWidth:p})}));var p=h.length,d=r/(p+1);Gi(h,(function(t,r){var i=t||{},u=i.color,h=void 0===u?"#333":u,f=i.width,v=void 0===f?1:f,p=(r+1)*d,y=c?a-p:a+p,m=o,g=l?o+n:o-n,b=e.map.transformGlobalToScreen({x:m,y:y}),w=e.map.transformGlobalToScreen({x:g,y:y});md.drawLine(e.canvasContext,{start:{x:b.x*s,y:b.y*s},end:{x:w.x*s,y:w.y*s}},{strokeStyle:h,lineWidth:v})}))}},{key:"refresh",value:function(){$v(Vv(r.prototype),"refresh",this).call(this),this.drawImage(),this.drawGrid()}}]),r}(pd);function Ky(e){var t=$y();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function $y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}a(Vy,"defaultImageInfo",{src:"",width:0,height:0,position:{x:0,y:0},crossOrigin:!1,grid:{columns:[],rows:[]}});var Yy=function(e){Xv(r,e);var t=Ky(r);function r(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n(this,r),a(Nv(i=t.call(this,e,kd.Feature,o,s)),"features",[]),i}return o(r,[{key:"addFeature",value:function(e,t){var n=(t||{}).clear;void 0!==n&&n&&(this.features=[],this.clear()),e.onAdd(this),this.features.push(e)}},{key:"removeFeatureById",value:function(e){var t=_v(this.features,(function(t){return t.id!==e||(t.onRemove(),!1)}));this.features=t,this.refresh()}},{key:"getFeatureById",value:function(e){return Ly(this.features,(function(t){return t.id===e}))}},{key:"getAllFeatures",value:function(){return this.features}},{key:"removeAllFeatures",value:function(){var e=_v(this.features,(function(e){return e.onRemove(),!1}));this.features=e,this.refresh()}},{key:"getTargetFeatureWithPoint",value:function(e){var t=[];return Gi(this.features,(function(n){if(n.captureWithPoint(e))return t.push(n),!1})),Ma(t,"[0]",null)}},{key:"refresh",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.refreshDelayTimer&&(window.clearTimeout(this.refreshDelayTimer),this.refreshDelayTimer=null),$v(Vv(r.prototype),"refresh",this).call(this),t?this.refreshDelayTimer=window.setTimeout((function(){Gi(e.features,(function(e){return e.refresh()}))}),100):Gi(this.features,(function(e){return e.refresh()}))}}]),r}(pd),Xy=yp;function qy(e,t){return!(null==e||!e.length)&&Xy(e,t,0)>-1}var Hy=qy;function Zy(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}var Jy=Zy;function Qy(){}var em=vl,tm=Qy,nm=Sh,rm=1/0,im=em&&1/nm(new em([,-0]))[1]==rm?function(e){return new em(e)}:tm,om=hh,am=Hy,sm=Jy,lm=ph,cm=im,um=Sh,hm=200;function fm(e,t,n){var r=-1,i=am,o=e.length,a=!0,s=[],l=s;if(n)a=!1,i=sm;else if(o>=hm){var c=t?null:cm(e);if(c)return um(c);a=!1,i=lm,l=new om}else l=t?[]:s;e:for(;++r<o;){var u=e[r],h=t?t(u):u;if(u=n||0!==u?u:0,a&&h==h){for(var f=l.length;f--;)if(l[f]===h)continue e;t&&l.push(h),s.push(u)}else i(l,h,n)||(l!==s&&l.push(h),s.push(u))}return s}var vm=fm;function pm(e){return e&&e.length?vm(e):[]}var dm=pm,ym=function(){function e(t){n(this,e),a(this,"actions",[]),a(this,"map",{getScale:function(){return 1},transformGlobalToScreen:function(e){var t=e.x,n=e.y,r=this.bounds;return{x:t-r.x,y:n-r.y}}}),this.bounds=t,this.createRenderCanvas(),this.map.getScale=this.map.getScale.bind(this),this.map.transformGlobalToScreen=this.map.transformGlobalToScreen.bind(this)}return o(e,[{key:"createRenderCanvas",value:function(){var e=this.bounds,t=e.width,n=e.height;this.canvas=new OffscreenCanvas(t,n),this.canvas.width=t*pd.dpr,this.canvas.height=n*pd.dpr,this.canvasContext=this.canvas.getContext("2d")}},{key:"addAction",value:function(e){e.setStyle({strokeStyle:"#ff0000",fillStyle:"#ff0000"},{refresh:!1}),e.onAdd(this),this.actions.push(e)}},{key:"addActions",value:function(e){var t=this;Gi(e,(function(e){return t.addAction(e)}))}},{key:"getRle",value:function(){for(var e=[],t=pd.dpr,n=this.bounds,r=n.width,i=n.height,o=this.canvas,a=o.width,s=o.height,l=this.canvasContext.getImageData(0,0,a,s).data,c=0,u=1,h=0;h<i;h++)for(var f=0;f<r;f++){var v=4*(h*t*r+f)*t,p=l[v],d=l[v+1],y=l[v+2],m=l[v+3],g=+!!(p||d||y||m);g===u?c++:(e.push(c),c=1),h+1===i&&f+1===r&&e.push(c),u=g}return e}},{key:"refresh",value:function(){Gi(this.actions,(function(e){return e.refresh()}))}},{key:"clear",value:function(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)}}]),e}();function mm(e){var t=gm();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function gm(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var bm=function(e){Xv(r,e);var t=mm(r);function r(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n(this,r),a(Nv(i=t.call(this,e,kd.Mask,o,s)),"actions",[]),i}return o(r,[{key:"addAction",value:function(e,t){e.onAdd(this),this.actions.push(e)}},{key:"removeActionById",value:function(e){var t=_v(this.actions,(function(t){return t.id!==e||(t.onRemove(),!1)}));this.actions=t,this.refresh()}},{key:"getAllActions",value:function(){return this.actions}},{key:"removeAllActions",value:function(){var e=_v(this.actions,(function(e){return e.onRemove(),!1}));this.actions=e,this.refresh()}},{key:"setMovingClearAction",value:function(e){e&&e.onAdd(this),!e&&this.refresh()}},{key:"getActionCategories",value:function(){var e=this.actions,t=op(e,(function(e){return e.category}));return _v(dm(t),(function(e){return!!e}))}},{key:"groupByCategory",value:function(){var e=this.actions,t=this.getActionCategories(),n=[];return Gi(t,(function(t){var r=_v(e,(function(e){var n=e.type;return e.category===t||n===nd.Clear}));n.push({category:t,actions:r})})),n}},{key:"getGroupRleData",value:function(e,t){var n=e.category,r=e.actions,i=void 0===r?[]:r,o=new ym(t),a=eh(i);return o.addActions(a),{category:n,rle:o.getRle()}}},{key:"getImageData",value:function(e){var t=e.x,n=e.y,r=e.width,i=e.height,o=this.map.transformGlobalToScreen({x:t,y:n}),a=this.map.getScale(),s=o.x*pd.dpr,l=o.y*pd.dpr,c=r/a*pd.dpr,u=i/a*pd.dpr;return this.canvasContext.getImageData(s,l,c,u)}},{key:"getImageWithBounds",value:function(e){var t=e.width,n=e.height,r=this.getImageData(e),i=document.createElement("canvas");return i.width=t*pd.dpr,i.height=n*pd.dpr,i.style.width=t+"px",i.style.height=n+"px",i.getContext("2d").putImageData(r,0,0),i.toDataURL("image/png",1)}},{key:"getRleData",value:function(e){var t=this,n=this.groupByCategory(),r=[];return Gi(n,(function(n){var i=t.getGroupRleData(n,e);r.push(i)})),r}},{key:"refresh",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.refreshDelayTimer&&(window.clearTimeout(this.refreshDelayTimer),this.refreshDelayTimer=null),$v(Vv(r.prototype),"refresh",this).call(this),t?this.refreshDelayTimer=window.setTimeout((function(){Gi(e.actions,(function(e){return e.refresh()}))}),100):Gi(this.actions,(function(e){return e.refresh()}))}}]),r}(pd);function wm(e){var t=xm();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function xm(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var km=function(e){Xv(r,e);var t=wm(r);function r(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n(this,r),a(Nv(i=t.call(this,e,kd.Text,o,s)),"texts",[]),i}return o(r,[{key:"addText",value:function(e,t){var n=(t||{}).clear;void 0!==n&&n&&this.clear(),e.onAdd(this),this.texts.push(e)}},{key:"removeTextById",value:function(e){var t=_v(this.texts,(function(t){return t.id!==e||(t.onRemove(),!1)}));this.texts=t,this.refresh()}},{key:"getTextById",value:function(e){return Ly(this.texts,(function(t){return t.id===e}))}},{key:"getAllTexts",value:function(){return this.texts}},{key:"removeAllTexts",value:function(){var e=_v(this.texts,(function(e){return e.onRemove(),!1}));this.texts=e,this.refresh()}},{key:"refresh",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.refreshDelayTimer&&(window.clearTimeout(this.refreshDelayTimer),this.refreshDelayTimer=null),$v(Vv(r.prototype),"refresh",this).call(this),t?this.refreshDelayTimer=window.setTimeout((function(){Gi(e.texts,(function(e){return e.refresh()}))}),100):Gi(this.texts,(function(e){return e.refresh()}))}}]),r}(pd),Om={Text:km,Mask:bm,Image:Vy,Feature:Yy,OverlayLayer:Py,EventLayer:zd};function Sm(e){var t=Cm();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function Cm(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Pm=function(e){Xv(r,e);var t=Sm(r);function r(e,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n(this,r),(o=t.call(this,e,Sd.Arrow,a,s)).shape=i,o}return o(r,[{key:"captureWithPoint",value:function(e){return!1}},{key:"refresh",value:function(){var e;null!==(e=this.layer)&&void 0!==e&&e.map}}]),r}(Gd),Am={Base:Gd,Point:Kd,Circle:fy,Line:Hd,Polyline:ty,Rect:ay,Polygon:cy,Arrow:Pm};function Dm(e){var t=Fm();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function Fm(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var jm=function(e){Xv(r,e);var t=Dm(r);function r(e,i,o){var s,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return n(this,r),a(Nv(s=t.call(this,e,nd.Image,l,c)),"category",""),s.imageInfo=ri({},r.defaultImageInfo,o),s.position=s.imageInfo.position,s.updateImage(),s.category=i,s}return o(r,[{key:"updateImage",value:function(){var e=this;this.imageInfo.src&&(this.image=new Image,this.imageInfo.crossOrigin?this.image.setAttribute("crossOrigin","anonymous"):this.image.removeAttribute("crossOrigin"),this.image.src=this.imageInfo.src,this.image.onload=function(){return e.layer&&e.refresh()})}},{key:"drawImage",value:function(){var e;if(null!==(e=this.layer)&&void 0!==e&&e.map){var t=this.layer.map.transformGlobalToScreen(this.position),n=t.x,r=t.y,i=pd.dpr,o=this.layer.map.getScale(),a=this.imageInfo,s=a.width*o,l=a.height*o;md.drawImage(this.layer.canvasContext,{image:this.image,x:n*i,y:r*i,width:s*i,height:l*i},{})}}},{key:"refresh",value:function(){$v(Vv(r.prototype),"refresh",this).call(this),this.drawImage()}}]),r}(od);a(jm,"defaultImageInfo",{src:"",width:0,height:0,crossOrigin:!1,position:{x:0,y:0}});var Im={Draw:gy,Clear:jd,Image:jm},Rm=function(){function e(t,r,i,o){n(this,e),this.id=t,this.type=r,this.props=i||{},this.option=o||{},this.domId="control-grid-".concat(t,"-wrapper"),this.createContainer()}return o(e,[{key:"createContainer",value:function(){this.dom||(this.dom=document.createElement("div"),this.dom.setAttribute("id",this.domId),this.dom.style.position="absolute",this.dom.style.left="0",this.dom.style.top="0",this.dom.style.zIndex="20")}},{key:"onAdd",value:function(e){this.map=e,this.map.dom.appendChild(this.dom)}},{key:"onRemove",value:function(){var e=document.getElementById(this.domId);e&&e.remove()}},{key:"updatePosition",value:function(e){this.position=e,this.refresh()}},{key:"refresh",value:function(){}},{key:"printInfo",value:function(){}}]),e}();function Tm(e){var t=Em();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function Em(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Mm,_m,Lm=function(e){Xv(r,e);var t=Tm(r);function r(){return n(this,r),t.call(this)}return o(r,[{key:"refresh",value:function(){}}]),r}(Rm);function Bm(e){var t=zm();return function(){var n,r=Vv(e);if(t){var i=Vv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hv(this,n)}}function zm(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(_m=Mm||(Mm={})).Scale="SCALE",_m.Grid="GRID";var Wm=function(e){Xv(r,e);var t=Bm(r);function r(e,i,o,a){var s;return n(this,r),(s=t.call(this,e,Mm.Grid,o,a)).gridInfo=ri({},r.defaultGridInfo,i),s.creatCanvasElement(),s.refreshElement(),s}return o(r,[{key:"refreshElement",value:function(){this.setContainerSize(),this.setContainerPosition(),this.setContainerStyle(),this.setRenderCanvasSize()}},{key:"setContainerSize",value:function(){var e=this.gridInfo.size,t=e.width,n=e.height;this.dom.style.width=t+"px",this.dom.style.height=n+"px"}},{key:"setContainerPosition",value:function(){var e=this.gridInfo.position,t=e.left,n=e.top,r=e.right,i=e.bottom;this.dom.style.left=Wa(t)?"".concat(t,"px"):"initial",this.dom.style.right=Wa(r)?"".concat(r,"px"):"initial",this.dom.style.top=Wa(n)?"".concat(n,"px"):"initial",this.dom.style.bottom=Wa(i)?"".concat(i,"px"):"initial"}},{key:"setContainerStyle",value:function(){this.dom.style.border="1px solid red"}},{key:"creatCanvasElement",value:function(){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.dom.appendChild(this.canvas),this.canvasContext=this.canvas.getContext("2d")}},{key:"setRenderCanvasSize",value:function(){var e=this.gridInfo.size,t=e.width,n=e.height;this.canvas.width=t*pd.dpr,this.canvas.height=n*pd.dpr,this.canvas.style.width=t+"px",this.canvas.style.height=n+"px"}},{key:"refresh",value:function(){}}]),r}(Rm);a(Wm,"defaultGridInfo",{position:{right:10,bottom:10},size:{width:200,height:200},grid:{columns:[],rows:[]}});var Um={Scale:Lm,Grid:Wm};function Gm(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Nm(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gm(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gm(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Vm=function(){function e(t,r){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n(this,e),a(this,"dragging",!1),a(this,"draggingEnabled",!1),a(this,"events",{on:function(e,t){i.eventsObServer.on(e,t)}}),this.id=t,this.type=Id.Marker,this.props=o,this.markerInfo=ri({},e.defaultMarkerInfo,r),this.updateImage(),this.eventsObServer=new I.EventEmitter}return o(e,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){var e=document.getElementById(this.id);e&&e.remove()}},{key:"enableDragging",value:function(){this.draggingEnabled=!0,this.dragging=!1}},{key:"disableDragging",value:function(){this.draggingEnabled=!1,this.dragging=!1}},{key:"updateImage",value:function(){var e=this;this.markerInfo.src&&(this.image=new Image,this.image.id=this.id,this.image.setAttribute("data-type",this.type),this.image.style.position="absolute",this.image.style.cursor="pointer",this.image.style.userSelect="none",this.image.src=this.markerInfo.src,this.image.onload=function(){var t,n;null===(t=e.layer)||void 0===t||null===(n=t.dom)||void 0===n||n.appendChild(e.image),e.attachEvents()},this.image.onerror=function(){})}},{key:"updatePosition",value:function(e){var t=this.markerInfo;this.markerInfo=Nm(Nm({},t),{},{position:e}),this.refresh()}},{key:"handleMouseDown",value:function(e){var t=this,n=e.screenX,r=e.screenY;this.startPageScreenPoint={x:n,y:r},this.toUpdatePosition=null;var i=Ed.EventUtil.getButtonIndex(e);this.eventsObServer.emit(Rd.MouseDown,this),2===i&&this.eventsObServer.emit(Rd.RightClick,this),this.draggingEnabled&&(this.dragging=!0,document.onmousemove=function(e){return t.handleMarkerMove(e)},document.onmouseup=function(e){return t.handleMarkerUp(e)},this.eventsObServer.emit(Rd.DragStart,this))}},{key:"handleMarkerMove",value:function(e){var t=this.layer.map.getScale(),n=e.screenX,r=e.screenY,i=this.startPageScreenPoint,o=(n-i.x)/t,a=(r-i.y)/t,s=this.layer.map.xAxis.direction===bv.Right?o:-o,l=this.layer.map.yAxis.direction===wv.Top?a:-a,c=this.markerInfo.position;this.toUpdatePosition={x:c.x+s,y:c.y-l},this.refresh(this.toUpdatePosition),this.eventsObServer.emit(Rd.Dragging,this,this.toUpdatePosition)}},{key:"handleMarkerUp",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null,this.toUpdatePosition&&(this.refresh(),this.eventsObServer.emit(Rd.DragEnd,this,this.toUpdatePosition)),this.toUpdatePosition=null}},{key:"handleMouseUp",value:function(e){this.eventsObServer.emit(Rd.MouseUp,this)}},{key:"handleMouseOver",value:function(e){var t,n;this.layer.map.eventLayer.breakFeatureCapture=!0,null===(t=this.layer)||void 0===t||null===(n=t.map)||void 0===n||n.tipLayer.removeAllFeatureActionText(),this.eventsObServer.emit(Rd.MouseOver,this)}},{key:"handleMouseOut",value:function(e){this.eventsObServer.emit(Rd.MouseOut,this)}},{key:"handleClick",value:function(e){this.eventsObServer.emit(Rd.Click,this)}},{key:"attachEvents",value:function(){var e=this;this.image.onmousedown=function(t){return e.handleMouseDown(t)},this.image.onmouseup=function(t){return e.handleMouseUp(t)},this.image.onmouseover=function(t){return e.handleMouseOver(t)},this.image.onmouseout=function(t){return e.handleMouseOut(t)},this.image.onclick=function(t){return e.handleClick(t)}}},{key:"refresh",value:function(e){var t=this.markerInfo,n=t.position,r=t.offset,i=e||n,o=this.layer.map.transformGlobalToScreen(i),a=o.x,s=o.y,l=a+r.x,c=s-r.y;this.image.style.left="".concat(l,"px"),this.image.style.top="".concat(c,"px")}},{key:"printInfo",value:function(){}}]),e}();return a(Vm,"defaultMarkerInfo",{src:"",position:{x:0,y:0},offset:{x:0,y:0}}),{Map:Uy,Layer:Om,Feature:Am,Mask:Im,Control:Um,Text:xy,Marker:Vm,Util:Ed,version:"5.1.7"}}();const _=a((function(){const{cameraFns:e}=T.serviceDiscovery(),{fnOptions:t,notify:n,cameras:i,cameraImage:a,currentActiveCameraFn:l,setCurrentActiveCameraFn:c,currentActiveCameraFnEntity:u,setCurrentActiveCameraFnEntity:h,currentActiveCamera:f,currentActiveCameraEntity:v,getCurrentActiveCameraEntityValue:p,setCameraFnImage:y,requestCameraFnImage:m,handleUpdate:g}=x.serviceDiscovery(),b="-@-",w={searchCameraFn:t=>e.value.find((e=>e.name===t)),removeCameraFn:t=>e.value.splice(w.searchCameraFnPosition(t),1),createCameraFn:t=>{e.value.push(t);i.value.find((e=>e.name===v.value.name)).functions=e.value},searchCameraFnPosition:t=>e.value.findIndex((e=>e.name===t))},[k,O]=s("INIT");r(n,m),r(f,(()=>O("INIT"))),r(e,(e=>{if(!Boolean(e.length))return y(null);switch(k.value){case"INIT":const t=e[0];c(`${p("name")}-@-${t.name}`);break;case"CREATE":const n=e[e.length-1];c(`${p("name")}-@-${n.name}`)}}),{deep:!0}),r(l,(e=>{const[,t]=e.split(b),n=w.searchCameraFn(t);if(n&&(h(n),"TOGGLE"===k.value))m()}));const[S,C]=s({}),[P,A]=s(""),[D,F]=s(!1);r(t,(e=>{if(!Boolean(e.length))return;const[t]=e;C(t),A(t.name)})),r(P,(e=>{const n=t.value.find((t=>t.name===e));n&&C(n)}));const[j,I]=s([]),[R,E]=s(!1),_=()=>{u.value.parameters.points=j.value,E(!1),m(),g()};let L,B,z;return r(R,(e=>{if(e){if(L=new M.Map("map",{mode:"PAN",center:{x:d.width/2,y:d.height/2},withHotKeys:!0,panWhenDrawing:!0,zoomWheelRatio:5,zoomWhenDrawing:!0,refreshDelayWhenZooming:!0}),B=new M.Layer.Image("layer-image",{src:a.value,grid:{rows:[{color:"#9370DB"},{color:"#FF6347"}],columns:[{color:"#9370DB"},{color:"#FF6347"}]},width:d.width,height:d.height,position:{x:0,y:0},crossOrigin:!0},{name:"图片图层"}),z=new M.Layer.Feature("layer-feature",{name:"矢量图层"}),L.events.on("drawDone",((e,t)=>{const n=t.map((({x:e,y:t})=>[e,t]));I(n);const r=new M.Feature.Polygon(""+ +new Date,{points:t},{name:"矢量图形"},{strokeStyle:"#00f",fillStyle:"#0f0",globalAlpha:.3,lineWidth:1,fill:!0,stroke:!0});z.addFeature(r),_()})),u.value.parameters.points){const e=u.value.parameters.points.map((([e,t])=>({x:e,y:t}))),t=new M.Feature.Polygon(""+ +new Date,{points:e},{name:"矢量图形"},{strokeStyle:"#00f",fillStyle:"#0f0",globalAlpha:.3,lineWidth:1,fill:!0,stroke:!0});setTimeout((()=>z.addFeature(t)))}L.addLayer(B),L.addLayer(z)}else L.destroy()}),{flush:"post"}),{separator:b,selectFn:S,selectFnName:P,selectFnVisible:D,setSelectFnVisible:F,handleCreateFn:()=>{O("CREATE");const{name:e,parameters:t}=S.value;if(~w.searchCameraFnPosition(e))return o("error","该功能组件已添加 ~");const n={};t.forEach((e=>{"list"===e.type?n.points=e.default:n[e.name]=e.default})),w.createCameraFn({name:e,parameters:n}),g()},handleRemoveFn:t=>{O("REMOVE");const[n,r]=t.split(b);l.value===t&&e.value.forEach(((t,i)=>{if(t.name===r){const t=e.value[i+1]||e.value[i-1];t&&c(`${n}-@-${t.name}`)}})),w.removeCameraFn(r)},handlePointInput:(e,t,n,r)=>{isFinite(n)&&r(e,t,n)},handleTabBeforeLeave:()=>O("TOGGLE"),setMode:e=>L.setMode(e),handleReset:()=>{I([]),_()},handleSetPoints:_,currentFnImageVisible:R,setCurrentFnImageVisible:E}})),L={};L.props={name:{key:"name",required:!0,type:String}},L.setup=(e,t)=>{const n=e,{cameraFns:r,hasCameraFn:i}=T.serviceDiscovery(),{separator:o,setSelectFnVisible:a,setCurrentFnImageVisible:s,handleRemoveFn:l,handlePointInput:c,handleTabBeforeLeave:u}=_.serviceDiscovery(),{loading:h,hasFnOption:f,getFnDisplayName:v,cameraImage:p,requestCameraFnImage:d,currentActiveCameraFn:y,currentActiveCameraFnEntity:m}=x.serviceDiscovery();return{props:n,cameraFns:r,hasCameraFn:i,separator:o,setSelectFnVisible:a,setCurrentFnImageVisible:s,handleRemoveFn:l,handlePointInput:c,handleTabBeforeLeave:u,loading:h,hasFnOption:f,getFnDisplayName:v,cameraImage:p,requestCameraFnImage:d,currentActiveCameraFn:y,currentActiveCameraFnEntity:m}};const B={};var z=y(L,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{"margin-top":"16px"}},[n("el-card",{attrs:{shadow:"never"},scopedSlots:e._u([{key:"header",fn:function(){return[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[e._v("AI 功能配置")]),n("el-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:function(t){return e.setSelectFnVisible(!0)}}},[n("span",[e._v("添加功能组件")])])],1)]},proxy:!0}])},[e.hasCameraFn?e.hasFnOption?[n("el-tabs",{staticClass:"fn",attrs:{closable:"",type:"card","tab-position":"left","before-leave":e.handleTabBeforeLeave},on:{"tab-remove":e.handleRemoveFn},model:{value:e.currentActiveCameraFn,callback:function(t){e.currentActiveCameraFn=t},expression:"currentActiveCameraFn"}},e._l(e.cameraFns,(function(t){return n("el-tab-pane",{key:""+e.props.name+e.separator+t.name,attrs:{name:""+e.props.name+e.separator+t.name,label:e.getFnDisplayName(t.name)}},[e.currentActiveCameraFnEntity.parameters?n("el-form",{attrs:{"label-position":"top"}},[n("el-row",[n("el-col",{attrs:{span:8}},[e.currentActiveCameraFnEntity.parameters.num_threshold?n("el-form-item",{attrs:{label:"人数阈值"}},[n("el-input-number",{attrs:{min:0},model:{value:e.currentActiveCameraFnEntity.parameters.num_threshold,callback:function(t){e.$set(e.currentActiveCameraFnEntity.parameters,"num_threshold",t)},expression:"currentActiveCameraFnEntity.parameters.num_threshold"}})],1):e._e(),n("el-form-item",{attrs:{label:"最小像素阈值"}},[n("el-input-number",{attrs:{min:0},model:{value:e.currentActiveCameraFnEntity.parameters.tiny_threshold,callback:function(t){e.$set(e.currentActiveCameraFnEntity.parameters,"tiny_threshold",t)},expression:"currentActiveCameraFnEntity.parameters.tiny_threshold"}})],1),n("el-form-item",{attrs:{label:"连续性阀值"}},[n("el-input-number",{attrs:{min:0},model:{value:e.currentActiveCameraFnEntity.parameters.contiguous_threshold,callback:function(t){e.$set(e.currentActiveCameraFnEntity.parameters,"contiguous_threshold",t)},expression:"currentActiveCameraFnEntity.parameters.contiguous_threshold"}})],1),n("el-form-item",{attrs:{label:"间隔时间阈值"}},[n("el-input-number",{attrs:{min:0},model:{value:e.currentActiveCameraFnEntity.parameters.interval_seconds,callback:function(t){e.$set(e.currentActiveCameraFnEntity.parameters,"interval_seconds",t)},expression:"currentActiveCameraFnEntity.parameters.interval_seconds"}})],1)],1),n("el-col",{attrs:{span:16}},[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[e._v("有效分析区域")]),n("div",[n("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-edit",loading:e.loading,disabled:!e.cameraImage},on:{click:function(t){return e.setCurrentFnImageVisible(!0)}}},[n("span",[e._v("划线")])]),n("el-button",{staticStyle:{"margin-left":"16px"},attrs:{size:"mini",type:"primary",icon:"el-icon-refresh",loading:e.loading},on:{click:e.requestCameraFnImage}},[n("span",[e._v("刷新图片")])])],1)]),e.currentActiveCameraFnEntity.parameters?e._l(e.currentActiveCameraFnEntity.parameters.points,(function(t,r){return n("el-row",{key:r,staticClass:"point",staticStyle:{"margin-top":"16px"},attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("el-col",{attrs:{span:4}},[n("el-tag",{attrs:{effect:"dark"}},[e._v(e._s("点 "+(r+1)))])],1),n("el-col",{staticStyle:{"padding-right":"8px"},attrs:{span:10}},[n("el-tooltip",{attrs:{placement:"top","open-delay":300,content:"X 坐标："+t[0]}},[n("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",value:t[0]},on:{input:function(n){return e.handlePointInput(t,0,n,e.$set)}}})],1)],1),n("el-col",{staticStyle:{"padding-left":"8px"},attrs:{span:10}},[n("el-tooltip",{attrs:{placement:"top","open-delay":300,content:"Y 坐标："+t[1]}},[n("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",value:t[1]},on:{input:function(n){return e.handlePointInput(t,1,n,e.$set)}}})],1)],1)],1)})):e._e()],2)],1)],1):e._e()],1)})),1)]:n("el-empty",{attrs:{description:"功能组件列表初始化失败，请刷新重新获取数据"}}):n("el-empty",{attrs:{description:"暂无功能组件，请点击上方按钮进行添加"}})],2)],1)}),[],!1,W,null,null,null);function W(e){for(let t in B)this[t]=B[t]}var U=function(){return z.exports}();const G={setup:(e,t)=>{const{selectFn:n,selectFnName:r,selectFnVisible:i,currentFnImageVisible:o,setCurrentFnImageVisible:a,setMode:s,handleReset:l,handleCreateFn:c,handleSetPoints:u}=_.serviceRegister(),{handleCreateCamera:h,handleRemoveCamera:f,handleCameraUrlInput:v,handleTabBeforeLeave:p}=T.serviceDiscovery(),{loading:d,cameras:y,hasCamera:m,fnOptions:g,currentActiveCamera:b,currentActiveCameraEntity:w,cameraImage:k,cameraFnImage:O,requestCameraImage:S}=x.serviceDiscovery();return{selectFn:n,selectFnName:r,selectFnVisible:i,currentFnImageVisible:o,setCurrentFnImageVisible:a,setMode:s,handleReset:l,handleCreateFn:c,handleSetPoints:u,handleCreateCamera:h,handleRemoveCamera:f,handleCameraUrlInput:v,handleTabBeforeLeave:p,loading:d,cameras:y,hasCamera:m,fnOptions:g,currentActiveCamera:b,currentActiveCameraEntity:w,cameraImage:k,cameraFnImage:O,requestCameraImage:S}}};G.components=Object.assign({CameraFn:U},G.components);const N={};var V=y(G,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-divider",[n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreateCamera}},[e._v("添加摄像头")])],1),e.hasCamera?[n("el-tabs",{attrs:{closable:"",type:"card","before-leave":e.handleTabBeforeLeave},on:{"tab-remove":e.handleRemoveCamera},model:{value:e.currentActiveCamera,callback:function(t){e.currentActiveCamera=t},expression:"currentActiveCamera"}},e._l(e.cameras,(function(t){return n("el-tab-pane",{key:t.name,attrs:{name:t.name,label:t.name}},[n("el-row",{attrs:{type:"flex"}},[n("el-col",{attrs:{span:18}},[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("el-tooltip",{attrs:{content:"推流地址",placement:"top"}},[n("el-input",{staticStyle:{width:"100%"},attrs:{value:e.currentActiveCameraEntity.url},on:{input:e.handleCameraUrlInput}})],1),n("el-button",{staticStyle:{"margin-left":"16px"},attrs:{size:"small",type:"primary",icon:"el-icon-refresh",loading:e.loading},on:{click:e.requestCameraImage}},[n("span",[e._v("刷新图片")])])],1),n("CameraFn",{attrs:{name:t.name}})],1),n("el-col",{attrs:{span:5,offset:1}},[n("el-row",{staticStyle:{height:"100%","flex-direction":"column"},attrs:{type:"flex"}},[n("div",[e.cameraImage?n("el-image",{staticStyle:{width:"100%"},attrs:{src:e.cameraImage,"preview-src-list":[e.cameraImage]}}):n("el-empty",{attrs:{description:"无法加载预览图片，请检查推流地址是否填写或填写正确"}})],1),n("el-divider"),n("div",[e.loading?n("el-empty",{attrs:{description:"请等待摄像头图片加载完成 ..."}}):e.cameraImage?e.cameraImage&&!e.cameraFnImage?n("el-empty",{attrs:{description:"无法加载多边形区域预览图片，请检查点位是否拾取或拾取正确 ..."}}):[n("el-image",{staticStyle:{width:"100%"},attrs:{src:e.cameraFnImage,"preview-src-list":[e.cameraFnImage]}})]:n("el-empty",{attrs:{description:"请先加载摄像头图片"}})],2)],1)],1)],1)],1)})),1)]:n("el-empty",{attrs:{description:"暂无摄像头配置，请点击上方按钮进行添加"}}),n("el-drawer",{attrs:{"append-to-body":"",size:"100%","custom-class":"select-point","show-close":!1,visible:e.currentFnImageVisible},on:{"update:visible":function(t){e.currentFnImageVisible=t}},scopedSlots:e._u([{key:"title",fn:function(){return[n("el-row",{staticStyle:{"z-index":"999"},attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[n("i",{staticClass:"m-r-8 el-icon-view"}),n("span",[e._v("划分区域")])]),n("div",[n("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-close"},on:{click:function(t){return e.setCurrentFnImageVisible(!1)}}},[e._v("取消")]),n("el-button",{attrs:{size:"small",icon:"el-icon-rank"},on:{click:function(t){return e.setMode("PAN")}}},[e._v("拖动")]),n("el-button",{attrs:{size:"small",type:"info",icon:"el-icon-refresh-left"},on:{click:e.handleReset}},[e._v("重置")]),n("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-edit"},on:{click:function(t){return e.setMode("POLYGON")}}},[e._v("划线")]),n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-check"},on:{click:e.handleSetPoints}},[e._v("确定")])],1)])]},proxy:!0}])},[n("div",{staticStyle:{height:"100%"},attrs:{id:"map"}})]),n("el-drawer",{attrs:{"append-to-body":"",size:"40%","show-close":!1,visible:e.selectFnVisible},on:{"update:visible":function(t){e.selectFnVisible=t}},scopedSlots:e._u([{key:"title",fn:function(){return[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[n("i",{staticClass:"m-r-8 el-icon-view"}),n("span",[e._v("功能组件列表及介绍")])]),n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreateFn}},[e._v("确定添加")])],1)]},proxy:!0}])},[n("el-tabs",{model:{value:e.selectFnName,callback:function(t){e.selectFnName=t},expression:"selectFnName"}},e._l(e.fnOptions,(function(t){return n("el-tab-pane",{key:t.name,attrs:{name:t.name,label:t.display}},[n("el-alert",{attrs:{type:"warning",title:e.selectFn.name,description:e.selectFn.description,closable:!1}}),e._l(e.selectFn.parameters,(function(t){return n("el-row",{key:t.name},[n("el-divider",[e._v(e._s(t.display))]),n("el-alert",{attrs:{type:"info",closable:!1,description:t.description},scopedSlots:e._u([{key:"title",fn:function(){return[n("el-tooltip",{attrs:{content:"字段",placement:"top"}},[n("el-tag",{staticStyle:{"margin-right":"16px"},attrs:{size:"small",effect:"dark",type:"success"}},[e._v(e._s(t.name))])],1),n("el-tooltip",{attrs:{content:"类型",placement:"top"}},[n("el-tag",{staticStyle:{"margin-right":"16px"},attrs:{size:"small",effect:"dark",type:"warning"}},[e._v(e._s(t.type))])],1),n("el-tooltip",{attrs:{content:"默认值",placement:"top"}},[n("el-tag",{attrs:{size:"small",effect:"dark"}},[e._v(e._s(t.default))])],1)]},proxy:!0}],null,!0)})],1)}))],2)})),1)],1)],2)}),[],!1,K,null,null,null);function K(e){for(let t in N)this[t]=N[t]}var $=function(){return V.exports}();const Y={setup:(e,t)=>{T.serviceRegister();const{config:n,loading:r,request:i,currentActiveConfig:o,jsonVisible:a,setJsonVisible:s,handleUpdate:l,handleResetBefore:c}=x.serviceDiscovery();return{Tabs:g,config:n,loading:r,request:i,currentActiveConfig:o,jsonVisible:a,setJsonVisible:s,handleUpdate:l,handleResetBefore:c}}};Y.components=Object.assign({Infer:P,Camera:$,Report:R},Y.components);const X={};var q=y(Y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[n("el-card",{scopedSlots:e._u([{key:"header",fn:function(){return[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[e._v("AI 功能配置")]),n("div",[n("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-refresh-left",loading:e.loading},on:{click:e.handleResetBefore}},[n("span",[e._v("重置")])]),n("el-button",{attrs:{size:"small",icon:"el-icon-refresh",loading:e.loading},on:{click:e.request}},[e._v("刷新")]),n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-check",loading:e.loading},on:{click:e.handleUpdate}},[e._v("保存")]),n("el-button",{attrs:{size:"small",type:"info",icon:"el-icon-view",loading:e.loading},on:{click:function(t){return e.setJsonVisible(!0)}}},[e._v("查看配置")])],1)])]},proxy:!0}])},[n("el-tabs",{model:{value:e.currentActiveConfig,callback:function(t){e.currentActiveConfig=t},expression:"currentActiveConfig"}},[n("el-tab-pane",{attrs:{label:"推理引擎配置",name:e.Tabs.INFER}},[n("Infer")],1),n("el-tab-pane",{attrs:{label:"摄像头组件配置",name:e.Tabs.CAMERA}},[n("Camera")],1),n("el-tab-pane",{attrs:{label:"平台上报配置",name:e.Tabs.REPORT}},[n("Report")],1)],1)],1),n("el-drawer",{attrs:{size:"50%","show-close":!1,visible:e.jsonVisible},on:{"update:visible":function(t){e.jsonVisible=t}},scopedSlots:e._u([{key:"title",fn:function(){return[n("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("span",[n("i",{staticClass:"m-r-8 el-icon-view"}),n("span",[e._v("配置总览")])]),n("el-button",{attrs:{size:"small",icon:"el-icon-close"},on:{click:function(t){return e.setJsonVisible(!1)}}},[e._v("关闭")])],1)]},proxy:!0}])},[n("el-card",[n("pre",[e._v(e._s(JSON.stringify(e.config,null,2)))])])],1)],1)}),[],!1,H,null,null,null);function H(e){for(let t in X)this[t]=X[t]}var Z=function(){return q.exports}();const J={setup:(e,t)=>(x.serviceRegister(),{})};J.components=Object.assign({IndexWrapper:Z},J.components);const Q={};var ee=y(J,(function(){var e=this.$createElement;return(this._self._c||e)("IndexWrapper")}),[],!1,te,null,null,null);function te(e){for(let t in Q)this[t]=Q[t]}var ne=function(){return ee.exports}();export{ne as default};
