import{u as e}from"./useComposables.07b7fc4f.js";import{u as t,n as o}from"./index.a21b1831.js";import{u as n,a as s}from"./useRequestor.ce90c02e.js";import{r as a,e as r,o as i}from"./vendor.b8049c8b.js";var l,c=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};l=function(e,t,o,n){return t=t||"&",o=o||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(n){var s=encodeURIComponent(c(n))+o;return Array.isArray(e[n])?e[n].map((function(e){return s+encodeURIComponent(c(e))})).join(t):s+encodeURIComponent(c(e[n]))})).filter(Boolean).join(t):n?encodeURIComponent(c(n))+o+encodeURIComponent(c(e)):""};class d{}function u(){const o=t(),c=a("admin"),u=a(""),[p,m]=e(!1),f=a({old_password:"",new_password:""}),v=a({old_password:[{required:!0,message:"必填项",trigger:"blur"}],new_password:[{required:!0,message:"必填项",trigger:"blur"},{min:8,message:"新密码不得少于 8 位",trigger:"blur"}]}),w=a(null),[g,h]=e(!1),[b,y]=e(!1),_=async()=>{if(!c.value)return s(-1,"请先输入帐号");if(!u.value)return s(-1,"请先输入密码");try{m(!0);const{status_code:e,status_info:t,data:a}=await function(e,t){return n.request({url:d.AuthLogin,data:l({username:e,password:t}),method:"POST"})}(c.value,u.value);if(s(e,t)){const{token:e,first_time_login:t}=a;localStorage.setItem("Token",e),t?(h(!0),setTimeout((()=>{r.exports.Notification({type:"info",title:"提示",message:"当前帐号首次登录该系统，需修改密码后再进行操作 ~",duration:5e3})}))):(o.push("/analysis"),setInterval((async()=>{const{data:e}=await n.request({url:d.AuthToken,method:"POST"});localStorage.setItem("Token",e.token)}),108e5))}}catch(e){s("error",JSON.stringify(e))}finally{m(!1)}},k=e=>{if("Enter"===e.key)return c.value?u.value?void _():s(-1,"请先输入密码"):s(-1,"请先输入帐号")};return document.addEventListener("keyup",k),i((()=>document.removeEventListener("keyup",k))),{loading:p,username:c,password:u,handleLogin:_,model:f,rules:v,formRef:w,visible:g,setVisible:h,confirmLoading:b,handleConfirm:async()=>{var e,t;try{y(!0),await(null==(e=w.value)?void 0:e.validate());const{status_code:o,status_info:a}=await(t=f.value,n.request({url:d.HandleAction,data:l(t),method:"POST"}));s(o,a)}catch(o){s("error",JSON.stringify(o))}finally{y(!1),h(!1)}}}}d.AuthToken="/token",d.AuthLogin="//10.0.0.212/api/login",d.HandleAction="/password";const p={setup:(e,t)=>{const{loading:o,username:n,password:s,handleLogin:a,rules:r,model:i,formRef:l,visible:c,setVisible:d,confirmLoading:p,handleConfirm:m}=u();return{loading:o,username:n,password:s,handleLogin:a,rules:r,model:i,formRef:l,visible:c,setVisible:d,confirmLoading:p,handleConfirm:m}}};const m={};var f=o(p,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"auth"},[o("div",{staticClass:"bg"},[o("el-card",{staticClass:"main",attrs:{hoverable:""}},[o("div",{staticClass:"text-align-center",attrs:{slot:"header"},slot:"header"},[o("el-row",[o("svg",{attrs:{t:"1631531428029",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1241",width:"40"}},[o("path",{attrs:{d:"M694.710857 429.129143a201.581714 201.581714 0 1 0 0.146286 403.163428 201.581714 201.581714 0 0 0-0.146286-403.163428z m0 352.694857a114.761143 114.761143 0 1 1 0.073143-229.302857 114.761143 114.761143 0 0 1-0.073143 229.302857z m0-174.738286a62.464 62.464 0 0 0 0 124.928c34.742857 0 62.683429-28.086857 62.683429-62.464S729.453714 607.085714 694.710857 607.085714z",fill:"#409EFF","p-id":"1242"}}),o("path",{attrs:{d:"M840.484571 796.086857c-37.814857 33.060571-89.088 53.540571-145.773714 53.540572s-108.251429-20.48-145.846857-53.540572l-34.304 75.337143-0.438857 1.170286a25.380571 25.380571 0 0 0 4.681143 25.161143c9.728 11.995429 30.354286 19.821714 52.809143 19.821714h246.125714c19.017143 0 43.154286-6.582857 53.906286-21.065143a23.771429 23.771429 0 0 0 3.072-24.941714l-34.230858-75.483429zM329.142857 768H226.889143c-98.230857 0-150.893714-46.372571-165.888-145.846857L55.003429 246.125714c0-62.537143 29.842286-136.411429 171.885714-136.411428h550.765714c139.776 0 155.940571 73.654857 155.940572 129.024l2.048 84.992a36.571429 36.571429 0 0 1-35.693715 37.449143 37.376 37.376 0 0 1-37.449143-35.693715l-2.048-85.869714c0-32.109714 0-56.758857-82.797714-56.758857h-550.765714c-98.742857 0-98.742857 37.741714-98.742857 62.683428l5.632 370.614858c10.166857 65.755429 39.424 78.701714 93.110857 78.701714H329.142857a36.571429 36.571429 0 0 1 0 73.142857z",fill:"#4D5573","p-id":"1243"}})])]),o("el-row",[o("span",{staticClass:"name"},[e._v("安维科技 AI 盒子")])])],1),o("el-input",{attrs:{clearable:"",placeholder:"用户帐号","prefix-icon":"el-icon-user"},model:{value:e.username,callback:function(t){e.username="string"==typeof t?t.trim():t},expression:"username"}}),o("el-input",{staticStyle:{"margin-top":"16px"},attrs:{clearable:"",autofocus:"","show-password":"",placeholder:"登录密码","prefix-icon":"el-icon-lock"},model:{value:e.password,callback:function(t){e.password="string"==typeof t?t.trim():t},expression:"password"}}),o("el-divider",{attrs:{"content-position":"right"}},[o("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(t){return e.setVisible(!0)}}},[e._v("修改密码")])],1),o("el-button",{staticClass:"w-100",attrs:{type:"primary",icon:"el-icon-d-arrow-right",loading:e.loading},on:{click:e.handleLogin}},[e._v("登 录")])],1)],1),o("el-dialog",{attrs:{width:"20%",visible:e.visible},on:{"update:visible":function(t){e.visible=t}},scopedSlots:e._u([{key:"title",fn:function(){return[o("i",{staticClass:"m-r-8 el-icon-edit"}),o("span",[e._v("修改密码")])]},proxy:!0},{key:"footer",fn:function(){return[o("el-button",{attrs:{type:"warning",icon:"el-icon-close"},on:{click:function(t){return e.setVisible(!1)}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary",icon:"el-icon-check",loading:e.confirmLoading},on:{click:e.handleConfirm}},[e._v("确 定")])]},proxy:!0}])},[o("el-form",{ref:"formRef",attrs:{model:e.model,rules:e.rules}},[o("el-form-item",{attrs:{label:"旧密码",prop:"old_password"}},[o("el-input",{attrs:{clearable:"","show-password":""},model:{value:e.model.old_password,callback:function(t){e.$set(e.model,"old_password",t)},expression:"model.old_password"}})],1),o("el-form-item",{attrs:{label:"新密码",prop:"new_password"}},[o("el-input",{attrs:{clearable:"","show-password":""},model:{value:e.model.new_password,callback:function(t){e.$set(e.model,"new_password",t)},expression:"model.new_password"}})],1)],1)],1)],1)}),[],!1,v,"f2731860",null,null);function v(e){for(let t in m)this[t]=m[t]}var w=function(){return f.exports}();export{w as default};
